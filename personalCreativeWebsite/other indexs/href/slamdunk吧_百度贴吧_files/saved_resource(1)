_.Module.define({path:"creativeplatform/widget/aopApp",requires:[],sub:{initial:function(i){this._initApps(i)},_initApps:function(i){for(var t=i.length,e=0;t>e;e++)this.requireInstanceAsync("creativeplatform/widget/"+i[e])}}});
;_.Module.define({path:"creativeplatform/widget/normalApp",requires:[],sub:{initial:function(i){this._initApps(i)},_initApps:function(i){for(var t=i.length,e=0;t>e;e++)this.requireInstanceAsync("creativeplatform/widget/"+i[e])}}});_.Module.define({path:"common/widget/Card",requires:[],sub:{_option:{},_j_card:null,_open_timer:null,_close_timer:null,_is_show:!1,_is_first_show:!0,_default_option:{content:"",arrow_dir:"down",arrow_pos:{},card_css:{width:170,"z-index":1001},arrow_req:!0,auto_positon:!1,event_target:null,offset:{x:0,y:0},card_leave_display:!1,card_hover_show:!0,card_leave_hide:!1,attr:"",clazz:"",wrap:$("body")},initial:function(t){var i=this;i._option=$.extend(!0,{},i._default_option,t),this._buildCard()},_buildCard:function(){var t=this._option,i=this._genericTpl(),e=t.wrap;this._j_card=$(i),this._j_card.find(".j_content").html(t.content),e.append(this._j_card),delete t.card_css.height,this._j_card.css(t.card_css),t.card_css.height=this._j_card.find(".j_content").outerHeight(!0),this._arrow=this._j_card.find(".j_ui_white_arrow"),void 0===t.arrow_pos.left&&(this._arrow_left=t.card_css.width/2-10,this._arrow.css({left:this._arrow_left})),this._arrow.css(t.arrow_pos),t.arrow_req||this._j_card.find(".j_ui_white_arrow").hide(),t.auto_positon&&this._autoPosition()},_autoPosition:function(){var t=this._option,i={},e=$(window).height(),_=$(window).width(),o=($(document).scrollLeft(),$(document).scrollTop()),r=(t.event_target.innerWidth(),t.event_target.innerHeight()),s="",a={x:t.event_target.offset().left-t.card_css.width/2+t.event_target.outerWidth(!0)/2,y:t.event_target.offset().top-t.card_css.height-10,width:this._j_card.innerWidth(),height:this._j_card.innerHeight()+this._arrow.innerHeight()};i.left=a.x,i.top=a.y;var n=t.arrow_pos.left||this._arrow_left,d=15,h=_;_<$(document).width()&&(h=$(document).width());var c=h-(t.card_css.width+d);i.left<d?(n+=i.left-d,i.left=d):i.left>c&&(n+=i.left-c,i.left=c),i.top<o?(s="up",i.top+=r+(a.height||0),i.top-=t.offset.y):(i.top+=i.top+r>o+e?-r-(a.height||0):0,s="down",i.top+=t.offset.y),this._arrow.removeClass("ui_white_down").removeClass("ui_white_up").addClass("ui_white_"+s).css({left:n}),this._j_card.css(i)},_genericTpl:function(){var t=this._option.attr,i=this._option.arrow_dir,e=this._option.clazz,_=['<div class="ui_card_wrap '+e+'" '+t+' style="visibility: hidden">','<div class="j_content ui_card_content ">',"</div>",'<span class="j_ui_white_arrow arrow ui_white_'+i+'"></span>',"</div>"].join("");return _},showCard:function(t){var i=this;i._close_timer&&clearTimeout(i._close_timer),t&&"delayShow"==t.type?(i._open_timer&&clearTimeout(i._open_timer),i._open_timer=setTimeout(function(){i._showCardDo()},t.time)):i._showCardDo()},closeCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayClose"==t.type?i._close_timer=setTimeout(function(){i._closeCardDo()},t.time):i._closeCardDo()},hideCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayHide"==t.type?i._close_timer=setTimeout(function(){i._hideCardDo()},t.time):i._hideCardDo()},_showCardDo:function(){var t=this;t._is_first_show&&(this._j_card.bind("mouseenter",function(){t._option.card_hover_show&&(t._is_show=!0)}),this._j_card.bind("mouseleave",function(){return t._option.card_leave_display?!1:(t._is_show=!1,t._option.card_leave_hide?t.hideCard():t.closeCard(),void 0)}),t._is_first_show=!1),this._j_card.css({visibility:"visible"})},_closeCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.remove()},_hideCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.css({visibility:"hidden"})},setContent:function(t){var i=this._option;if(null!==this._j_card){var e=this._j_card.find(".j_content");e.html(t),i.card_css.height=e.outerHeight(!0),this._j_card.css({height:i.card_css.height}),i.auto_positon&&this._autoPosition()}}}});_.Module.define({path:"common/component/Card",requires:[],sub:{_option:{},_j_card:null,_open_timer:null,_close_timer:null,_is_show:!1,_is_first_show:!0,_default_option:{content:"",arrow_dir:"down",arrow_pos:{},card_css:{width:170,"z-index":1001},arrow_req:!0,auto_positon:!1,event_target:null,offset:{x:0,y:0},card_leave_display:!1,card_hover_show:!0,card_leave_hide:!1,attr:"",wrap:$("body")},initial:function(t){var i=this;i._option=$.extend(!0,{},i._default_option,t),this._buildCard()},_buildCard:function(){var t=this._option,i=this._genericTpl(),e=t.wrap;this._j_card=$(i),this._j_card.find(".j_content").html(t.content),e.append(this._j_card),delete t.card_css.height,this._j_card.css(t.card_css),t.card_css.height=this._j_card.find(".j_content").outerHeight(!0),this._arrow=this._j_card.find(".j_ui_white_arrow"),void 0===t.arrow_pos.left&&(this._arrow_left=t.card_css.width/2-10,this._arrow.css({left:this._arrow_left})),this._arrow.css(t.arrow_pos),t.arrow_req||this._j_card.find(".j_ui_white_arrow").hide(),t.auto_positon&&this._autoPosition()},_autoPosition:function(){var t=this._option,i={},e=$(window).height(),_=$(window).width(),o=($(document).scrollLeft(),$(document).scrollTop()),r=(t.event_target.innerWidth(),t.event_target.innerHeight()),s="",a={x:t.event_target.offset().left-t.card_css.width/2+t.event_target.outerWidth(!0)/2,y:t.event_target.offset().top-t.card_css.height-10,width:this._j_card.innerWidth(),height:this._j_card.innerHeight()+this._arrow.innerHeight()};i.left=a.x,i.top=a.y;var n=t.arrow_pos.left||this._arrow_left,d=15,h=_;_<$(document).width()&&(h=$(document).width());var c=h-(t.card_css.width+d);i.left<d?(n+=i.left-d,i.left=d):i.left>c&&(n+=i.left-c,i.left=c),i.top<o?(s="up",i.top+=r+(a.height||0),i.top-=t.offset.y):(i.top+=i.top+r>o+e?-r-(a.height||0):0,s="down",i.top+=t.offset.y),this._arrow.removeClass("ui_white_down").removeClass("ui_white_up").addClass("ui_white_"+s).css({left:n}),this._j_card.css(i)},_genericTpl:function(){var t=this._option.attr,i=this._option.arrow_dir,e=['<div class="ui_card_wrap" '+t+' style="visibility: hidden">','<div class="j_content ui_card_content ">',"</div>",'<span class="j_ui_white_arrow arrow ui_white_'+i+'"></span>',"</div>"].join("");return e},showCard:function(t){var i=this;i._close_timer&&clearTimeout(i._close_timer),t&&"delayShow"==t.type?(i._open_timer&&clearTimeout(i._open_timer),i._open_timer=setTimeout(function(){i._showCardDo()},t.time)):i._showCardDo()},closeCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayClose"==t.type?i._close_timer=setTimeout(function(){i._closeCardDo()},t.time):i._closeCardDo()},hideCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayHide"==t.type?i._close_timer=setTimeout(function(){i._hideCardDo()},t.time):i._hideCardDo()},_showCardDo:function(){var t=this;t._is_first_show&&(this._j_card.bind("mouseenter",function(){t._option.card_hover_show&&(t._is_show=!0)}),this._j_card.bind("mouseleave",function(){return t._option.card_leave_display?!1:(t._is_show=!1,t._option.card_leave_hide?t.hideCard():t.closeCard(),void 0)}),t._is_first_show=!1),this._j_card.css({visibility:"visible"})},_closeCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.remove()},_hideCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.css({visibility:"hidden"})},setContent:function(t){var i=this._option;if(null!==this._j_card){var e=this._j_card.find(".j_content");e.html(t),i.card_css.height=e.outerHeight(!0),this._j_card.css({height:i.card_css.height}),i.auto_positon&&this._autoPosition()}}}});_.Module.define({path:"common/component/JsPager",sub:{_cfg:{},_amount:0,_center_pos:0,_jwrapper:null,_isNew:!0,_page_template:{normal:'<a href="#url#" index="#page#" #special#>#page#</a>',current:"<span #special#>#page#</span>",prev:'<a href="#url#" index="#page#" #special#>\u4E0A\u4E00\u9875</a>',next:'<a href="#url#" index="#page#" #special#>\u4E0B\u4E00\u9875</a>',head:'<a href="#url#" index="#page#" #special#>\u9996\u9875</a>',tail:'<a href="#url#" index="#page#" #special#>\u5C3E\u9875</a>',prev_disable:'<a href="#url#" index="#page#" #special#>\u4E0A\u4E00\u9875</a>',next_disable:'<a href="#url#" index="#page#" #special#>\u4E0B\u4E00\u9875</a>',head_disable:'<a href="#url#" index="#page#" #special#>\u9996\u9875</a>',tail_disable:'<a href="#url#" index="#page#" #special#>\u5C3E\u9875</a>',status:'<span #special#><span class="js_pager_idx">#page#</span>/<span class="js_pager_total">#total#</span></span>'},_default_cfg:{container:$("body"),amount:10,isHtml:!1,current:1,total:10,mode:0,url:"##",openInNew:!1,showStatus:!1,statusPos:"head",showDisableItem:!1,template:{},classname:{wrapper:"tbui_js_pager",normal:"",current:"current",prev:"prev",next:"next",head:"head",tail:"tail",status:"status",prev_disable:"prev_disable",next_disable:"next_disable",head_disable:"head_disable",tail_disable:"tail_disable"}},initial:function(e){var a=this;if(a._isNew){a._cfg=$.extend({},a._default_cfg,e);var t=a._cfg;t.template=$.extend({},a._page_template,t.template),t.amount=parseInt(t.amount),t.current=parseInt(t.current),t.total=parseInt(t.total),a._amount=t.total>t.amount?t.amount:t.total,a._center_pos=parseInt((a._amount+1)/2)}else a._cfg=$.extend(a._cfg,e);a._amount<=1||(a._cfg.isHtml||a._render(),a._isNew=!1)},_render:function(){var e=this,a=e._cfg,t=[],r="";if(a.showStatus&&"head"===a.statusPos&&t.push(e._generateHtml("status",a.current,a.total)),a.current>1?(t.push(e._generateHtml("head",1)),t.push(e._generateHtml("prev",a.current-1))):a.showDisableItem&&(t.push(e._generateHtml("head_disable",1)),t.push(e._generateHtml("prev_disable",a.current-1))),e._amount){var n,s,l,p;n=a.current-parseInt((e._amount-1)/2),s=a.current+e._center_pos,1>n?(l=1-n,n=1,s+=l,s=s>a.total?a.total:s):s>a.total&&(l=s-a.total,s=a.total,n-=l,n=1>n?1:n);for(var i=n;s>=i;i++)p=i==a.current?"current":"normal",t.push(e._generateHtml(p,i))}if(a.current<a.total?(t.push(e._generateHtml("next",a.current+1)),t.push(e._generateHtml("tail",a.total))):a.showDisableItem&&(t.push(e._generateHtml("next_disable",a.current+1)),t.push(e._generateHtml("tail_disable",a.total))),a.showStatus&&"tail"===a.statusPos&&t.push(e._generateHtml("status",a.current,a.total)),r=t.join(""),e._isNew&&(e._jwrapper=$("<div>",{"class":a.classname.wrapper}),e._jwrapper.bind("click",function(t){return"A"==t.target.nodeName&&("0"!==$(t.target).tbattr("ok")&&e.trigger("pageChange",parseInt($(t.target).tbattr("index"))),0==a.mode)?!1:void 0}),!a.isHtml)){var u="string"==typeof a.container?$("#"+a.container):$(a.container);u.empty(),u.append(this._jwrapper)}return a.isHtml?r:(e._jwrapper.html(r),void 0)},_generateHtml:function(e,a,t){var r="",n=this._cfg;r=n.template[e],r=r.replace(/#page#/g,a),r=r.replace(/#url#/g,n.url.replace(/\{page\}/g,a)),"undefined"!=typeof t&&(r=r.replace(/#total#/g,t));var s="";return n.classname[e]&&(s+='class="'+n.classname[e]+'"'),n.openInNew&&(s+=" target=_blank"),-1!==e.indexOf("disable")&&(s+=' ok="0"'),r=r.replace(/#special#/,s)}}});_.Module.define({path:"common/widget/umoney_query",sub:{url:{queryCredit:"/tbapp/umoney/queryUserInfo",queryQualification:"/tbapp/umoney/queryQualification"},query_umoney_cls:".j-query-umoney",umoneyInfoStatus:{s1:"\u672A\u7533\u8BF7",s2:"\u5BA1\u6838\u4E2D",s3:"\u6B63\u5E38",s4:"\u903E\u671F",s5:"\u51BB\u7ED3",s6:"\u5931\u8D25"},initial:function(){var e=this;e.$element=$(".tdou-umoney-query")},showUmoney:function(e){var n=this,t=$.tb.format('<div class="tdou-umoney-query">          <span class="umoney-user">              #{displayText}:              <a class="j-query-umoney " href="javascript:void(0);"                 title="\u67E5\u770B\u6709\u94B1\u989D\u5EA6"                 locate="userinfo#\u767E\u5EA6\u6709\u94B1">                  \u67E5\u770B              </a>          </span>          <span class="umoney-placeholder">              <a target="_blank" href="/f?ie=utf-8&kw=\u767E\u5EA6\u6709\u94B1\u6D88\u8D39\u91D1\u878D"                 locate="userinfo#\u767E\u5EA6\u6709\u94B1">                  \u767E\u5EA6\u6709\u94B1\u9001T\u8C46              </a>          </span>  </div>',{displayText:e||"\u767E\u5EA6\u6709\u94B1\u989D\u5EA6"});return n.getUmoneyDom(t)},showUmoneyOnGotTdou:function(){var e=this,n='<div class="tdou-umoney-query umoney-query-get-tdou">          <span class="umoney-user">             <span class="umoney-logo"></span>\u4F7F\u7528\u767E\u5EA6\u6709\u94B1\u4ED8\u6B3E\uFF0C\u73B0\u5728\u652F\u4ED8\u4E0B\u6708\u8FD8\u94B1\u3002\u6709\u94B1\u989D\u5EA6:              <a class="j-query-umoney " href="javascript:void(0);"                 title="\u67E5\u770B\u6709\u94B1\u989D\u5EA6"                 locate="\u83B7\u53D6t\u8C46#\u767E\u5EA6\u6709\u94B1">                  \u67E5\u770B              </a>          </span>           <span class="umoney-placeholder">               <span class="umoney-logo"></span>             <a target="_blank" href="/f?ie=utf-8&kw=\u767E\u5EA6\u6709\u94B1\u6D88\u8D39\u91D1\u878D"                locate="\u83B7\u53D6t\u8C46#\u767E\u5EA6\u6709\u94B1">                 \u4F7F\u7528\u767E\u5EA6\u6709\u94B1\u4E70T\u8C46\uFF0C\u53EF\u5148\u6D88\u8D39\u540E\u8FD8\u6B3E\uFF0C\u8FD8\u67095%\u7684\u4E13\u4EAB\u4F18\u60E0\u54E6             </a>          </span>  </div>',t=e.getUmoneyDom(n);return t},showUmoneyMember:function(){var e=this,n='<div class="tdou-umoney-query tshow-tdou-umoney-query">      <a  target="_blank" href="/f?ie=utf-8&kw=\u767E\u5EA6\u6709\u94B1\u6D88\u8D39\u91D1\u878D" locate="tshow-bar#\u767E\u5EA6\u6709\u94B1">          <span class="umoney-logo"></span>\u4F7F\u7528\u767E\u5EA6\u6709\u94B1\u8D2D\u4E70\u8D34\u5427\u4F1A\u5458\u4F18\u60E0          <span class="vip-red vip-discount">5%</span>      </a>  </div>';return e.$element=$(n),e.$element},getUmoneyDom:function(e){var n=this;return this.$element=$(e),n.isUmoneyUser(),n.$element},bindEvents:function(){var e=this;e.$element.on("click",e.query_umoney_cls,function(){e.queryUmoneyCredit()})},queryUmoneyCredit:function(){var e=this;e._queryUmoneyCredit&&e._queryUmoneyCredit.abort(),e._queryUmoneyCredit=$.ajax({type:"GET",url:e.url.queryCredit,data:{},cache:!1,dataType:"json"}).success(function(n){if(e._queryUmoneyCredit=null,0==n.no){var t=n.data&&n.data.data;e.showCredit(t)}})},isUmoneyUser:function(){var e=this;e._isUmoneyUser&&e._isUmoneyUser.abort(),e._isUmoneyUser=$.ajax({type:"GET",url:e.url.queryCredit,data:{},cache:!1,dataType:"json"}).success(function(n){if(e._isUmoneyUser=null,0==n.no){var t=n.data&&n.data.data.status;"1"!=t&&(e.$element.find(".umoney-placeholder").hide().end().find(".umoney-user").show(),e.bindEvents())}else e.$element.find(".umoney-user").hide().end().find(".umoney-placeholder").show()})},showCredit:function(e){if(e){var n=this,t="";if(3===e.status){var a=e.credit||0;t=a+"\u5143 "}else t=n.umoneyInfoStatus["s"+e.status];var s=t+",\u70B9\u51FB\u5237\u65B0";n.$element.find(n.query_umoney_cls).html(t).addClass("umoney-credit").tbattr("title",s)}},track:function(e,n){$.stats.track(e,"umoney-query",PageData.product+"-"+n,"click")}}});_.Module.define({path:"common/widget/wallet_dialog",requires:["common/component/Card","common/component/JsPager","common/widget/umoneyQuery"],sub:{_dialog:null,_html:null,_pushPager:null,_popPager:null,_otherPopPager:null,_options:null,_pager_option:{container:null,amount:3,current:1,total:0,mode:0,showDisableItem:!0,template:{prev:'<a href="#url#" index="#page#" #special#>&lt;</a>',next:'<a href="#url#" index="#page#" #special#>&gt;</a>',prev_disable:'<a href="#url#" index="#page#" #special#>&lt;</a>',next_disable:'<a href="#url#" index="#page#" #special#>&gt;</a>',head:"",tail:"",head_disable:"",tail_disable:""},classname:{wrapper:"tbui_js_pager wallet_js_pager",normal:"normal",current:"current",prev:"prev j_wallet_list_prev",next:"next j_wallet_next_prev",status:"status",prev_disable:"prev_disable",next_disable:"next_disable"}},initial:function(){},show:function(a){var l=this;l._options=a||{},l._buildCard()},hide:function(){this._dialog&&this._dialog.close()},_buildCard:function(){var a=this;$.ajax({url:"/tbmall/history?ie=utf8&c=1&pn=1&_t="+(new Date).valueOf(),type:"get",dateType:"json",success:function(l){if(0===l.no){a._buildInitHtml(l.data.user);var t={html:a._html,title:"\u6211\u7684T\u8C46\u94B1\u5305",draggable:!1,width:700,hideOnclose:!1};a._dialog=new $.dialog(t),a._buildPager(1,$("#wallet_dialog_msg_tbmall_pop_pager"),a._popPager,a._popChange,l),a._buildPager(1,$("#wallet_dialog_msg_other_pop_pager"),a._otherPopPager,a._otherPopChange),a._buildPager(1,$("#wallet_dialog_msg_push_pager"),a._pushPager,a._pushChange),$("#wallet_dialog_tab").on("click",".j_wallet_dialog_tab_item",function(a){var l=$(a.currentTarget);$(".j_wallet_dialog_tab_item").removeClass("wallet_dialog_tab_current"),l.addClass("wallet_dialog_tab_current");var t=l.tbattr("attr-show");$(".j_wallet_dialog_msg_list").hide(),$(t).show()}),$("#wallet_dialog_return").on("click",function(){}),$("#wallet_dialog_medal").on("click",".j_wallet_dialog_medal_btn",function(l){l.preventDefault(),_.Module.use("common/widget/JoinVipDialog",[],function(a){a.getMemberDialog()}),a.hide()}),$("#j_wallet_tcharge_dialog").on("click",function(){$.stats.track("T\u8C46\u94B1\u5305\u6D6E\u5C42\u83B7\u53D6T\u8C46","\u4F1A\u5458\u5B98\u7F51\u7EDF\u8BA1"),a.hide(),_.Module.use("common/widget/tcharge_dialog")}),a.addUmoney()}}})},addUmoney:function(){var a=this;a.umoney=a.requireInstance("common/widget/umoneyQuery");var l=a.umoney.showUmoney("\u767E\u5EA6\u6709\u94B1\u53EF\u7528\u989D\u5EA6");a._dialog.element.find(".wallet_dialog_my_tbean").after(l)},_getOrderStatus:function(a){var l={0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:'\u5151\u6362\u8D85\u65F6\uFF0C<a target="_blank" href="/f?ie=utf-8&kw=T%E8%B1%86%E5%95%86%E5%9F%8E%E5%90%A7">\u8054\u7CFB\u7BA1\u7406\u5458</a>'};return l[a]},_otherPopChange:function(a,l){var t=this,e=5;$.ajax({url:"/tbmall/getThirdOrder?ie=utf8&c="+e+"&pn="+a+"&_t="+(new Date).valueOf(),type:"get",dateType:"json",success:function(_){0===_.no&&(t._buildOtherPopPage.call(t,_,a),l(Math.ceil(_.data.total_count/e)))}})},_buildOtherPopPage:function(a,l){for(var t=a.data.order_info||[],e=[],_=0;_<t.length;_++){var s=t[_],i=new Date(1e3*s.create_time),o=this._formatDateTime(i),n=s.status;e.push('<li class="wallet_dialog_msg_list_item wallet_dialog_msg_list_item_pop">'),e.push('<div class="wallet_dialog_order">\u8BA2\u5355\u53F7\uFF1A'+s.order_id+"\uFF0C<span>"+this._getOrderStatus(n)+"</span></div>"),e.push('<div class="text_overflow">\u60A8\u83B7\u53D6\u3010<strong>'+$.tb.subByte(s.goods_name,24,"")+"</strong>\u3011\u5546\u54C1\uFF0C"),e.push('\u6D88\u8D39\u4E86<span class="orange_text">'+s.tdou_num+"T\u8C46</span></div>"),e.push('<span class="wallet_dialog_msg_list_date">'+o+"</span>"),e.push("</li>")}0==t.length&&1==l&&(e.push('<div class="wallet_dialog_msg_empty">'),e.push("\u60A8\u8FD8\u6CA1\u8D2D\u4E70\u8FC7\u4E1C\u897F\u54E6~\uFF0C<br>\u8D34\u5427\u65B0\u73A9\u6CD5\u4ECE\u9177\u70AB\u7279\u6743\u9053\u5177\u5F00\u59CB\u3002<br>"),e.push('<a target="_blank" href="/tbmall/home">\u8FDB\u5165\u5546\u57CE\u8D2D\u4E70&gt;&gt;</a>'),e.push("</div>")),e=e.join(""),$("#wallet_other_pop_list_main").html(e)},_popChange:function(a,l,t){var e=this,_=10;return t?(e._buildPopPage.call(e,t),l(Math.ceil(t.data.total_count/_)),void 0):($.ajax({url:"/tbmall/history?ie=utf8&c="+_+"&pn="+a+"&_t="+(new Date).valueOf(),type:"get",dateType:"json",success:function(t){0===t.no&&(e._buildPopPage.call(e,t,a),l(Math.ceil(t.data.total_count/_)))}}),void 0)},_formatDateTime:function(a){var l=a||Date.now(),t=[];return t.push(l.getFullYear()+"\u5E74"),t.push(parseInt(l.getMonth()+1)+"\u6708"),t.push(l.getDate()+"\u65E5&nbsp;"),t.push(l.getHours()+":"),t.push(l.getMinutes()),t=t.join("")},_buildPopPage:function(a,l){for(var t=a.data.order_info||[],e=[],_=0;_<t.length;_++){var s=t[_],i=new Date(1e3*s.create_time),o=this._formatDateTime(i);e.push('<li class="wallet_dialog_msg_list_item wallet_dialog_msg_list_item_pop">'),e.push('\u60A8\u6D88\u8D39\u4E86<span class="orange_text">'+s.scores+"T\u8C46</span>\uFF0C");var n=0==s.props_id.indexOf("105")?"\u8D2D\u4E70":"\u5151\u6362";e.push(n+"\u4E86\u9053\u5177<strong>"+s.props_name+"</strong>"),e.push('<span class="wallet_dialog_msg_list_date">'+o+"</span>"),e.push("</li>")}0==t.length&&1==l&&(e.push('<div class="wallet_dialog_msg_empty">'),e.push("\u60A8\u8FD8\u6CA1\u8D2D\u4E70\u8FC7\u4E1C\u897F\u54E6~\uFF0C<br>\u8D34\u5427\u65B0\u73A9\u6CD5\u4ECE\u9177\u70AB\u7279\u6743\u9053\u5177\u5F00\u59CB\u3002<br>"),e.push('<a target="_blank" href="/tbmall/home">\u8FDB\u5165\u5546\u57CE\u8D2D\u4E70&gt;&gt;</a>'),e.push("</div>")),e=e.join(""),$("#wallet_tbmall_pop_list_main").html(e)},_pushChange:function(a,l){var t=this,e=5;$.ajax({url:"/tbmall/bwsdubiorder?ie=utf8&c="+e+"&pn="+a+"&_t="+(new Date).valueOf(),type:"get",dateType:"json",success:function(_){0===_.no&&(t._buildPushPage.call(t,_,a),l(Math.ceil(_.data.total_num/e)))}})},_buildPushPage:function(a,l){for(var t=a.data.order||[],e=[],_=0;_<t.length;_++){var s=t[_],i=new Date(1e3*s.create_time),o=this._formatDateTime(i),n=parseInt(s.given_scores||0,10)+parseInt(s.scores||0,10);e.push('<li class="wallet_dialog_msg_list_item wallet_dialog_msg_list_item_pop">'),e.push('<div class="wallet_dialog_order">\u8BA2\u5355\u53F7\uFF1A'+s.order_id+"</div>"),e.push('\u6D88\u8D39<span class="orange_text">'+s.db_money/100+"</span>\u767E\u5EA6\u70B9\u5238"),e.push("\u8D2D\u4E70\u3010\u8D34\u5427\u5370\u8BB0\u3011</span>"),parseInt(s.given_scores)&&e.push('\u83B7\u8D60<span class="orange_text">'+n+"T\u8C46</span>"),e.push('<span class="wallet_dialog_msg_list_date">'+o+"</span>"),e.push("</li>")}0==t.length&&1==l&&(e.push('<div class="wallet_dialog_msg_empty">'),e.push("\u60A8\u8FD8\u6CA1\u6709T\u8C46\u5145\u503C\u8BB0\u5F55\uFF0C<br>T\u8C46\u53EF\u4EE5\u8D2D\u4E70\u8D34\u5427\u4F1A\u5458\u4EE5\u53CA\u4F17\u591A\u9177\u70AB\u7279\u6743\u9053\u5177\u3002<br>"),e.push('<a target="_blank" href="/tbmall/home">\u67E5\u770B\u7279\u6743\u9053\u5177&gt;&gt;</a>'),e.push("</div>")),e=e.join(""),$("#wallet_push_list_main").html(e)},_buildPager:function(a,l,t,e){var _=this;"function"==typeof e&&e.call(_,a,function(s){if(!(1>=s)){t=_.use("common/component/JsPager",$.extend(_._pager_option,{current:a,total:s,container:l})),t.bind("pageChange",function(a,s){_._buildPager.call(_,s,l,t,e)});var i=['<div class="wallet_js_pager_skip">','<input type="text" class="wallet_pager_skip_text j_wallet_pager_skip_text" placeholder="\u8DF3\u8F6C\u5230" value="'+a+'"/>','<a class="wallet_pager_skip_btn j_wallet_pager_skip_btn" href="#">\u8DF3\u8F6C</a>',"</div>"].join(""),o='<div class="wallet_js_pager_total">\u5171'+s+"\u9875</div>";$(o).prependTo(l);var n=$(i);n.on("click",".j_wallet_pager_skip_btn",function(i){i.preventDefault();var o=parseInt(n.find(".j_wallet_pager_skip_text").val());return o>s||0>=o?(n.find(".j_wallet_pager_skip_text").val(a),void 0):(_._buildPager.call(_,o,l,t,e),void 0)})}})},_buildInitHtml:function(a){var l=this,t=a.Parr_scores||[],e=a.Parr_props?a.Parr_props.level?a.Parr_props.level:[]:[],_=e.end_time?parseInt((new Date).valueOf()/1e3)>e.end_time?0:e.props_id:0,s=a.setpass,i=[];i.push('<div id="wallet_dialog_medal" style="position: relative" class="wallet_dialog_medal clearfix">'),_?1==e.props_id?(i.push('<span class="wallet_dialog_medal_text"><span class="showicon showicon_low"></span>\u4F1A\u5458\u4E13\u5C5E\u7279\u6743</span>'),i.push('<a class="btn_default btn_small  j_wallet_dialog_medal_btn" href="#">\u7EED\u8D39</a>')):(i.push('<span class="wallet_dialog_medal_text"><span class="showicon showicon_high"></span>\u4F1A\u5458\u4E13\u5C5E\u7279\u6743</span>'),i.push('<a class="btn_default btn_small  j_wallet_dialog_medal_btn" href="#">\u7EED\u8D39</a>')):(i.push('<a href="#" class="btn_sub btn_small wallet_dialog_medal_btn j_wallet_dialog_medal_btn"><span class="showicon showicon_high"></span>\u5F00\u901A\u4F1A\u5458</a>'),i.push('<span class="wallet_dialog_medal_text">\u5C0A\u4EAB\u7279\u6743</span>')),i.push("</div>"),i=i.join("");var o=this._getInfoHtml(t,s),n=this._getIntroHtml(),r=this._getMsgHtml(),d=['<div class="wallet_dialog_main clearfix" id="wallet_dialog_main">','<div class="wallet_dialog_user pull_left">',o,'<div class="wallet_dialog_user_power">',i,n,"</div>","</div>",r,"</div>"];l._html=d.join("")},_getIntroHtml:function(){var a=['<div class="wallet_dialog_power_list clearfix">','<a href="/tbmall/tshow?tab=detail&c=0"   target="_blank" class="wallet_dialog_power_item power_identity">\u5C0A\u8D35\u8EAB\u4EFD</a>','<a href="/tbmall/tshow?tab=detail&c=112" target="_blank" class="wallet_dialog_power_item power_nameplate">\u4E2A\u6027\u94ED\u724C</a>','<a href="/tbmall/tshow?tab=detail&c=110" target="_blank" class="wallet_dialog_power_item power_dress">\u70AB\u9177\u88C5\u626E</a>','<a href="/tbmall/tshow?tab=detail&c=103" target="_blank" class="wallet_dialog_power_item power_post">\u8DA3\u5473\u53D1\u8D34</a>','<a href="/tbmall/tshow?tab=detail&c=108" target="_blank" class="wallet_dialog_power_item power_magic">\u9B54\u6CD5\u9053\u5177</a>','<a href="/f?ie=utf-8&kw=\u767E\u5EA6\u6709\u94B1\u6D88\u8D39\u91D1\u878D" locate="\u8D34\u5427\u94B1\u5305#\u767E\u5EA6\u6709\u94B1" target="_blank" class="wallet_dialog_power_item power_umoney">\u767E\u5EA6\u6709\u94B1</a>',"</div>"].join("");return a},_parseInt:function(a){return a=parseInt(a),a>0?a:0>=a?a:0},_getInfoHtml:function(a,l){var t=this._parseInt(a.scores_money),e=this._parseInt(a.scores_other),_=this._parseInt(t+e),s=['<div class="wallet_dialog_user_info clearfix">','<div class="wallet_dialog_my_tbean">','<span class="wallet_dialog_tbean_label">\u6211\u7684T\u8C46\uFF1A</span>','<span class="wallet_dialog_tbean_num orange_text"><i class="icon_tbean"></i>'+_+"</span>","</div>",'<div class="wallet_dialog_recharge">','<a href="javascript:;" id="j_wallet_tcharge_dialog" class="btn_default btn_small">\u83B7\u53D6T\u8C46</a>','<a href="/tbmall/pass/set" class="wallet_dialog_paykey_set_btn" target="_blank">'+(l?"\u4FEE\u6539\u5BC6\u7801":"\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801")+"</a>","</div>","</div>"].join("");return s},_getMsgHtml:function(){var a=['<div class="wallet_dialog_msg pull_right">','<div class="wallet_dialog_tab clearfix" id="wallet_dialog_tab">','<a class="j_wallet_dialog_tab_item wallet_dialog_tab_item wallet_dialog_tab_current" attr-show="#wallet_tbmall_pop_list">\u5546\u57CE\u6D88\u8D39\u8BB0\u5F55</a>','<a class="j_wallet_dialog_tab_item wallet_dialog_tab_item" attr-show="#wallet_other_pop_list">\u5176\u4ED6\u6D88\u8D39\u8BB0\u5F55</a>','<a class="j_wallet_dialog_tab_item wallet_dialog_tab_item" attr-show="#wallet_push_list">\u5145\u503C\u8BB0\u5F55</a>',"</div>",'<div class="wallet_dialog_tbody">','<div class="j_wallet_dialog_msg_list clearfix wallet_dialog_msg_list wallet_tbmall_pop_list" id="wallet_tbmall_pop_list">','<ul id="wallet_tbmall_pop_list_main">',"</ul>",'<div class="clearfix"></div>','<div class="wallet_dialog_msg_pager clearfix" id="wallet_dialog_msg_tbmall_pop_pager"></div>',"</div>",'<div class="j_wallet_dialog_msg_list clearfix wallet_dialog_msg_list wallet_other_pop_list" id="wallet_other_pop_list">','<ul id="wallet_other_pop_list_main">',"</ul>",'<div class="clearfix"></div>','<div class="wallet_dialog_msg_pager clearfix" id="wallet_dialog_msg_other_pop_pager"></div>',"</div>",'<div class="j_wallet_dialog_msg_list clearfix wallet_dialog_msg_list wallet_push_list" id="wallet_push_list">','<ul id="wallet_push_list_main">',"</ul>",'<div class="clearfix"></div>','<div class="wallet_dialog_msg_pager " id="wallet_dialog_msg_push_pager"></div>',"</div>","</div>","</div>"].join("");return a}}});_.Module.define({path:"common/widget/flashLcs",requires:[],sub:{initial:function(n){this.options=$.extend({onMessage:function(){}},n),this.initFlash()},bindEvents:function(){},initFlash:function(){var n=!1,t="tblcs.baidu.com";n&&(t=$.tb.location.getHost().split(":")[0]);var o=this,s="http://tb2.bdstatic.com/tb/static-common/widget/flash_lcs/swf/tbLcs_eba73bf.swf";setTimeout(function(){o.communicator=new $.swf(s,{id:"tbLcsSwf",container:"#tbLcsContainer",width:1,height:1,vars:{callTarget:"msgFlashProxy",baiduid:"BAIDU_TIEBA_PC_LIVE_"+$.cookie("BAIDUID"),sbduss:PageData.lcs.sbduss,tabId:(new Date).getTime(),host:t}})},0);var i={log:function(n){try{$.debug&&window.console.log(n)}catch(t){}},onDisconnect:function(){this.log("onDisconnect")},onOnlineSuccess:function(){this.log("onOnlineSuccess")},onOnlineFail:function(){this.log("onOnlineFail")},onSocketConnect:function(){this.log("onSocketConnect")},autoOffLine:function(){this.log("autoOffLine")},onMessage:function(n){this.log("sendMessage",n),o.options.onMessage(n),o.communicator.remote("sendMessage",n)},onData:function(n){this.log("onData",n),this.log(n[n.length-1]),o.options.onMessage(n[n.length-1])},onNotify:function(){}};this.msgFlashProxy=i,window.msgFlashProxy=i}}});F.module("common/widget/eventCenter",function(){return $({})});_.Module.define({path:"common/widget/newMessageSystem",requires:["common/widget/flashLcs","common/widget/Userbar/DropDownList"],sub:{favUrl:{get:"/sysmsg/userpost/queryStoreUpdateNum",clear:"/sysmsg/userpost/clearStoreUpdateNum"},favData:{type:"favts",category_name:"\u6211\u7684\u6536\u85CF",unread_count:0,category_href:"&type=storethread"},notifyData:[],messageData:[{type:"",category_name:"\u67E5\u770B\u79C1\u4FE1",unread_count:0,category_href:"http://msg.baidu.com/"}],msgType:{reply:"1",atme:"2",friendapply:"3",fans:"4"},setNotifyStorage:function(e){$.tb.Storage.set(this.localStorageKey,$.json.encode(e),this.expire)},initial:function(){this.$el=$(".userbar .u_news");var e=$('<div class="u_menu_item u_menu_news"><a href="#" class="u_menu_wrap u_news_wrap j_news" onclick="return false;"><span></span></a></div>'),t=this.requireInstance("common/widget/Userbar/DropDownList",[this.$el,e]);this.$newsTips=e.find(".j_news span"),this.localStorageKey="notifyData"+PageData.user.id,this.expire=(new Date).getTime()+18e5,this.eventCenter=this.require("common/widget/eventCenter"),this.$el.append(e);var a=baidu.template("u_notify",{portrait:PageData.user.portrait});t.innerContent("top",a),this.$categoryList=this.$el.find(".j_category_list"),this.$systemNotifyList=this.$categoryList.eq(1),this.$systemMessageCountSpan=this.$el.find(".j_category_item_last .unread_num"),this.initLcs(),this.fetchNotifyList(),this.bindEvents()},initLcs:function(){var e=this;e.use("common/widget/flashLcs",{onMessage:function(t){var a=t.ueg;e.notifyData=a,e.renderNotify(a,1),e.setNotifyStorage(a),e.eventCenter.trigger("sysmsg.upmsg",t)}})},fetchNotifyList:function(){var e=this,t=$.tb.Storage.get(this.localStorageKey),a=$("<a href="+document.referrer+"></a>")[0].host;return t&&document.referrer&&$.tb.location.getHost()===a?(t=$.json.decode(t),e.notifyData=t,e.renderNotify(t,1),void 0):($.getJSON("/sysmsg/query/userunread",function(t){var a=t.data;0===t.errno&&(e.renderNotify(a,1),e.notifyData=a,e.setNotifyStorage(a))}),void 0)},initMessagePanel:function(e){var t=this,a=[{type:"reply",category_name:"\u67E5\u770B\u56DE\u590D",unread_count:e[3]||0,category_href:"&type=replyme"},{type:"atme",category_name:"\u67E5\u770B@\u63D0\u5230\u6211",unread_count:e[8]||0,category_href:"&type=atme"},{type:"friendapply",category_name:"\u67E5\u770B\u597D\u53CB\u7533\u8BF7",unread_count:e[21]||0,category_href:"&type=friendapply"},{type:"fans",category_name:"\u67E5\u770B\u65B0\u7C89\u4E1D",unread_count:e[0]||0,category_href:"&type=fans"}];a.push(this.favData),$.each(a,function(e,t){a[e].category_href="/i/sys/jump?u="+PageData.user.portrait+t.category_href}),a=[this.messageData[0]].concat(a),this.messageData=a,this.getFavNum(function(){t.renderNotify(t.messageData,0)})},renderNotify:function(e,t){0===t&&this.$categoryList.eq(t).html(baidu.template("u_notify_item",{list:e})),this.renderNotifyTips()},renderNotifyTips:function(){var e=this.getTotalMessageCount(),t=this.getSystemMessageCount();this.$systemMessageCountSpan.html(t),this.$newsTips.html(e),t?this.$systemMessageCountSpan.show():this.$systemMessageCountSpan.hide(),e>0?this.$newsTips.show():this.$newsTips.hide()},getTotalMessageCount:function(){var e=0;return e=this.getNotifyMessageCount()+this.getSystemMessageCount()},getNotifyMessageCount:function(){var e=0;return $.each(this.messageData,function(t,a){e+=parseInt(a.unread_count,10)}),e},getSystemMessageCount:function(){var e=0;return $.each(this.notifyData,function(t,a){e+=parseInt(a.unread_count,10)}),e},bindEvents:function(){var e=this;e.eventCenter.bind("sysmsg.readmsg",function(t,a){for(var s=0,n=e.notifyData.length;n>s;s++){var r=e.notifyData[s];if(a.category_id==r.category_id){r.unread_count=parseInt(r.unread_count,10)-1,r.unread_count<0&&(r.unread_count=0),e.renderNotify(e.notifyData,1),this.setNotifyStorage(e.notifyData);break}}}),TbCom.on("msgsystem_initall",function(t){e.initMessagePanel(t)}),TbCom.on("msgsystem_message",function(t){t=t[1]||{};var a=t.type,s=t.content;a&&"undefined"!=typeof s&&("all_msg"!==a?(e.messageData[e.msgType[a]].unread_count=parseInt(s,10),e.renderNotify(e.messageData,0)):e.initMessagePanel(s.split(",")))}),TbCom.on("msgsystem_listencomplete",function(){}),TbCom.process("User","requestUserMessage",function(t){t&&(e.messageData[0].unread_count=t.msgnum,e.renderNotify(e.messageData,0))}),e.$categoryList.on("click",".j_cleardata",function(t){var a=$(t.currentTarget),s=a.tbattr("data-type");return"favts"===s?(e.clearFavNum(),void 0):(s&&TbCom.process("UserMessage","clearData",s),void 0)})},getFavNum:function(e){var t=this;$.get(this.favUrl.get,function(a){if(0===a.errno){t.favData.unread_count=a.num;var s=t.messageData[5];s&&(s.unread_count=a.num),t.renderNotify(t.messageData,0)}return $.isFunction(e)?(e.apply(t),void 0):void 0})},clearFavNum:function(){var e=this;$.get(this.favUrl.clear,function(t){if(0===t.errno){e.favData.unread_count=0;var a=e.messageData[5];a&&(a.unread_count=0),e.renderNotify(e.messageData,0)}})}}});_.Module.define({path:"common/widget/messenger",requires:["common/widget/messenger/messengerProcesser","common/widget/messenger/messengerTarget"],sub:{initial:function(e,n){if(!e)throw new Error("Messenger name must be asigned");var s=n||"[PROJECT_NAME]";this.name=e,this.prefix=s.toString(),this.supportPostMessage="postMessage"in window,this.origins=[],this.processer=this.requireInstance("common/widget/messenger/messengerProcesser"),this.targets={},this._initListen()},addTarget:function(e,n){this.targets[n]=this.requireInstance("common/widget/messenger/messengerTarget",[this.prefix,e,n])},registerCommand:function(e){this.processer.registerCommand(e)},registerOrigin:function(e){var n=0;for("string"==typeof e&&(e=[e]),n;n<e.length;n++)this.origins.push(e[n])},send:function(e){var n,s=this.targets;for(n in s)s.hasOwnProperty(n)&&s[n].send(e)},_warn:function(e){window.console&&window.console.warn&&window.console.warn(e)},_initListen:function(){var e=this,n=function(n){var s="";if("object"==typeof n){if(!n.data||"string"!=typeof n.data)return window.console&&console.warn("The received message is not type of string"),void 0;if(s=n.data,/^ignoredProject/.test(s))return;if(s.substring(0,e.prefix.length)!==e.prefix)return window.console&&console.warn("The msg type is not avaliable in project "+e.prefix),void 0;if(n.origin&&!e._checkOrigin(n.origin))return window.console&&console.warn("The post origin is not avaliable in project "+e.prefix),void 0}else if(s=n,/^ignoredProject/.test(s))return;s=s.slice(e.prefix.length),s=e._escapeHTML(s);try{s=$.parseJSON(s)}catch(i){throw new Error("The JSON string is not valid")}var r=e.processer.process(s)||{};s.command&&s.shake&&s.shake_id&&e.send($.json.encode({command:s.command+"@"+s.shake_id+"@success",shake:!0,shake_id:s.shake_id,data:r}))};window.messenger=e,this.supportPostMessage?"addEventListener"in document?window.addEventListener("message",n,!1):"attachEvent"in document&&window.attachEvent("onmessage",n):window.navigator[this.prefix+this.name]=n},_escapeHTML:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\s/g,"&nbsp;").replace(/\\"/g,"&quot;")},_checkOrigin:function(e){var n=0,s=this.origins.length;for(n;s>n;n++)if(this.origins[n]===e)return!0;return!1}}});
;_.Module.define({path:"common/widget/messenger/messengerProcesser",requires:[],sub:{_failCommandCacheList:{},initial:function(){this.commandMap={common_login:$.proxy(this.common_login,this),common_register:$.proxy(this.common_register,this),exception_all:$.proxy(this.exception_all,this)}},registerCommand:function(o){this.checkExistCommand(o)&&(this.commandMap=$.extend(this.commandMap,o)),this.processFailCommand(o)},checkExistCommand:function(o){var n;for(n in o)if(o.hasOwnProperty(n)&&n in this.commandMap)return window.console&&console.warn('The command "'+n+'" is already exist'),void 0;return!0},processFailCommand:function(o){var n;for(n in o){var i=this._failCommandCacheList[n];o.hasOwnProperty(n)&&i&&this.process(i)}},process:function(o){if(!(o.command&&o.command in this.commandMap))return this._failCommandCacheList[o.command]=o,window.console&&console.warn("Please check or register the data processing command"),void 0;var n=this.commandMap[o.command];return n(o.data)},common_login:function(){PageData&&PageData.user&&!PageData.user.is_login&&this.requireInstanceAsync("common/widget/LoginDialog",[],function(){})},common_register:function(o){var n=o.return_url||"http://tieba.baidu.com",i="https://passport.baidu.com/v2/?reg&tpl=tb&u="+n;window.open(i)},exception_all:function(){throw new Error("Processing data exception")}}});
;_.Module.define({path:"common/widget/messenger/messengerTarget",requires:[],sub:{initial:function(e,t,r){var i="";if(arguments.length<3?i="Target error: target and name are both requied":"object"!=typeof t?i="Target error: target itself must be window object":"string"!=typeof r&&(i="Target error: target name must be string type"),i)throw new Error(i);this.prefix=e,this.target=t,this.name=r},send:function(e){var t="postMessage"in window;if(t)this.target.postMessage(this.prefix+e,"*");else{var r=window.navigator[this.prefix+this.name];if("function"!=typeof r)throw new Error("Target error: target callback function is not defined");var i=$.tb.location,o={origin:i.getProtocol()+"//"+i.getHost(),data:this.prefix+e};r(o,window)}}}});_.Module.define({path:"common/widget/baseUserData",requires:[],sub:{initial:function(){},route:{getTdou:"http://tieba.baidu.com/tbmall/getUserTd"},_item_cache_last_total_tdou:0,_parrScores:null,_parrProps:null,getUserName:function(){return PageData.user.name||PageData.user.name_url},getUserTdou:function(){var e=PageData.user,r=this._parrScores||e.Parr_scores;return r?r.scores_money+r.scores_other:0},getShowName:function(){return PageData.user.name_show||PageData.user.user_name},isMemeber:function(){var e=this._parrProps||PageData.user.mParr_props||PageData.user.Parr_props,r=this._getMaxLevel(e);return!!r},getMemberLevel:function(){var e=this._parrProps||PageData.user.mParr_props||PageData.user.Parr_props,r=this._getMaxLevel(e);return r},getMemberIcon:function(){var e=this._parrProps||PageData.user.mParr_props||PageData.user.Parr_props,r=this._getMaxLevelExpire(e),a=this.getMemberIconByLevel(r);return a},getMemberIconByLevel:function(e){e&&(e=parseInt(e));var r="",a="",t="";switch(e){case 1:r=" ordinary_member_icon",a="\u8D34\u5427\u4F1A\u5458",t="\u7EED\u8D39\u8D34\u5427\u4F1A\u5458";break;case-1:r=" ordinary_member_icon_expire",a="\u7EED\u8D39\u8D34\u5427\u4F1A\u5458",t="\u5F00\u901A\u8D34\u5427\u4F1A\u5458";break;case-2:r=" super_member_icon_expire",a="\u7EED\u8D39\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458",t="\u5F00\u901A\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458";break;case 2:r=" super_member_icon",a="\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458",t="\u7EED\u8D39\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458";break;default:e=0,r="",t="\u5F00\u901A\u4F1A\u5458",a="\u5F00\u901A\u4F1A\u5458"}var s={level:e,icon:r,title:a,action_title:t};return s},isLogin:function(){return PageData.user.is_login},needUpdateTdou:function(){var e=PageData.user.mParr_props||PageData.user.Parr_props,r=PageData.user.Parr_scores;return!(e&&r)},_getMaxLevel:function(e){var r=0,a=(new Date).getTime(),t=e||PageData.user.Parr_props;if(!t||!t.level)return 0;var s=t.level;return 1e3*s.end_time>a&&parseInt(s.props_id,10)>r&&(r=parseInt(s.props_id,10)),r},_getMaxLevelExpire:function(e){var r=0,a=(new Date).getTime(),t=e||PageData.user.Parr_props;if(!t||!t.level)return 0;var s=t.level;return parseInt(s.props_id,10)>r&&(r=parseInt(s.props_id,10),1e3*s.end_time<=a&&(r=0-r)),r},getTdou:function(e,r){var a=this;a._get_tdou_ajax&&a._get_tdou_ajax.abort(),a._get_tdou_ajax=$.ajax({type:"get",url:a.route.getTdou+"?"+new Date,data:{},cache:!1,dataType:"json"}).success(function(a){e.call(r,a)})}}});_.Module.define({path:"common/widget/cashierDialog",requires:["common/widget/messenger"],sub:{sub_iframe_name:"cashier_dialog_iframe",windowId:"window_iframe_app_"+(new Date).getMilliseconds(),_iframe_dialog:null,initial:function(){this.dataProxy=this.requireInstance("common/widget/baseUserData"),this.member=this.dataProxy.getMemberIcon()},getTpl:function(){var e='<div class="cashier_dialog base_user_data"><div class="cashier_dialog_header"><div class="header_title"><span class="header_icon"></span>#{title}</div><div class="user_info"><span class="title_acc">\u8D26\u53F7\uFF1A<span class="#{member} j_member_icon"></span><a class="title_acc_name j_member_red">#{user_name}</a></span><span class="title_remain">T\u8C46\u4F59\u989D\uFF1A<span class="title_remain_num"><span class="user_tdou_icon"></span><span  class="j_tdou">#{tdou_num}<span></span></span></span></div><a class="header_close j_header_close"></a></div><div class="tdou_cashier_wrap" id="tdou_cashier_wrap"><iframe id="cashier_dialog_iframe" class="cashier_dialog_iframe" src="#{cashier_url}" frameborder="0" style="border: 0"></iframe></div></div>';return e},buildCashierIframe:function(e){return $.tb.format(this.getTpl(),e)},showDialog:function(e){var a=this;a._iframe_dialog&&$(".tdou_member_cashier_iframe_dialog").remove(),this.options=e||{},PageData.pay_fr=e.fr,PageData.pay_track=e.track;var i=e.cashier_url,s=this.member.action_title,r={user_name:this.dataProxy.getUserName(),tdou_num:0,member:this.member.icon,cashier_url:i,title:s||"\u5F00\u901A\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458"},t=a.buildCashierIframe(r),n={modal:!0,showTitle:!1,fixed:!0,width:726,height:624,hideOnclose:!1,holderClassName:"tdou_member_cashier_iframe_dialog",draggable:!0,html:t};a._iframe_dialog=new $.dialog(n),a._iframe_dialog.show(),("ordinary_member_icon"==$.trim(this.member.icon)||"super_member_icon"==$.trim(this.member.icon))&&a._iframe_dialog.element.find(".j_member_red").addClass("member_red"),a.updateTdou(),a.wrap=a._iframe_dialog.element,PageData.tdou_dianquan_iframe_dialog=a._iframe_dialog,a.track("show"),a.bindEvent(),a.initMessager()},bindEvent:function(){var e=this;e.wrap.find(".j_header_close").on("click",function(){e.closeMain()})},closeMain:function(){var e=PageData.tdou_dianquan_iframe_dialog;e&&e.close(),delete PageData.tdou_dianquan_iframe_dialog,this.track("\u5173\u95ED\u7A97\u53E3")},initMessager:function(){var e=this;if(!e.MessageInstance){e.MessageInstance=e.requireInstance("common/widget/messenger",[e.windowId,"tdou_pay"]);var a=window.document.getElementById(e.sub_iframe_name);e.MessageInstance.addTarget(a.contentWindow,e.sub_iframe_name);var i=["http://db.baidu.com","http://pay.baidu.com"];e.MessageInstance.registerOrigin(i),e.MessageInstance.registerCommand({encourage_dianquan_readystatechange:$.proxy(e.onReadyStateChange,this),encourage_dianquan_close:$.proxy(e.onClose,this)})}},sendMessage:function(e){var a=this;if(a.MessageInstance){var i="";"object"==typeof e&&(i=JSON.stringify(e)),a.MessageInstance.targets[a.sub_iframe_name].send(i)}},onReadyStateChange:function(e){if(e)switch(e.status){case 2e3:this.updateMember(e.data),this.track("\u652F\u4ED8\u6210\u529F");break;case 3e3:this.onClose();break;case 3001:this.onClose(),this.track("\u518D\u6B21\u8D2D\u4E70")}},onClose:function(){this.closeMain()},updateTdou:function(){var e=this;e.dataProxy.getTdou(function(e){if(e&&0===e.no){var a=e.data.Parr_scores,i=a?a.scores_money+a.scores_other:0;$(".tdou_member_cashier_iframe_dialog .j_tdou").html(i)}},this)},updateMember:function(e){var a=this,i=a.dataProxy.getMemberIconByLevel(e.user_level);$(".tdou_member_cashier_iframe_dialog .j_member_icon").addClass(i.icon);var s=e.user_level;s&&(s=parseInt(s),s>0&&$(".tdou_member_cashier_iframe_dialog .j_member_red").addClass("member_red"))},track:function(e){$.stats.track(PageData.pay_track||"memberpay","cashierDialog-"+PageData.pay_fr,PageData.product,e||"click")}}});_.Module.define({path:"common/widget/qianbaoCashierDialog",requires:["common/widget/baseUserData"],sub:{iframeContainerId:"qianbao_cashier_payment_channel_wrap",qianbaoLbscashierUrl:"http://zhifu.baidu.com/static/js/pc/iframe/lbscashier-iframe.js?t="+(new Date).getTime(),services:{createOrder:"/tbmall/getPayUrl",getOrder:"/tbmall/getorder"},initial:function(){this.dataProxy=this.requireInstance("common/widget/baseUserData")},createMain:function(a,e){var t=this;PageData.qianbao_cashier=t,t.setLoading(),$.isFunction(e)&&e(t.$root),t.changeoPayAmount(a),t.qianbao_params_json=t.getParams(a)},buildCashier:function(a){var e=this;e.cashier?e.cashier.updateOrder(a):e.cashier=new window.lbscashier({onmessage:e.onMessage,containerId:e.iframeContainerId,data:a,height:423})},onMessage:function(a){var e=PageData.qianbao_cashier;if(!a)return console.log("onmessage null"),void 0;var t=a.type,i=a.data;if("updateOrder"==t)e.clearPayLoading();else if("pay"==t)switch(i){case"submit":e.showPaymentTip(),e.track("pay-submit");break;case"addcard":break;case"success":e.track("pay-success");break;default:console.log("qianbao-pay-\u65E0\u6CD5\u5904\u7406\u7684\u6D88\u606F\u6570\u636E")}e.clearLoading()},showDialog:function(a,e,t){var i=this,n=a.qianbao_params;i.product=a.product,$.JsLoadManager.loadUrl(i.qianbaoLbscashierUrl,function(){i.buildDialog(e),i.createMain(n,t)})},buildDialog:function(a){var e=this;e._iframe_dialog&&$(".qianbao_cashier_iframe_dialog").remove();var t=e.getDialogTpl(a),i={modal:!0,showTitle:!1,fixed:!0,width:717,height:624,hideOnclose:!1,holderClassName:"qianbao_cashier_iframe_dialog",draggable:!0,html:t};e._iframe_dialog=new $.dialog(i),e._iframe_dialog.show(),e.$root=e._iframe_dialog.element,e.track("show")},getDialogTpl:function(a){var e=this,t='<div class="qianbao_cashier_dialog j_qianbao_cashier_dialog"><div class="loading j_qianbao_cashier_loading">      <table height="100%" width="100%">          <tbody><tr>              <td valign="middle" align="center">                  <img src="http://pay.baidu.com/resource/common/images/charging.gif">                  <p class="j_loading_text">\u52A0\u8F7D\u4E2D...</p>              </td>          </tr>          </tbody></table>  </div><div class="qiaobao_pay_loading j_pay_loading">      <table height="100%" width="100%">          <tbody>          <tr>              <td valign="middle" align="center">                  <img src="http://pay.baidu.com/resource/common/images/charging.gif">                    <p class="j_loading_text">\u52A0\u8F7D\u652F\u4ED8\u9875\u9762...</p>              </td>          </tr>          </tbody>      </table>  </div><div class="qianbao_cashier_payment_goods_wrap">#{goodsShowTpl}</div><div class="qianbao_cashier_payment_channel_wrap" id="'+e.iframeContainerId+'"></div></div>',i={goodsShowTpl:a};return t=$.tb.format(t,i)},changeoPayAmount:function(a){var e=this,t=a;e.buildCashier(t)},closeDialog:function(){var a=this,e=a._iframe_dialog;e&&e.close(),delete PageData.qianbao_cashier,a.cashier=null,clearTimeout(a.timerId),a.track("\u5173\u95ED\u7A97\u53E3")},getParams:function(a){var e={};if(!a)return e;var t=/orderId=[^&]*/,i=t.exec(a);if(1==i.length){var n=i[0].split("=");e.orderId=n[1]||""}return e},getPageUrl:function(){var a=$.tb.location.getHref();return a=a.replace(/&customerId=.*|\?customerId=.*/g,"")},checkPaymentResult:function(){var a=this;a.getPaymentResult(function(e){a.showPaymentSuccess(e)},function(e){a.showPaymentFailure(e)})},getPaymentResult:function(a,e){var t=this,i={order_id:t.qianbao_params_json.orderId},n={product:t.product,userName:t.dataProxy.getUserName()};t._checkPaymentResult&&t._checkPaymentResult.abort(),t._checkPaymentResult=$.ajax({type:"GET",url:t.services.getOrder,data:i,dataType:"json"}).success(function(t){var i=t.data.db_money||0;i/=100,n=$.extend(n,{payAmount:i.toFixed(2)});var o=t.data.member_info;if(o){var s="yyyy-MM-dd",r=1e3*parseInt(o.create_time),l=1e3*parseInt(o.end_time);n=$.extend(n,{create_time:$.dateFormat(new Date(r),s),end_time:$.dateFormat(new Date(l),s)})}0==t.no?a&&a(n):e&&e(n)})},setLoading:function(a){var e=this,t={loading:"\u52A0\u8F7D\u4E2D...",paying:"\u5F88\u52AA\u529B\u7684\u5145\u503C\u4E2D..."},i=e.$root.find(".j_qianbao_cashier_loading");i.show(),i.find(".j_loading_text").html(t[a]||t.loading)},clearLoading:function(){var a=this,e=a.$root.find(".j_qianbao_cashier_loading");1==e.length&&e.hide()},showPaymentTip:function(){var a=this,e=a.$root.find(".j_qianbao_payment_tip");1==e.length?e.show():(a.$root.find(".j_qianbao_cashier_dialog").append($('<section class="qianbao_payment_tip j_qianbao_payment_tip ">      <div class="tip_dialog">          <div class="tip_dialog_content">              <p class="description">\u8BF7\u5728\u65B0\u6253\u5F00\u9875\u9762\u4E0A\u5B8C\u6210\u5145\u503C\uFF0C\u4ED8\u6B3E\u5B8C\u6210\u524D\u8BF7\u4E0D\u8981\u5173\u95ED\u6216\u5237\u65B0\u6B64\u7A97\u53E3</p>                <div class="center">                  <a class="btn_default btn_sub btn_larger j_close qianbao_pay_tip_btn j_try_pay_again" style="margin-right: 20px;">\u5931\u8D25\uFF0C\u91CD\u65B0\u652F\u4ED8</a>                  <a class="btn_default btn_larger btn_attention j_pay_ok qianbao_pay_tip_btn">\u652F\u4ED8\u6210\u529F</a>              </div>          </div>          <span class="tip_dialog_close j_close"></span>      </div>      <span class="middle-helper"></span>  </section>')),e=a.$root.find(".j_qianbao_payment_tip")),e.find(".j_close").on("click",function(){a.getPaymentResult(function(e){a.showPaymentSuccess(e),a.hidePaymentTip()},function(){a.closeDialog(),a.trigger("event_tdou_qianbao_pay_again")})}),e.find(".j_pay_ok").on("click",function(){a.checkPaymentResult(),a.hidePaymentTip()})},hidePaymentTip:function(){var a=this,e=a.$root.find(".j_qianbao_payment_tip");e&&e.hide()},showPayLoading:function(){var a=this,e=a.$root.find(".j_pay_loading");e.show(),e.find(".j_loading_text").html("\u52A0\u8F7D\u4E2D...")},clearPayLoading:function(){var a=this,e=a.$root.find(".j_pay_loading");1==e.length&&e.hide()},showPaymentSuccess:function(a){var e=this,t=baidu.template('<div class="qiaobao_pay_result_dialog j_qiaobao_pay_result_dialog">      <div class="result_title">          <span class="result_pic success_pic"></span>          <span class="result_txt">\u5145\u503C\u6210\u529F\uFF01</span>      </div>        <%if(product == \'tdou\'){%>      <p><label>\u8D26\u53F7\uFF1A<%=userName%></label></p>        <p><label>\u652F\u4ED8\u91D1\u989D\uFF1A<span class="pay_amount"><%=payAmount%></span></label>\u5143</p>      <%}else if(product == \'member\'){%>      <p><label>\u4F1A\u5458\u8D77\u59CB\u65E5\u671F\uFF1A<span class="member_date"><%=create_time%></span></label></p>        <p><label>\u4F1A\u5458\u7ED3\u675F\u65E5\u671F\uFF1A<span class="member_date"><%=end_time%></span></label></p>      <%}%>        <p><label><span class=" second j_second">5</span>\u79D2\u540E\u5173\u95ED\u7A97\u53E3</label></p>        <div class="button_container">          <a class="btn_default btn_sub btn_larger qianbao_pay_result_btn j_continue_pay "             style="margin-right: 30px;display: none">\u7EE7\u7EED\u8D2D\u4E70</a>          <a class="btn_default btn_larger btn_attention qianbao_pay_result_btn j_close ">\u5173\u95ED\u7A97\u53E3</a>      </div>  </div>',a);e.showPaymentResult(t)},showPaymentFailure:function(a){var e=this,t=baidu.template('<div class="qiaobao_pay_result_dialog j_qiaobao_pay_result_dialog">      <div class="result_title">          <span class="result_pic fialed_pic"></span>          <span class="result_txt">\u5145\u503C\u5931\u8D25\uFF01</span>      </div>          <p><label>\u8D26\u53F7\uFF1A<%=userName%></label></p>        <p><label>\u652F\u4ED8\u91D1\u989D\uFF1A<span class="pay_amount"><%=payAmount%></span></label>\u5143</p>          <p><label><span class="second j_second">5</span>\u79D2\u540E\u5173\u95ED\u7A97\u53E3</label></p>        <div class="button_container">          <a class="btn_default btn_sub btn_larger qianbao_pay_result_btn j_close " style="margin-right: 30px">\u5173\u95ED\u7A97\u53E3</a>          <a class="btn_default btn_larger btn_attention qianbao_pay_result_btn j_repay ">\u91CD\u65B0\u652F\u4ED8</a>      </div>  </div>',a);e.showPaymentResult(t)},showPaymentResult:function(a){var e=this;e.$root.find(".j_qianbao_cashier_dialog").append($(a)),e.$root.on("click",".j_qiaobao_pay_result_dialog .j_close",function(){e.closeDialog()}).on("click",".j_qiaobao_pay_result_dialog .j_repay",function(){e.closeDialog(),e.trigger("event_tdou_qianbao_pay_again")});var t=e.$root.find(".j_qiaobao_pay_result_dialog .j_second"),i=5,n=function(){return i--,0==i?(e.closeDialog(),void 0):(t.html(i),e.timerId=setTimeout(n,1e3),void 0)};e.timerId=setTimeout(n,1e3)},track:function(a,e,t){var i=this;$.stats.track(a,e||"qianbaoCashierDialog-"+i.product,PageData.product+"-"+(t||"qianbao-cashier-"+i.product),"click")}}});_.Module.define({path:"common/widget/baseDialogUserBar",requires:["common/widget/baseUserData"],sub:{tpl:'<div class="base_dialog_user_bar base_user_data">      <div class="header_title">          <span class="header_icon"></span>          <span><%=title%></span>      </div>      <div class="user_info">              <span class="title_acc">\u8D26\u53F7\uFF1A                  <span class="<%=member%> j_member_icon"></span>                  <a class="title_acc_name <%=member_red%> "><%=user_name%></a>              </span>              <%if(is_tdou_info_display){%>              <span class="tdou_remain">T\u8C46\u4F59\u989D\uFF1A                  <span class="tdou_remain_num">                      <span class="user_tdou_icon"></span>                      <span class="j_tdou"><%=tdou_num%></span>                  </span>                  </span>          <%}%>      </div>      <a class="header_close j_header_close"></a>  </div>',initial:function(){this.dataProxy=this.requireInstance("common/widget/baseUserData"),this.member=this.dataProxy.getMemberIcon()},getUserBarTemplate:function(e){var a=this,s="",r=!0;e&&"getmember"==e?(s=a.member.action_title,r=!1):s="\u83B7\u53D6T\u8C46";var t="";("ordinary_member_icon"==$.trim(a.member.icon)||"super_member_icon"==$.trim(a.member.icon))&&(t=" member_red ");var i={user_name:a.dataProxy.getUserName(),tdou_num:a.dataProxy.getUserTdou(),member:a.member.icon,member_red:t,title:s,is_tdou_info_display:r},n=baidu.template(a.tpl,i);return n}}});_.Module.define({path:"common/widget/qianbaoPurchaseMember",requires:["common/widget/qianbaoCashierDialog","common/widget/baseUserData","common/widget/baseDialogUserBar"],sub:{$root:null,memberOptions:null,initial:function(){var e=this;e.cashierDialog=e.requireInstance("common/widget/qianbaoCashierDialog"),e.baseData=e.requireInstance("common/widget/baseUserData"),e.baseDialogUserBar=this.requireInstance("common/widget/baseDialogUserBar"),e.vip3Src="http://tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/tb-vip3_ce04181.png",e.vip4Src="http://tb2.bdstatic.com/tb/static-common/widget/qianbao_purchase_member/images/tb-vip4_d9b7cf1.png",e.return_url=e.cashierDialog.getPageUrl(),e.cashierDialog.bind("event_tdou_qianbao_pay_again",e.payAgain,e)},payAgain:function(){var e=this;e.showDialog(e.memberOptions)},showDialog:function(e){var t=this;t.product=e.product||"member",t.memberOptions=e,t.member=t.baseData.getMemberIcon(),1==t.member.level||-1==t.member.level?(t.initMemberId="1050001",t.initMemberCount="1"):(t.initMemberId="1050002",t.initMemberCount="1"),t.getPayMemberOrder(t.initMemberId,t.initMemberCount,function(e){var a={qianbao_params:e};t.showMember(a);var i=t.cashierDialog.getParams(e);t.orderId=i.orderId})},showMember:function(e){var t=this,a=e.qianbao_params||"",i=$.extend(e,{baseDialogUserBarTpl:t.baseDialogUserBar.getUserBarTemplate("getmember"),vip3Src:t.vip3Src,vip4Src:t.vip4Src,type_1050001:2==t.member.level||-2==t.member.level?" hide_type_1050001":""}),r=$.tb.format('<div class="qianbao_cashier_purchase_member base_user_data">      #{baseDialogUserBarTpl}      <div class="member_cashier_wrap j_member_cashier_wrap" id="member_cashier_wrap">          <div class="member_wrap">              <label class="goods_title">\u9009\u62E9\u4F1A\u5458\uFF1A</label>              <ul class="member_list j_member_list">                  <li class="member_item j_order_update j_type_1050001 #{type_1050001}">                      <label class="member-type" id="ptype-1050001" data-name="\u8D34\u5427\u4F1A\u5458" data-value="1050001">                            <img src="#{vip3Src}">                          \u8D34\u5427\u4F1A\u5458                      </label>                  </li>                  <li class="member_item recommend j_order_update  j_type_1050002">                      <label class="member-type" id="ptype-1050002" data-name="\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458" data-value="1050002">                          <img src="#{vip4Src}">\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458                      </label>                  </li>              </ul>              <div class="form-explain default" style="display: none;"></div>              <div class="form-explain priority" style="display: none;">\u5F00\u901A\u4F1A\u5458\u540E\uFF0C\u60A8\u5C06\u4F18\u5148\u4EAB\u53D7\u8D85\u7EA7\u4F1A\u5458\u7279\u6743\uFF0C\u8D85\u7EA7\u4F1A\u5458\u8FC7\u671F\u540E\u7EE7\u7EED\u4EAB\u53D7\u539F\u666E\u901A\u4F1A\u5458\u7279\u6743</div>          </div>          <div class="member_time_wrap">              <label class="goods_title time-title">\u9009\u62E9\u65F6\u957F\uFF1A</label>              <ul class="time_list j_time_list">                  <li class="time_item  j_order_update j_time_item" style="display: list-item;">                      <label class="time-type" for="vip_month_1" id="vip_month_1" data-value="1">                          1\u4E2A\u6708                      </label>                  </li>                  <li class="time_item j_order_update j_time_item" style="display: list-item;">                      <label  class="time-type" for="vip_month_3" id="vip_month_3" data-value="3">                          3\u4E2A\u6708                      </label>                  </li>                  <li class="time_item j_order_update j_time_item" style="display: list-item;">                      <label  class="time-type" for="vip_month_6" id="vip_month_6" data-value="6">                          6\u4E2A\u6708                      </label>                  </li>                  <li class="time_item j_order_update j_time_item j_vip_month_12" style="display: list-item;">                      <label  class="time-type" for="vip_month_12" id="vip_month_12" data-value="12">                          12\u4E2A\u6708                      </label>                  </li>                  <li class="custum_time j_custum_time">                      <label for="month-custum" class="month_custum">                          <input type="text" class="ui-input "                                 name="month-custum" id="month-custum"                                 placeholder="\u5176\u4ED6">\u4E2A\u6708                      </label>                  </li>              </ul>              <div class="form-error"></div>          </div>      </div>      </div>',i),o={qianbao_params:a,product:"member"};t.cashierDialog.showDialog(o,r,function(e){t.$root=e,t.initUI(t.initMemberId,t.initMemberCount),t.bindEvents()})},initUI:function(e,t){var a=this;a.selectedUI(e,t)},selectedUI:function(e,t){var a=this;a.$root.find(".j_member_list li").removeClass("selected"),a.$root.find(".j_type_"+e).addClass("selected"),a.$root.find(".j_time_list li").removeClass("selected");var i=a.$root.find("#vip_month_"+t);i.length?(i.parents("li.j_time_item").addClass("selected"),a.$root.find("#month-custum").val("")):a.$root.find(".j_custum_time").addClass("selected")},updatePayUI:function(e,t){var a=this;a.cashierDialog.showPayLoading(),e&&t&&a.getPayMemberOrder(e,t,function(e){a.cashierDialog.changeoPayAmount(e)})},bindEvents:function(){var e=this,t=120;e.$root.find(".j_order_update").on("click",function(t){t.stopPropagation(),t.preventDefault();var a=$(t.target),i="",r="";a.hasClass("member-type")?(i=a.data("value"),r=e.$root.find(".j_time_list li.selected .time-type").data("value"),r||(r=e.$root.find("#month-custum").val())):a.hasClass("time-type")&&(e.$root.find("#month-custum").val(""),r=a.data("value"),i=e.$root.find(".j_member_list li.selected .member-type").data("value")),e.selectedUI(i,r),e.updatePayUI(i,r)}),e.$root.find("#month-custum").on("input propertychange",function(){var a=/^[1-9]\d*$/,i=$(this),r=i.val();(r&&!a.test(r)||a.test(r)&&r>t)&&(r=r.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),r=Math.min(t,r),0==r&&(r=1),i.val(r),e.showCustomMonthBubble());var o=e.$root.find(".j_member_list li.selected .member-type").data("value");e.updatePayUI(o,r)}).on("focus",function(){e.$root.find(".j_time_list li").removeClass("selected"),e.$root.find(".j_custum_time").addClass("selected"),e.cashierDialog.showPayLoading()}),e.$root.find(".j_header_close").on("click",function(){e.cashierDialog.closeDialog()}),e.$root.find(".j_vip_month_12").hover(function(){e.showMonth12Bubble()},function(){e.hideMonth12Bubble()})},getPayMemberOrder:function(e,t,a){var i=this,r={terminal:"pc",pay_type:1,channel:2,memberId:e,memberCount:t,pageUrl:i.return_url};i._getPayMemberAjax&&i._getPayMemberAjax.abort(),i._getPayMemberAjax=$.ajax({type:"GET",url:"/tbmall/getPayUrl",data:r,cache:!1,dataType:"json"}).success(function(e){0==e.no&&a&&a(e.data.return_url)})},updatePayMemberOrder:function(e,t,a,i){var r=this,o={terminal:"pc",pay_type:1,channel:2,order_id:a,memberId:e,memberCount:t,pageUrl:r.return_url};r._upPayMemberAjax&&r._upPayMemberAjax.abort(),r._upPayMemberAjax=$.ajax({type:"GET",url:"/tbmall/upOrder",data:o,cache:!1,dataType:"json"}).success(function(e){0==e.no&&i&&i(e.data)})},createBubble:function(e){var t=$.extend(e,{arrow_dir:"down",arrow_pos:{left:30},closeBtn:!1,level:1,arrowReq:!0});return new UiBubbleTipBase(t)},showMonth12Bubble:function(){var e=this;e.hideCustomMonthBubble();var t=e.$root.find(".j_vip_month_12");if(!e.bubble_month_12){var a={content:"\u4E00\u6B21\u6027\u5F00\u901A12\u4E2A\u6708\u4EE5\u4E0A\u4F1A\u5458\uFF0C\u8D60\u9001\u8FDE\u7EED\u7B7E\u5230\u53613\u5F20",bubble_css:{top:0,right:-100,width:280},wrap:t};e.bubble_month_12=e.createBubble(a)}e.bubble_month_12.showBubble()},hideMonth12Bubble:function(){var e=this;e.bubble_month_12&&e.bubble_month_12.hideBubble()},showCustomMonthBubble:function(){var e=this,t=e.$root.find(".j_custum_time");if(!e.bubble_custom_month){var a={content:"\u4E00\u6B21\u6027\u53EA\u80FD\u5F00\u901A120\u4E2A\u6708\u8D34\u5427\u4F1A\u5458",bubble_css:{top:0,right:-100,width:280},wrap:t};e.bubble_custom_month=e.createBubble(a)}e.bubble_custom_month.showBubble()},hideCustomMonthBubble:function(){var e=this;e.bubble_custom_month&&e.bubble_custom_month.hideBubble()}}});_.Module.define({path:"common/widget/payMember",requires:["common/widget/qianbaoPurchaseMember"],sub:{pay_member_url:"/tbmall/getPayUrl",initial:function(){var a=this;a.cashierDialog=a.requireInstance("common/widget/cashierDialog"),a.qianbaoPayMember=a.requireInstance("common/widget/qianbaoPurchaseMember")},showCashier:function(a){var e=this,r=!1,i=1,t=a||{};$.extend(t,{fr:t.fr||"",track:"memberpay"});var o=e.isQianbaoHitSmallFlow();if(o&&("tshow_open_btn"===a.fr||"tshow_detail_open_btn"===a.fr))return i=2,e.qianbaoPayMember.showDialog(t),void 0;("tshow_open_btn"==a.fr||"userbar"==a.fr)&&(r=!0,i=1);var n=null;r||(n=window.open("")),$.get("/tbmall/getPayUrl?terminal=pc&pay_type=1",function(a){a.data&&(r?(a.data&&(a.data+="&embed=1"),t.cashier_url=a.data,e.cashierDialog.showDialog(t)):n.location.href=a.data)})},isQianbaoHitSmallFlow:function(){var a=PageData&&PageData.user&&PageData.user.user_id;return a?"1157380926"==a||"707573940"==a||"963463500"==a||"1093896819"==a||"1496"==a||"1134652730"==a||"982451133"==a?!0:(a=parseInt(a),a%9==1):!1}}});_.Module.define({path:"common/widget/http_transform",sub:{initial:function(){window.BaiduHttps||(window.BaiduHttps={callbacks:function(){}})},httpTransform:function(t){if(window.navigator.userAgent){var i=window.navigator.userAgent;i=i.toLowerCase();var n=new RegExp("/chrome|firefox|safari|msie 10|rsv:11|msie [89]/");n.test(i)&&(t=t.replace("http://www.baidu.com","https://www.baidu.com"))}return t},httpLinkHover:function(t){$(t).hover(function(){$.ajax({url:"https://www.baidu.com/con?from=tieba",type:"get",dataType:"JSONP"})})}}});_.Module.define({path:"common/widget/Userbar",requires:["DropDownList","common/widget/Card","common/widget/wallet_dialog","common/widget/newMessageSystem","common/widget/cashierDialog","common/widget/messenger","common/widget/baseUserData","common/widget/payMember","common/widget/httpTransform"],sub:{_btns:{},_userinfo:null,$root:null,_logoutTimer:null,_product:null,_self:this,_urls:{itb_home:"",my_itb:"",my_club:"",u_split:"",my_space:""},_ddls:{itb:null,club:null,space:null},_userDataRended:{my_forum:!1,club:!1,space:!1},initial:function(t,e,i){e=e||"",TbCom.process("User","init",t,e),this._userinfo=t,this._product=e,this._buildLayout(i),TbCom.process("MsgSystem","init"),TbCom.process("UserMessage","init",e,i)},_bindEvent:function(t){t.delegate(".j_u_xiu8","click",function(){$.stats.track("\u70B9\u51FB\u7EDF\u8BA1","\u6211\u7684\u79C0\u573A")})},_initURLs:function(){this._urls.itb_st_param="st_mod=userbar&fr=tb0_"+this._product,this._urls.itb_home="/i/sys/jump?un="+this._userinfo.name_url+(this._userinfo.no_un?"&fr_noun=1":""),this._urls.my_favor=this._urls.itb_home+"&type=storethread&"+this._urls.itb_st_param,this._urls.itb_profile="/home/profile?un="+this._userinfo.name_url+(this._userinfo.no_un?"&fr_noun=1":"")},_buildLayout:function(t){var e=this,i="";-1!=$.inArray(this._product,["tbmall","livetool"])&&(i="userbar_theme2"),this.$root=$('<div id="com_userbar" class="userbar '+i+'"></div>');var s=$.getcurzIndex();(null==s||0>=s)&&(s=11e3),this.$root.css({"z-index":s});var a=t?$(t):$("body");a.prepend(this.$root),this.$root.on("click","a",function(){var t=$(this),e="\u9876\u90E8-";t.parents(".u_setting").length>0?e="\u8BBE\u7F6E-":t.parents(".u_news").length>0?e="\u6D88\u606F-":t.parents(".u_username").length>0&&(e="\u7528\u6237\u540D-");var i=$.trim($(this).html());(0==$.trim(t.html()).length||t.hasClass("u_username_wrap"))&&(i=t.tbattr("title")),t.hasClass("j_cleardata")&&(e="\u6D88\u606F-"),i=e+i,$.stats.track(i,"\u8D34\u5427\u9876\u90E8\u5BFC\u822A\u70B9\u51FB\u7EDF\u8BA1")}).on("click",".j_btn_getmember",function(){if(!PageData.user.is_login)return _.Module.use("common/widget/LoginDialog"),!1;if(e.isMemeber)e._flowRateTest();else{window.open("/tbmall/tshow")}return!1}),this._btns.bdsearch=$('<a href="http://www.baidu.com">\u767E\u5EA6\u9996\u9875</a>'),this._btns.tbmall=$('<div class="u_menu_item u_menu_tbmall"><a class="u_menu_wrap u_tbmall_wrap" title="\u70B9\u51FB\u5230\u5546\u57CE\u8D2D\u4E70\u9053\u5177" href="http://tieba.baidu.com/tbmall/home" target="_blank"></a></div>'),this._btns.school=$('<a class="j_school" href="https://passport.baidu.com/v2/?reg&tpl=tb&u=http://tieba.baidu.com/&school=1" target="_blank" style="color:red;">\u6821\u56ED\u7528\u6237\u6CE8\u518C\u901A\u9053</a>'),this._btns.app=$('<div class="u_menu_item u_menu_app"><a class="u_menu_wrap u_app_wrap" title="\u8D34\u5427\u624B\u673A\u5BA2\u6237\u7AEF" href="http://c.tieba.baidu.com/c/s/download/pc?src=webtbGF" target="_blank"></a></div>'),this._btns.appcenterEntrance=$('<div class="u_menu_item u_menu_appcenterEntrance"><a class="u_menu_wrap u_appcenterEntrance_wrap" href="/f?kw=%D3%A6%D3%C3%D6%D0%D0%C4&fr=userbar" title="\u5E94\u7528\u4E2D\u5FC3" target="_blank">\u5E94\u7528\u4E2D\u5FC3</a></div>'),this._userinfo.is_login?(this._buildLoginLayout(),this._buildWallet(),this._buildNews(),e._buildOfflineCard(),TbCom.process("User","getUserInfoByRequest",function(t){e._initURLs(t),e._buildUsername(t),e._buildUSetting(t),e._buildJoinVip(t),e._buildToHome(t)})):(this._buildLogoutLayout(),this._buildJoinVip(),this._buildToHome()),this._bindEvent(a)},_buildLoginLayout:function(){var t=["<ul>",'<li class="u_username" id="j_u_username"></li>','<li class="u_setting"></li>','<li class="u_wallet"></li>','<li class="u_news"></li>','<li class="u_tbmall"></li> ','<li class="u_app"></li>','<li class="u_split"></li>','<li class="u_appcenterEntrance"></li>','<li class="u_joinvip"></li>',"</ul>"].join("");this.$root.html(t),this._btns.logout=$('<a href="#" >\u9000\u51FA</a>'),this.$root.find(".u_tbmall").append(this._btns.tbmall),this.$root.find(".u_app").append(this._btns.app),this.$root.find(".u_appcenterEntrance").append(this._btns.appcenterEntrance),this.$root.find(".u_tshow").append(this._btns.tshow)},_buildLogoutLayout:function(){var t=["<ul>",'<li class="u_login"></li>','<li class="u_reg"></li>','<li class="u_tbmall"></li>','<li class="u_app"></li>','<li class="u_split"></li>','<li class="u_appcenterEntrance"></li>','<li class="u_joinvip"></li>',"</ul>"].join("");this._btns.reg=$('<div class="u_menu_item"><a href="https://passport.baidu.com/v2/?reg&tpl=tb&u=http://tieba.baidu.com?tb_mod=userBar&tb_fr=index" onclick="return false;" >\u6CE8\u518C</a></div>'),this._btns.login=$('<div class="u_menu_item"><a href="#" onclick="return false;">\u767B\u5F55</a></div>'),this.$root.html(t),this.$root.find(".u_reg").append(this._btns.reg),this.$root.find(".u_login").append(this._btns.login),this.$root.find(".u_tbmall").append(this._btns.tbmall),this.$root.find(".u_app").append(this._btns.app),this.$root.find(".u_appcenterEntrance").append(this._btns.appcenterEntrance),this._btns.reg.click(function(){TbCom.process("User","buildRegisterFrame","userBar")}),this._btns.login.click(function(){_.Module.use("common/widget/LoginDialog",["","userBar"])})},_buildUsername:function(t){var e=this.$root.find(".u_username"),i=$('<div class="u_menu_item u_menu_username"></div>'),s=t.name_weak,a="",n="";n=t.no_un?"https:/passport.baidu.com/v2/?ucenteradduname&u="+encodeURIComponent(location.href):"http://tieba.baidu.com/home/main?id="+t.portrait+"&fr=userbar";var r="";t.Parr_props&&t.Parr_props.level&&t.Parr_props.level.end_time>Env.server_time/1e3&&(r='style="color:#FF0000;"'),a='<img class="u_username_avatar" src="http://tb.himg.baidu.com/sys/portrait/item/'+t.portrait+'"/>',a='<a href="'+n+'" title="\u70B9\u51FB\u5230\u4E2A\u4EBA\u4E2D\u5FC3" class="u_menu_wrap u_username_wrap">'+a+'<span class="u_username_title" '+r+">"+s+"</span></a>",i.html(a),e.append(i);var o="";if(t.rt_room_id){var l="";for(var _ in t.rt_room_id)_&&(l=_);o='<li class="u_liveroom"><a href="/show/'+l+'" target="_blank">\u6211\u8981\u76F4\u64AD</a></li>'}var u='<ul><li class="u_itieba"><a href="/home/main?id='+t.portrait+'&fr=userbar" >\u6211\u7684\u8D34\u5427</a></li><li class="u_mytbmall"><a href="/tbmall/mymall" target="_blank">\u6211\u7684\u5546\u57CE</a></li><li class="u_favor" location="user_favor_ch"><a href="'+this._urls.my_favor+'" target="_blank">\u6211\u7684\u6536\u85CF</a></li><li class="u_pan"><a href="http://pan.baidu.com/" target="_blank">\u6211\u7684\u7F51\u76D8</a></li><li class="u_game"><a href="/game/index" target="_blank">\u6211\u7684\u6E38\u620F</a></li>'+o+'<li class="u_xiu8"><a class="j_u_xiu8"href="/f?ie=utf-8&kw=%E7%A7%80&fr=search" target="_blank">\u6211\u7684\u79C0\u573A</a></li></ul>',p=this._ddls.uname=this.use("DropDownList",e,i,"uname");p.innerContent("top",u)},_buildUSetting:function(t){var e=this,i=this.$root.find(".u_setting"),s=$('<div class="u_menu_item u_menu_setting"><a class="u_menu_wrap u_setting_wrap" href="#" onclick="return false;"></a></div>');i.append(s);var a=["<ul>",'<li><a href="http://passport.baidu.com/?center&tpl=tb&aid=6&default_tab=3#3,0">\u5E10\u53F7\u8BBE\u7F6E</a></li>','<li class="u_tb_profile"><a href="',this._urls.itb_profile,'">\u8D34\u5427\u8BBE\u7F6E</a></li>','<li class="pm_center"><a href="http://tieba.baidu.com/pmc" class="j_pmc-center" target="_blank">\u670D\u52A1\u4E2D\u5FC3</a></li>','<li class="fuwu_center"><a href="http://tieba.baidu.com/helpcenter/index" class="j_help-center" target="_blank">\u5E2E\u52A9\u4E2D\u5FC3</a></li>','<li class="u_logout"></li>',"</ul>"].join(""),n=this._ddls.usetting=this.use("DropDownList",i,s);n.innerContent("top",a),$("body").on("click.helpcenter",".j_help-center",function(){$.stats.track("helpcenter","UEG-track-click","userbar","click")}),t.no_un&&i.find(".u_tb_profile a").click(function(){return TbCom.process("User","buildUnameFrame"),!1}),i.find(".u_logout").append(this._btns.logout),this._btns.logout.click(function(){e._logout()})},_buildWallet:function(){var t=this,e=this.$root.find(".u_wallet"),i=$('<div class="u_menu_item u_menu_wallet"><a class="u_menu_wrap u_wallet_wrap j_wallet" title="\u70B9\u51FB\u67E5\u770BT\u8C46\u8D26\u5355" href="#" onclick="return false;"></a></div>');e.append(i),e.find(".j_wallet").on("click",function(e){$.stats.track("T\u8C46\u5BFC\u822A\u680F","\u4F1A\u5458\u5B98\u7F51\u7EDF\u8BA1"),e.preventDefault(),t.requireInstance("common/widget/wallet_dialog").show()})},_flowRateTest:function(){var t=this.requireInstance("common/widget/payMember"),e={fr:"userbar"};t.showCashier(e)},_buildJoinVip:function(t){var e=this.$root.find(".u_joinvip"),i=!1,s="\u4F1A\u5458\u5B98\u7F51";t&&t.Parr_props&&t.Parr_props.level&&1e3*t.Parr_props.level.end_time>Env.server_time?(i=!0,s=(t.Parr_props.level.props_id>1?"\u7EED\u8D39\u8D85\u7EA7":"\u5347\u7EA7\u8D85\u7EA7")+"\u4F1A\u5458"):t&&t.Parr_props&&t.Parr_props.level&&1e3*t.Parr_props.level.end_time<Env.server_time&&(i=!0,s="\u5F00\u901A\u4F1A\u5458");var a=$('<div class="u_menu_item u_menu_joinvip"><a class="u_joinvip_wrap vip_red j_btn_getmember" href="javascript:;"  target="_blank">'+s+"</a></div>");e.append(a),this.isMemeber=i},_buildToHome:function(){var t=this,e=this.$root.find(".u_joinvip"),i="\u767E\u5EA6\u9996\u9875",s=t.requireInstance("common/widget/http_transform"),a=s.httpTransform("http://www.baidu.com?tn=SE_hldp03480_530ir7bs"),n=$('<li class="u_bdhome"><div class="u_menu_item u_menu_bdhome j_u_menu_bd_home_link"><a  href="'+a+'" target="_blank">'+i+"</a></div></li>");e.after(n),e.on("click",".j_u_menu_bd_home_link",function(){$.stats.track("\u53EC\u5524\u5EA6\u5A18\u70B9\u51FB\u91CF","\u7528\u6237\u6761")})},_buildOfflineCard:function(){var t=this,e=1*new Date;e>1408032e6||$.tb.Storage.get("balv_tdou_update")>e||(t.offline_card=this.use("common/widget/Card",{content:'<span style="cursor:pointer;position: absolute;width: 10px; height: 10px; right: 5px; top: 6px;" class="j_close"></span><a target="_blank" class="j_link" href="/p/3199708402"><img style="margin: 4px 4px 0;" src="http://tb1.bdstatic.com/tb/static-ucenter/img/offline1.png"></a>',clazz:"doupiao_offline",arrow_dir:"up",card_css:{width:172,"z-index":1010,right:10,top:30},arrow_pos:{left:70,top:-8},wrap:$("#com_userbar"),card_leave_display:!0}),t.offline_card._j_card.on("click",".j_close",function(){$.tb.Storage.set("balv_tdou_update",e+864e5),t.offline_card._j_card.remove()}).on("click",".j_link",function(){$.tb.Storage.set("balv_tdou_update",e+864e5),t.offline_card._j_card.remove()}),t.offline_card.showCard())},_buildNews:function(){this.use("common/widget/newMessageSystem")},_logout:function(){var t,e=0;try{t=PageData.user?PageData.user.name:PageData.user_info.name}catch(i){t=""}try{e="baidubrowser.tieba"==window.external.GetVersion("version")?!0:null}catch(i){e=null}(!$.cookie("baidu_broswer_setup_"+t)&&!e||"NaN"===$.cookie("baidu_broswer_setup_"+t))&&$.cookie("baidu_broswer_setup_"+t,0),TbCom.process("User","logout")}}}),_.Module.define({path:"common/widget/Userbar/DropDownList",requires:[],sub:{_ite:null,_wrapper:null,key:null,_listWrapper:null,_conWrapper:null,_bottomConWrapper:null,_topConWrapper:null,initial:function(t,e,i){this._wrapper=t,this._ite=e,this.key=i,this._build()},_build:function(){var t=['<div class="u_ddl">','<div class="u_ddl_con">','<div class="u_ddl_con_top"></div>','<div class="d_ddl_con_bottom"></div>',"</div>","</div>"].join("");this._listWrapper=$(t),this._wrapper.append(this._listWrapper),this._conWrapper=this._listWrapper.find(".u_ddl_con:first"),this._topConWrapper=this._listWrapper.find(".u_ddl_con_top:first"),this._bottomConWrapper=this._listWrapper.find(".d_ddl_con_bottom:first"),this._bindEvents()},_bindEvents:function(){var t,e=this;e._wrapper.hover(function(){t&&clearTimeout(t),e.expand()},function(){t=setTimeout(function(){e.close()},0)})},_innerTopContent:function(t){"object"==typeof t?this._topConWrapper.append(t):"string"==typeof t&&this._topConWrapper.html(this._topConWrapper.html()+t)},_innerBottomContent:function(t){"object"==typeof t?this._bottomConWrapper.append(t):"string"==typeof t&&this._bottomConWrapper.html(this._bottomConWrapper.html()+t),this._bottomConWrapper.css("display","block")},expand:function(){this._ite.addClass("u_menu_hover"),this._listWrapper.css({display:"block"})},close:function(){this._ite.removeClass("u_menu_hover"),this._listWrapper.css("display","none")},innerContent:function(t,e){"top"==t?this._innerTopContent(e):"bottom"==t&&this._innerBottomContent(e)}}});_.Module.define({path:"common/widget/footer",requires:[],sub:{initial:function(){this._handleEvents()},_handleEvents:function(){var i=$("#btnFroceToPad");i.bind("click",function(){$.cookie("tb_device",null),url=window.location.href.toString(),-1!==url.indexOf("kw")&&-1===url.indexOf("ie=utf-8")&&(url+=-1!==url.indexOf("?")?"&ie=utf-8":"?ie=utf-8"),window.location.href=url})}}});_.Module.define({path:"common/widget/poptip",sub:{_cookieKey:"poptip_0",initial:function(o){o=o||{};var e=$("#common_poptip_html").html(),i=/pv_code=.?(\d+).?/.exec(e);null!=i&&(this._cookieKey="poptip_"+i[1]),this._isShowed(this._cookieKey)||this._show(e,o)},_show:function(o,e){var i=this,t={content:o,arrow_dir:"up",bubble_css:{top:20,right:20,width:null!=e.width?e.width:228},arrow_pos:{right:15},wrap:$("body"),closeBtn:!0,arrowReq:!1},n=new UiBubbleTipBase(t);n.bind("onclose",function(){i._setShowed(i._cookieKey),n.closeBubble()}),n.showBubble()},_setShowed:function(o){$.cookie(o,1,{expires:30})},_isShowed:function(o){return null!=$.cookie(o)}}});_.Module.define({path:"common/widget/AdStats",sub:{adPositionConfig:[{locate:"\u53F3\u4E0A\u65B9button",locateClass:"#search_button",adId:"1"},{locate:"\u53F3\u4FA7\u56FE\u7247",locateClass:"#aside_ad .aside_ad_pic",adId:"2"},{locate:"\u5F39\u7A97",locateClass:"#pop_frame .pop_button_w",adId:"3"},{locate:"PC\u5168\u8D34\u5427\u641C\u7D22\u6846sug\u63A8\u8350\u4F4D\u7F6E\u4E00",locateClass:".suggestion_list .item_top1",adId:"4"},{locate:"PC\u5168\u8D34\u5427\u641C\u7D22\u6846sug\u63A8\u8350\u4F4D\u7F6E\u4E8C",locateClass:".suggestion_list .item_top2",adId:"4"},{locate:"PC\u5168\u8D34\u5427\u641C\u7D22\u6846sug\u63A8\u8350\u4F4D\u7F6E\u4E09",locateClass:".suggestion_list .item_top3",adId:"4"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E00\u5E27\u7B2C\u4E00\u5F20",locateClass:"#carousel_wrap .img_list_3pic:eq(0) a:eq(0)",adId:"5"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E00\u5E27\u7B2C\u4E8C\u5F20",locateClass:"#carousel_wrap .img_list_3pic:eq(0) a:eq(1)",adId:"6"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E00\u5E27\u7B2C\u4E09\u5F20",locateClass:"#carousel_wrap .img_list_3pic:eq(0) a:eq(2)",adId:"7"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E8C\u5E27\u7B2C\u4E8C\u5F20",locateClass:"#carousel_wrap .img_list_3pic:eq(1) a:eq(2)",adId:"8"},{locate:"PC\u9996\u9875\u7126\u70B9\u56FE\u7B2C\u4E09\u5E27",locateClass:"#carousel_wrap .img_list_1pic a",adId:"9"},{locate:"PC\u9996\u9875\u6735\u6735\u5947\u5427",locateClass:".rcmd_forum_list a",adId:"10"},{locate:"PC\u9996\u9875\u4E3B\u9898\u5427\u63A8\u8350",locateClass:".gr_f_list .good_forum",adId:"11"},{locate:"PC\u9996\u9875\u6D3B\u52A8\u5927\u5385\u8F6E\u64AD\u56FE",locateClass:".act_slider_area .good_act_page a",adId:"12"},{locate:"PC\u9996\u9875\u6D3B\u52A8\u5E73\u53F0\u63A8\u5E7F\u4F4D",locateClass:"#plat_act_wrapper .platact_lucky",adId:"13"},{locate:"PC\u9996\u9875\u70ED\u95E8\u52A8\u6001\u7B2C\u4E8C\u4F4D\u7F6E",locateClass:"",adId:"14"},{locate:"PC\u9996\u9875\u65B0\u589E\u5165\u9A7B",locateClass:".adide_platform a.pii_img_w, .adide_platform a.h6",adId:"15"},{locate:"PC\u9996\u9875\u53F3\u4FA7\u516C\u544A\u677F\u56FE\u7247",locateClass:"#notice_item a.notice",adId:"16"},{locate:"PC\u9996\u9875\u53F3\u4FA7\u516C\u544A\u677F\u5217\u8868",locateClass:"#notice_item .notice_list a",adId:"16"},{locate:"\u5427\u76AE\u80A4",locateClass:".couplet_left, .couplet_right",adId:"17"},{locate:"\u8D34\u5427\u9876\u90E8\u5934\u56FE",locateClass:".star_banner .j_click_status",adId:"18"},{locate:"\u8D34\u5427\u5DE6\u4FA7\u6D6E\u6807",locateClass:".j_platform_float_content",adId:"19"},{locate:"\u8D34\u5427\u53F3\u4FA7\u6D3B\u52A8\u7EC4\u4EF6",locateClass:".platforum_aside_images .platform_aside_images_img a",adId:"20"},{locate:"\u8D34\u5427\u53F3\u4E0B\u65B9\u89C6\u9891\u7EC4\u4EF6",locateClass:".platform_spread_video a",adId:"21"},{locate:"\u8D34\u5427\u5BFC\u822A\u4E0A\u65B9\u5F3A\u63A8\u5E7F\u6837\u5F0F",locateClass:"",adId:"22"},{locate:"\u8D34\u5427\u53F3\u4FA7\u6587\u5B57\u94FE/\u56FE\u7247\u805A\u5408\u6A21\u5757",locateClass:"",adId:"23"},{locate:"\u8D34\u5427feed\u6D41\u7279\u578B\u62BD\u5956\u8D34",locateClass:".threadlist_detail .platact_lucky",adId:"24"}],adObjType:"\u5E73\u53F0\u5316",adTask:"\u5546\u5E7F\u4F4D\u7EDF\u8BA1",initial:function(){var a=this.adPositionConfig,t=this.adObjType,l=this.adTask;$.each(a,function(){var a=this;this.locateClass&&this.locateClass.length>0&&$("body").on("mousedown",this.locateClass,function(){var e=$(this);$.stats.track(a.locate,l,null,"click",{obj_url:e.tbattr("href")||"-",obj_name:a.adId||"-",obj_type:t})})})}}});!function(){window.Path={map:function(t){return this.routes.defined[t]||(this.routes.defined[t]=new this.Route(t)),this.routes.defined[t]},listened:!1,listen:function(){this.listened=!0,this.supported=!(!window.history||!window.history.pushState),this.oldIE=navigator.userAgent.toLowerCase().search("msie")>0&&(!document.documentMode||document.documentMode<8);var t,e,n=$.tb.location;this.supported?(t=function(){Path.dispatch(n.getPathname()+n.getSearch())},window.onpopstate=t,e=n.getPathname()+n.getSearch()):(e=this.getHash(),this.oldIE?(t=function(){Path.dispatch(Path.getHash(Path.iframe.location))},this.iframe=document.createElement('<iframe src="javascript:0" tabindex="-1">'),this.iframe.style.display="none",document.body.appendChild(this.iframe),this.iframe=this.iframe.contentWindow,this.iframe.document.open().close(),this.iframe.location.hash=e,setInterval(t,50)):(t=function(){Path.dispatch(n.getHash().replace("#",""))},window.onhashchange=t),""!==e&&this.execute(e)),this.routes.current=e},nav:function(t){this.listened&&(this.supported?(window.history.pushState(null,null,t),this.dispatch(t)):this.oldIE?(this.iframe.document.open().close(),this.iframe.location.hash=t):$.tb.location.setHash(t))},refresh:function(){this.execute(this.routes.current,!0)},setDefaultAction:function(t){this.defaultAction=t},Route:function(t){this.action=null,this.path=t},routes:{current:null,defined:{}},dispatch:function(t){t!==this.routes.current&&(this.routes.current=t,this.oldIE&&$.tb.location.setHash(t),this.execute(t))},execute:function(t,e){""===t&&(t=$.tb.location.getPathname()+$.tb.location.getSearch());var n,i;for(var o in Path.routes.defined)if(n=Path.routes.defined[o],i=Path.match(n.path,t))return void n.action.call(n,i[0],i[1],e);"function"==typeof this.defaultAction&&this.defaultAction.call(this,t,e)},match:function(t,e){var n=[e];if(t=t.split("/"),e=e.split("/"),t.length!==e.length)return!1;for(var i,o=0,a=t.length;a>o;o++)if(i=t[o].search(":"),-1!==i){if(t[o].slice(0,i)!==e[o].slice(0,i))return!1;n.push(e[o].slice(i))}else if(t[o]!==e[o])return!1;return n},getHash:function(t){var e="";return e=t?t.href.match(/#(.*)$/):$.tb.location.getHref().match(/#(.*)$/),e?e[1]:""}},Path.Route.prototype={to:function(t){this.action=t}}}(),_.Module.define({path:"frs/widget/NewNoFresh",sub:{initial:function(t,e){function n(){$("#frs_list_pager").click(function(t){try{var e,n=$.tb.location,i=t.target;if(!PageData.user.is_login){var o="http://tieba.baidu.com"+$.tb.unescapeHTML($(i).tbattr("href"));return window.open("/f/user/passport?jumpUrl="+o+"&statsInfo=frs_pager#login_anchor"),!1}if("a"===i.tagName.toLowerCase()){e=i.getAttribute("href",2).replace(n.getProtocol()+"//"+n.getHost(),"");var r=$.tb.location.getSearchValue("all_thread_tab");return 1==r&&(e+="&all_thread_tab=1"),a||(e="/pn="+e.match(/\d+$/)),Path.nav(e),t.preventDefault(),!1}}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/new_no_refresh/new_no_refresh.js",method:"",ln:197}),t}})}function i(i,a){var h=t+i+"&apage=1&t="+(new Date).getTime();if(a&&(h+="&refresh=true"),s){if(r===i)return;s.abort()}r=i,s=$.get(h,function(t){s=null,e?$(window).scrollTop($("#contet_wrap").offset().top-10):Path.is_star?($(window).scrollTop($("#contet_wrap").offset().top-10),Path.is_star=!1):o(),setTimeout(function(){var e=$("#threadListGroupCnt").add("#thread_topic").add("#thread_pic");a&&e.size()>0?(e.nextAll().remove(),$("#content_leftList").append(t)):$("#content_leftList").empty().html(t),n()},0)},"text")}function o(){var t=$(window).scrollTop();t>0&&(window.scrollTo(0,1),setTimeout(function(){window.scrollTo(0,0)},0))}try{var a=!(!window.history||!window.history.pushState);$("#refresh").click(function(t){try{return Path.refresh(),t.preventDefault(),!1}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/new_no_refresh/new_no_refresh.js",method:"",ln:169}),t}}),n(),Path.map(a?t+":num":"/pn=:num").to(function(t,e,n){i(e,n)}),Path.setDefaultAction(function(t,e){if(""===t.replace("#","")||e){var n=t.match(/&pn=(\d+)/i);n=n?n[1]:void 0===r?0:r,i(n,e)}}),Path.listen();var r,s=null}catch(h){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:h.message||h.description,path:"frs:widget/new_no_refresh/new_no_refresh.js",method:"",ln:269}),h}}}});_.Module.define({path:"common/widget/searchHandler",sub:{_staticUrl:{no_key:"http://tieba.baidu.com/","\u8D34\u5427\u6295\u8BC9":"http://tieba.baidu.com/tousu/new","\u5E16\u5427\u6295\u8BC9":"http://tieba.baidu.com/tousu/new",tiebatousu:"http://tieba.baidu.com/tousu/new","\u8D34\u5427\u6295\u8BC9\u5427":"http://tieba.baidu.com/tousu/new","\u8D34\u5427\u6295\u8BC9\u4E2D\u5FC3":"http://tieba.baidu.com/tousu/new","\u6295\u8BC9\u4E2D\u5FC3":"http://tieba.baidu.com/tousu/new","\u6295\u8BC9":"http://tieba.baidu.com/tousu/new","\u8D34\u5427\u4E3E\u62A5":"http://tieba.baidu.com/tousu/new","\u77E5\u9053\u6295\u8BC9":"http://tousu.baidu.com/zhidao","\u7A7A\u95F4\u6295\u8BC9":"http://tousu.baidu.com/hi","\u767E\u79D1\u6295\u8BC9":"http://tousu.baidu.com/baike",zhidaotousu:"http://tousu.baidu.com/zhidao",kongjiantousu:"http://tousu.baidu.com/hi",baiketousu:"http://tousu.baidu.com/baike"},_sendStatistics:function(t){$.stats.sendRequest("st_mod=search&search_type="+t)},initial:function(){},toStaticUrl:function(t){var e=t.toLowerCase();return this._staticUrl.hasOwnProperty(e)?($.tb.location.setHref(this._staticUrl[e]),!1):void 0},enterBa:function(t,e){if(""==t)return $.tb.location.setHref(this._staticUrl.no_key),!1;this.toStaticUrl(t);var s=[];if(s=-1!=t.indexOf("\uFF1A")?t.split("\uFF1A"):t.split(":"),2==s.length){if("\u6807\u7B7E"==s[0])return this._sendStatistics("tagsearch",t),$.tb.location.setHref("/f/search/fm?ie=utf-8&tag="+encodeURIComponent($.tb.escapeHTML(s[1]))),!1;if(-1!=s[0].indexOf("\u5427\u5185")){var o=s[0].split("\u5427\u5185")[0];if(o)return this._sendStatistics("baneisearch",t),$.tb.location.setHref("/f/search/res?ie=utf-8&kw="+encodeURIComponent($.tb.escapeHTML(o))+"&qw="+encodeURIComponent($.tb.escapeHTML(s[1]))),!1}}if(PageData.search_what&&"fromBtn"!=e){if("composite"==PageData.search_what)return this._sendStatistics("compositesearch",t),$.tb.location.setHref("/f/search/res?ie=utf-8&qw="+encodeURIComponent($.tb.escapeHTML(t))),!1;if("forum"==PageData.search_what)return this._sendStatistics("forumsearch",t),$.tb.location.setHref("/f/search/fm?ie=utf-8&qw="+encodeURIComponent($.tb.escapeHTML(t))),!1}return this._sendStatistics("enterba&from=search",t),$.tb.location.setHref("/f?ie=utf-8&kw="+encodeURIComponent(t)+"&fr=search"),!1},searchPost:function(t){return window.history_search_post||(PageData.user.is_login&&$.tb.post("/f/search/addWord",{word:$.tb.escapeHTML(t)},function(t){0==t.no&&(window.history_search_post=!1)}),window.history_search_post=!0),this._sendStatistics("postsearch",t),setTimeout(function(){$.tb.location.setHref("/f/search/res?ie=utf-8&qw="+encodeURIComponent($.tb.escapeHTML(t)))},100),!1},searchPostInBa:function(t,e){var s="/f/search/res?ie=utf-8&kw="+encodeURIComponent($.tb.escapeHTML(e))+"&qw="+encodeURIComponent($.tb.escapeHTML(t));return window.history_search_post||(PageData.user.is_login&&$.tb.post("/f/search/addWord",{word:$.tb.escapeHTML(t)},function(t){0==t.no&&(window.history_search_post=!1)}),window.history_search_post=!0),this._sendStatistics("baneisearch",t),setTimeout(function(){$.tb.location.setHref(s)},100),!1},searchPeople:function(t){return this._sendStatistics("peoplesearch",t),$.tb.location.setHref("/f/search/sure?ie=utf-8&only_user=1&qw="+encodeURIComponent($.tb.escapeHTML(t))),!1},searchTag:function(t){return this._sendStatistics("tagsearch",t),$.tb.location.setHref("/f/search/fm?ie=utf-8&tag="+encodeURIComponent($.tb.escapeHTML(t))),!1},searchForum:function(t){var e="/f/search/fm?ie=UTF-8&";return-1!=t.indexOf("\u6807\u7B7E\uFF1A")?(t=t.substr(t.indexOf("\u6807\u7B7E\uFF1A")+3),e=e+"tag="+encodeURIComponent($.tb.escapeHTML(t))):-1!=t.indexOf("\u6807\u7B7E:")?(t=t.substr(t.indexOf("\u6807\u7B7E:")+3),e=e+"tag="+encodeURIComponent($.tb.escapeHTML(t))):e=e+"qw="+encodeURIComponent($.tb.escapeHTML(t)),$.tb.location.setHref(e),!1}}});_.Module.define({path:"common/widget/suggestion",requires:["common/widget/suggestion/base"],sub:{options:{input:null,maxCount:12,skipTime:50,classes:{expand:"suggestion",expandList:"suggestion_list"}},initial:function(i){this.options=$.extend(this.options,i),this.initSug()},initSug:function(){this.options.input&&this.requireInstance("common/widget/suggestion/base",[this.options])}}});
;_.Module.define({path:"common/widget/suggestion/base",requires:["common/widget/suggestion/events"],sub:{runtime:{disabled:!1},initial:function(t){this.options=t,this.input=this.options.input,this.wrapper=this.options.fixWrapper,this.sug=null,this.dataList=[],this.create()},create:function(){var t=['<div class="#{expand}">','<ul class="#{expandList}">',"</ul>","</div>"].join(""),i=this.input,s=i.offset(),e=i.outerWidth()-2,n=i.outerHeight()+s.top-1,o=s.left,h=this.wrapper?this.wrapper:$("body");this.sug=$($.tb.format(t,this.options.classes)).css({left:o,width:e,top:n}).hide(),h.append(this.sug),this.ableControl(),this.bindEvents()},bindEvents:function(){this.requireInstance("common/widget/suggestion/events",[{input:this.input,sug:this.sug,options:this.options}])},ableControl:function(){var t=$('input.jointb[type="radio"]'),i=$('input.authortb[type="radio"]'),s=$('input.searchtb[type="radio"]');t.length>0&&t.bind("click",this.able()),i.length>0&&i.bind("click",this.able()),s.length>0&&s.bind("click",this.disable()),0!=t.length&&t.tbattr("checked")||this.disable()},able:function(){this.runtime.disabled=!1},disable:function(){this.runtime.disabled=!0,this.sug.hide()}}});
;_.Module.define({path:"common/widget/suggestion/events",requires:["common/widget/suggestion/data"],sub:{skippedType:["operation_title","often_forum_title","relation_forum_title","relation_game_title","more_title"],initial:function(t){this.options=t,this.input=this.options.input,this.sug=this.options.sug,this.wrapper=this.options.options.fixWrapper,this.skipTime=this.options.options.skipTime,this.target=null,this.toggleFlag=!1,this.mouseIn=!1,this.query="",this.bindEvents(),this.initRequest()},initRequest:function(){this.data=this.requireInstance("common/widget/suggestion/data",[{input:this.input,sug:this.sug,forumName:this.options.options.forumName,maxCount:this.options.options.maxCount}])},delayRequest:function(){return this.query=this.getQuery(),this.data.delayRequest(this.skipTime,this.query)},bindEvents:function(){if(this.options.searchFixed){var t=this.wrapper.offset().top,i=$(window).scrollTop();this.toggleFlag=t>i,this.fixSize(!0)}$(window).bind("scroll",$.proxy(this.fixSize,this)).bind("resize",$.proxy(this.fixSize,this)),this.input.bind("keyup",$.proxy(this.handleKeyup,this)).bind("keydown",$.proxy(this.handleKeydown,this)).bind("paste",$.proxy(this.handleElseEvents,this)).bind("focusin",$.proxy(this.handleElseEvents,this)).bind("click",$.proxy(this.handleElseEvents,this)).bind("focusout",$.proxy(this.handleFocusout,this)).bind("compositionend",$.proxy(this.handleElseEvents,this)),this.sug.on("mouseenter","li",$.proxy(this.handleMouseenter,this)).on("mouseleave","li",$.proxy(this.handleMouseleave,this)).on("click","li",$.proxy(this.handleFire,this))},handleKeyup:function(t){$.inArray(t.keyCode,[16,17,18,20,37,38,39,40])>=0||13!=t.keyCode&&this.delayRequest()},handleKeydown:function(t){if(!($.inArray(t.keyCode,[16,17,18,20,37,39])>=0))switch(t.keyCode){case 13:return this.handleFire();case 38:return this.prevActive(),!1;case 40:return this.nextActive(),!1;default:this.clearState()}},handleMouseenter:function(t){var i=$(t.currentTarget);this.mouseIn=!0,this.active(i)},handleMouseleave:function(){this.mouseIn=!1},handleFocusout:function(){this.mouseIn||(this.clearState(),this.sug.hide())},handleElseEvents:function(){this.delayRequest()},handleFire:function(){var t=this,i=this.input.getData();if(i&&i.sugUrl){this.clickStats(i);var e=setTimeout(function(){$.tb.location.setHref($.tb.unescapeHTML(i.sugUrl)),t.sug.hide(),clearTimeout(e),e=null},200);return!1}return!0},clickStats:function(t){var i=t.sugType;switch(i){case"game_item":this.clickGameStats(t);break;case"operation_item":this.clickOperationItemStats(t)}},clickGameStats:function(t){$.stats.track("\u641C\u7D22\u6846","\u641C\u7D22\u63D0\u793A\u51FA\u6E38\u620F\u5B9E\u9A8C","","\u70B9\u51FB",{obj_name:t.sugValue,obj_url:t.sugUrl,obj_type:"\u6E38\u620F"})},clickOperationItemStats:function(t){$.stats.track(t.sugValue,"\u641C\u7D22\u6846\u8FD0\u8425\u914D\u7F6E\u9879\u7EDF\u8BA1","","click",{obj_name:t.sugValue,obj_url:t.sugUrl,obj_type:"\u5E73\u53F0\u5316"})},fixSize:function(t){var i=this;this.fixTime&&clearTimeout(this.fixTime),this.fixTime=setTimeout(function(){var e=i.wrapper.offset().top,s=$(window).scrollTop(),n=i.input,a=n.offset(),o=n.outerHeight()+a.top-1,u=n.outerWidth()-2,h=a.left;if(e>s===i.toggleFlag){if(!t)return}else i.toggleFlag=e>s,i.sug.hide();i.wrapper.hasClass("search_main_fixed")&&(o=n.outerHeight()+5),i.sug.css({width:u,left:h,top:o})},0)},changeState:function(t){var i=t.getData().sugType,e=t.getData().sugUrl,s=t.getData().sugValue;this.input.bindData({sugType:i,sugUrl:e,sugValue:s})},clearState:function(){this.input.bindData({})},active:function(t){var i=t.getData().sugType,e=this.skippedType.slice(0,-1);return $.inArray(i,e)>-1?(this.clearState(),void 0):(this.target=t,this.addOn(t),this.changeState(t),void 0)},nextActive:function(){var t=this.sug.find("ul li"),i=null;if(0!==t.length&&this.sug.is(":visible")){i=this.target&&0!==this.target.next().length?this.target.next():this.sug.find("ul li").eq(0);var e=i.getData().sugType;$.inArray(e,this.skippedType)>-1?(this.target=i,this.nextActive()):this.active(i)}},prevActive:function(){var t=this.sug.find("ul li"),i=null;if(0!==t.length&&this.sug.is(":visible")){i=this.target&&0!==this.target.prev().length?this.target.prev():this.sug.find("ul li").eq(-1);var e=i.getData().sugType;$.inArray(e,this.skippedType)>-1?(this.target=i,this.prevActive()):this.active(i)}},addOn:function(t){t.siblings("li").removeClass("on"),t.addClass("on")},getQuery:function(){return this.input.tbattr("value")},setQuery:function(t){return this.input.tbattr("value",t)}}});
;_.Module.define({path:"common/widget/suggestion/data",requires:["common/widget/suggestion/render"],sub:{settings:{url:"/suggestion",isCache:!0,defaultQuery:"DEFAULTQUERY"},initial:function(t){this.options=t,this.input=this.options.input,this.sug=this.options.sug,this.forumName=this.options.forumName,this.maxCount=this.options.maxCount||10,this.curCount=0,this.query="",this.dataList=[],this.cache={}},handleResponse:function(t,e){if(0!==e.error)return!1;this.curCount=0,this.query=t;var s=e.query_tips.search_data,i=e.query_match.search_data,a=e.query_tag.search_data,r=e.suggest_game&&e.suggest_game.search_data;this.checkData(s)&&(this.formatData("operation_title"),this.formatOperateData(s)),this.checkData(i)&&(this.checkData(s)&&this.formatData("often_forum_title"),this.formatForumData(i)),this.checkData(r)?(this.formatData("relation_game_title"),this.formatGameData(r)):this.checkData(a)&&(this.formatData("relation_forum_title"),this.formatForumData(a)),!this.checkData(i)&&!this.checkData(a)||this.checkMore(t)||this.formatData("more_title","/f/search/fm?ie=UTF-8&qw="+encodeURIComponent($.tb.escapeHTML(t))),this.renderItems(),this.viewStats()},formatOperateData:function(t){var e,s;for(e=0;e<t.length&&5>e&&this.checkCount();e++)s=t[e],this.dataList.push({sugType:"operation_item",position:e+1,name:s.fname,desc:s.forum_desc,sugUrl:this.replaceAmp(s.forum_url)}),this.curCount++;this.dataList.push({sugType:"operation_item",str:'<li class="bdfengyun" ><a href = "http://top.baidu.com/?fr=bdtb">\u7531\u767E\u5EA6\u641C\u7D22\u98CE\u4E91\u699C\u63D0\u4F9B</a></li> '})},formatGameData:function(t){var e,s,i=[];for(e=0;e<t.length&&this.checkCount();e++)s=t[e],this.dataList.push({sugType:"game_item",name:s.game_name,title:this.highlightForumName(s.game_name),pic:s.icon_url,desc:s.description,sugUrl:s.link_href}),this.curCount++,i.push(s.game_name);i.length>0&&this.viewGameStats(i)},formatForumData:function(t){var e,s;for(e=0;e<t.length&&this.checkCount();e++)s=t[e],s.fname!==this.forumName&&(this.dataList.push({sugType:"forum_item",name:s.fname,title:this.highlightForumName(s.fname+"\u5427"),pic:s.fpic,desc:s.forum_desc?s.forum_desc:s.fclass2?"\u6240\u5C5E\u76EE\u5F55\uFF1A"+s.fclass1+"&nbsp; "+s.fclass2:"",member:s.member_num,thread:s.thread_num,sugUrl:"/f?ie=utf-8&kw="+encodeURIComponent(this.replaceAmp(s.fname))}),this.curCount++)},queryData:function(){var t=this.query;this.dataList.push({sugType:"reverse_query",name:t,sugUrl:"/f?ie=utf-8&kw="+encodeURIComponent(this.replaceAmp(t))})},formatData:function(t,e){var s=this.query;this.dataList.push({sugType:t,name:s,sugUrl:e})},getQuery:function(){return this.input.tbattr("value")},clearSuggestion:function(){this.dataList=[]},checkCount:function(){return this.curCount<this.maxCount},checkData:function(t){return $.isArray(t)&&t.length>0},checkMore:function(t){return!t||/^\s+$/.test(t)||t===this.forumName},replaceAmp:function(t){return t&&t.replace(/\&amp;/g,"&")},formatString:function(t){return t.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")},highlightForumName:function(t){var e="",s="",i=this.query,a=new RegExp(i.replace(/[\/\\]/g,""),"g");return e=$.tb.escapeHTML(t),s=i?e.replace(a,function(t){return'<em class="highlight">'+t+"</em>"}):e},renderItems:function(){var t="",e=this.requireInstance("common/widget/suggestion/render");this.dataList.length>0&&this.queryData(),t=e.renderSuggestion(this.dataList),""!==t?this.sug.show().find("ul").html(t):this.sug.hide(),this.clearSuggestion()},viewStats:function(){},viewGameStats:function(t){$.stats.track("\u641C\u7D22\u6846","\u641C\u7D22\u63D0\u793A\u51FA\u6E38\u620F\u5B9E\u9A8C","","\u5C55\u73B0",{obj_name:this.query,obj_game_name:t,obj_type:"\u6E38\u620F"})},request:function(t){var e=this;t===this.forumName&&(t="");var s=""===t?this.settings.defaultQuery:t;this.settings.isCache&&s in this.cache?this.handleResponse(t,this.cache[s]):(this.queryRequest&&this.queryRequest.abort(),this.queryRequest=$.ajax({url:this.settings.url,data:{query:t,ie:"utf-8"},dataType:"json",type:"get",cache:!1,success:function(s){e.responseSuccess(t,s)}}))},delayRequest:function(t,e){var s=this;this.requestTimer&&clearTimeout(this.requestTimer),this.requestTimer=setTimeout(function(){s.request(e),clearTimeout(s.requestTimer),s.requestTimer=null},t)},responseSuccess:function(t,e){if(this.settings.isCache){var s=""===t?this.settings.defaultQuery:t;this.cache[s]=e}this.handleResponse(t,e),this.queryRequest=null}}});
;_.Module.define({path:"common/widget/suggestion/render",requires:[],sub:{queryTemplate:'<li class="reserve_query" #{info}></li>',titleTemplate:['<li class="break_title #{special}" #{info}>','<span class="break_tip">#{title}</span>',"</li>"].join(""),forumTemplate:["<li #{info}>",'<div class="forum_item">','<img class="forum_image" src="#{pic}" />','<div class="forum_right">','<div class="forum_name">#{title}','<span title="\u4F1A\u5458\u6570" class="forum_member">#{member}</span>','<span title="\u5E16\u5B50\u6570" class="forum_thread">#{thread}</span>',"</div>",'<div class="forum_desc">#{desc}</div>',"</div>","</div>","</li>"].join(""),gameTemplate:["<li #{info}>",'<div class="forum_item">','<img class="forum_image" src="#{pic}" />','<div class="forum_right">','<div class="forum_name">#{title}',"</div>",'<div class="forum_desc">#{desc}</div>',"</div>","</div>","</li>"].join(""),operationTemplate:["<li #{info}>",'<div class="operation_item item_top#{position}">',"<i></i>",'<div class="operation_title">#{name}</div>','<div class="operation_desc">#{desc}</div>',"</div>","</li>"].join(""),initial:function(){},renderQuery:function(e){var i=$.tb.dataField({sugType:e.sugType,sugValue:e.name,sugUrl:e.sugUrl});return $.extend(e,{info:i}),$.tb.format(this.queryTemplate,{info:i})},renderTitle:function(e){var i="",t="",r=e.name,s=$.tb.dataField({sugType:e.sugType,sugValue:r,sugUrl:e.sugUrl});switch(e.sugType){case"operation_title":i="\u5927\u4F19\u6B63\u5728\u804A";break;case"often_forum_title":i="\u6700\u8FD1\u5E38\u901B\u7684\u5427\uFF1A";break;case"relation_forum_title":i='\u4E0E\u201C<em class="highlight">'+r+"</em>\u201D\u6709\u5173\u7684\u5427\uFF1A";break;case"relation_game_title":i='\u4E0E\u201C<em class="highlight">'+r+"</em>\u201D\u6709\u5173\u7684\u6E38\u620F\uFF1A";break;case"more_title":i='\u5728\u8D34\u5427\u4E2D\u641C\u7D22\u66F4\u591A\u4E0E\u201C<em class="highlight">'+r+"</em>\u201D\u76F8\u5173\u7684\u5427",t="special_title"}return $.tb.format(this.titleTemplate,{info:s,special:t,title:i})},renderForum:function(e){var i=$.tb.dataField({sugType:e.sugType,sugValue:e.name,sugUrl:e.sugUrl});return $.extend(e,{info:i}),$.tb.format(this.forumTemplate,e)},renderGame:function(e){var i=$.tb.dataField({sugType:e.sugType,sugValue:e.name,sugUrl:e.sugUrl+(e.sugUrl.indexOf("?")<0?"?":"&")+"gfr=search_suggestion"});return $.extend(e,{info:i}),$.tb.format(this.gameTemplate,e)},renderOperation:function(e){var i=$.tb.dataField({sugType:e.sugType,sugValue:e.name,sugUrl:e.sugUrl});return $.extend(e,{info:i}),$.tb.format(this.operationTemplate,e)},renderSuggestion:function(e){var i,t="",r=null,s=e.length;for(i=0;s>i;i++)switch(r=e[i],r.sugType){case"reverse_query":t+=this.renderQuery(r);break;case"operation_item":t+=r.str?r.str:this.renderOperation(r);break;case"forum_item":t+=this.renderForum(r);break;case"game_item":t+=this.renderGame(r);break;default:t+=this.renderTitle(r)}return t}}});_.Module.define({path:"common/widget/searchBright",requires:["common/widget/searchHandler","common/widget/suggestion"],sub:{_jq_wrap:null,_jq_input:null,_jq_input_box:null,_jq_form:null,_options:{defaultType:"tieba",style:"",forumName:"",page:null},_tip:null,_searchHandler:null,_switchRadios:{},_radioClasses:{tieba:"jointb",itieba:"authortb",post:"searchtb",benba:"nowtb",tag:"searchtag",forum:"searchforum"},_searchTypes:{tieba:1,itieba:2,post:3,benba:4,tag:5,forum:6},_searchFixed:null,initial:function(e,t){var i=this.requireInstance("common/widget/http_transform"),s=$(".j_search_nav").find("a[param=wd]");if(i.httpLinkHover(s),this._jq_wrap=e,this._jq_form=e.find(".j_search_form"),this._jq_input=e.find("#wd2"),this._jq_input_box=e.find(".j_search_input"),this._tip=PageUnit.load("search_input_tip"),this._searchFixed=t.searchFixed,this._searchWrapper=e.find(".search_main"),this._sugOn=t.sugOn,PageData.searchFixed=this._searchFixed,$.extend(this._options,t),this._initOptPage(),this._searchHandler=this.use("common/widget/searchHandler"),this._setSwitchRadios(),this._setDefaultType(),this._setSearchType(this._options.defaultType),this._initPlaceholder(),this._bindEvents(),$.browser.msie&&parseInt($.browser.version)<=7)return!1;if(this._searchScrollFixed(),"1"==this._sugOn){var t={input:this._jq_input_box,forumName:t.forumName,searchFixed:t.searchFixed,fixWrapper:this._searchWrapper};this.use("common/widget/suggestion",t)}else TbCom.process("Suggestion","createMainSearchSuggestion")},_setSwitchRadios:function(){var e=this;for(var t in this._searchTypes)this._switchRadios[t]=e._jq_wrap.find(".switch_radios ."+e._radioClasses[t]+":first")},_setDefaultType:function(){var e=$.tb.location.getHref();-1!=e.indexOf("/f/search/fm")?this._options.defaultType="forum":-1!=e.indexOf("/f/search/res")?this._options.defaultType="post":-1!=e.indexOf("/f/search/sure")&&(this._options.defaultType="itieba"),"bright_3"==this._options.style&&(this._options.defaultType="benba")},_getSearchType:function(){var e=null;if(this._options.theme&&"bright_pb"==this._options.theme)return e=this._searchTypes.benba;e=this._searchTypes.tieba;for(var t in this._switchRadios){var i=this._switchRadios[t];if(i.tbattr("checked")){e=this._searchTypes[t];break}}return e},_setSearchType:function(e){e in this._switchRadios&&("2"==this._searchTypes[e]&&this._switchRadios.tieba.tbattr("checked",!1),this._switchRadios[e].tbattr("checked",!0))},_bindEvents:function(){var e=this;this._jq_wrap.find("#search_button").on("click",function(){"frs"===PageData.product?$.stats.track("FRS_\u53F3\u4FA7\u4E0A\u65B9\u5C0F\u56FE","PC\u7AEF\u5546\u4E1A\u5316\u6E38\u620F\u7EDF\u8BA1",PageData.product||"","\u70B9\u51FB",{obj_url:"-",obj_name:"-",obj_type:"\u6E38\u620F"}):"pb"===PageData.product&&$.stats.track("PB_\u53F3\u4FA7\u4E0A\u65B9\u5C0F\u56FE","PC\u7AEF\u5546\u4E1A\u5316\u6E38\u620F\u7EDF\u8BA1",PageData.product||"","\u70B9\u51FB",{obj_url:"-",obj_name:"-",obj_type:"\u6E38\u620F"})}),this._jq_wrap.find(".j_search_nav a").click(function(){e._changeProduct($(this))}),this._jq_form.submit(function(){return"bright_3"==e._options.style||"bright_4"==e._options.style?e.handleSubmit(e._getSearchType(),e.getSearchWord()):e.submit(),!1}),this._jq_wrap.find(".j_enter_ba").click(function(){return e.submit("fromBtn"),!1}),this._jq_wrap.find(".j_search_post").click(function(){return"bright_3"==e._options.style||"bright_4"==e._options.style?e.handleSubmit(e._getSearchType(),e.getSearchWord()):e._searchPost(),!1}),this._jq_wrap.find(".j_benba_search").click(function(){"bright_pb"==e._options.theme&&e.handleSubmit(e._getSearchType(),e.getSearchWord())}),this._jq_input_box.bind("webkitspeechchange",function(){e.submit()}),$.browser.webkit?this._jq_input_box.click(function(){this.select()}):this._jq_input_box.focus(function(){this.select()})},submit:function(e){var t=this.getSearchWord();return $("#searchtag").tbattr("checked")?this._searchHandler.searchTag(t):this._searchHandler.enterBa(t,e),!1},handleSubmit:function(e,t){var i=!0;switch(e){case this._searchTypes.tieba:i=this._searchHandler.enterBa(t);break;case this._searchTypes.itieba:i=this._searchHandler.searchPeople(t);break;case this._searchTypes.post:i=this._searchHandler.searchPost(t);break;case this._searchTypes.benba:i=this._searchHandler.searchPostInBa(t,this._options.forumName);break;case this._searchTypes.tag:i=this._searchHandler.searchTag(t);break;case this._searchTypes.forum:i=this._searchHandler.searchForum(t);break;default:i=!0}return i},_initOptPage:function(){null==this._options.page&&(/^\w+:\/\/[^\/]+\/(index\.html?)|(i\/\d+)/.test($.tb.location.getHref())?this._options.page="index":/^\w+:\/\/[^\/]+\/tb\/picture\/(index\.html?)/.test($.tb.location.getHref())?this._options.page="picture_index":"itieba3"==PageData.product&&(this._options.page="itieba"))},_changeProduct:function(e){var t=this.getSearchWord(),i=$.tb.unescapeHTML(e.tbattr("href")),s=$.tb.unescapeHTML(e.tbattr("param"));if($.stats.track(e.text(),"pc\u7AEF\u8D34\u5427tab\u9875\u5BFC\u51FA\u7EDF\u8BA1",PageData?PageData.product:"","\u70B9\u51FB"),""==t){var a=i.match(/^(\w+:\/\/[^\/]+)/i),r=i.match(/fr=[^&]+/i),n=[],_="";null!=r&&r.length>0&&n.push(r[0]),n.length>0&&(_="/?"+n.join("&")),e.tbattr("href",a&&a[1]+_)}else if(null!=s&&""!=s){if(i.indexOf("www.baidu.com")>=0){var h="fr=tb01000&";$.tb.location.getHref().match("ftype=guide")&&(h="fr=tb01se0&");var o=i.indexOf("fr=");o>-1?e.tbattr("href",i.substring(0,index)+h):e.tbattr("href",i+h)}var c=e.tbattr("ie");t=null!=c&&null!=c.match(/utf-?8/gi)?encodeURIComponent(t):t.replace(/\%/gi,"%25").replace(/&/gi,"%26").replace(/\+/gi,"%2B").replace(/[\ \u3000]/gi,"%20").replace(/\//gi,"%2F").replace(/\#/gi,"%23").replace(/\=/gi,"%3D");var o=i.indexOf(s+"="),d="UTF-8"==PageData.charset?"&ie=utf-8":"";o>-1?e.tbattr("href",i.substring(0,o)+s+"="+t+d):e.tbattr("href",i+s+"="+t+d)}},_searchPost:function(){var e=this.getSearchWord(),t=$.extend({},this._options);t.defaultType="post",""==e?_.Module.use("common/widget/searchDialog",t):this._searchHandler.searchPost(e)},_initPlaceholder:function(){var e=this;$.inArray(e._options.page,["index","picture_index","itieba"])?"0"==e._tip&&_.Module.use("common/widget/Placeholder",[e._jq_input_box,e._tip,{color:"#bbb","font-size":"13px"}]):e._jq_input.bind("mousedown focus",function(){e._jq_input.val()===e._tip&&(e._jq_input.val(""),e._jq_input_box.val(""))})},_voiceInput:function(){var e=this.getSearchWord(),t=e.indexOf(this._tip);0===t&&(e=e.slice(this._tip.length),this._jq_input.val(e),this._jq_input_box.val(e)),this.submit()},getSearchWord:function(){return this._jq_input_box.val()},isDefaultTip:function(){return this._jq_input_box.val()===this._tip&&this._jq_input_box.hasClass("s_ipt_tip")||""===this._jq_input_box.val()},_searchScrollFixed:function(){if(this._searchFixed){var e=$("#head").find(".search_main"),t=$(".search_main").offset().top,i=$(".app_forum_top_nav").length>0?!0:!1;if(!i){var s=!1;$(window).scroll(function(){setTimeout(function(){var i=$(window).scrollTop();if(i>t){if(s)return;e.addClass("search_main_fixed").hide(),e.fadeIn(100),e.find(".search_form").addClass("search_form_fixed"),e.find(".search_ipt").addClass("search_ipt_fixed"),e.find(".search_btn").addClass("search_btn_fixed"),e.find(".search_btn_enter_ba").addClass("search_btn_enter_ba_fixed"),e.find("#search_logo_small").addClass("search_logo_fixed"),e.find("#tb_header_search_form").addClass("j_search_form_fixed"),$("#search_logo_small").addClass("search_logo_fixed"),$("#tb_header_search_form").addClass("j_search_form_fixed"),s=!0}else{if(!s)return;$(".senior-search-link").css({visibility:"visible"}),$("#search_baidu_promote").show(),$("#search_button_wrapper").show(),e.removeClass("search_main_fixed"),e.find(".search_form").removeClass("search_form_fixed"),e.find(".search_ipt").removeClass("search_ipt_fixed"),e.find(".search_btn").removeClass("search_btn_fixed"),e.find(".search_btn_enter_ba").removeClass("search_btn_enter_ba_fixed"),e.find("#search_logo_small").removeClass("search_logo_fixed"),e.find("#tb_header_search_form").removeClass("j_search_form_fixed"),s=!1}},1)})}}}}});_.Module.define({path:"adsense/widget/data_handler_async",requires:[],sub:{initial:function(){},addData:function(t){$.extend(this._Storage.data,t)},getData:function(){return $.extend(null,this._Storage.data)},_Storage:function(){var t={};return{data:t}}()}});_.Module.define({path:"adsense/widget/loader",requires:["common/widget/messenger"],sub:{adStatus:{},initial:function(){this._initMessenger()},_getAdLocName:function(e){return[e.client_type,e.page_name,e.pos_name].join("_")},adDomMap:function(){var e={},t=function(t,a){e[t]=a},a=function(t){return e[t]||$("")};return{add:t,get:a}}(),loadAD:function(e,t,a){var o=e.adData||{},i=e.className||"",n=e.asyncHTML||"",s=(e.isProxy||!1,e.isAsync||!1),r=e.isIframe||!1,d=e.needStats||!1;$.extend(o,{className:i}),"function"==typeof t&&(a=t,t={});var c=null;if(s?(c=$(n),this._renderDOM(o,c)):c=$("."+i),r){var _=$.getPageData("goods_info.0.iframe_url","",o),u=this._getIframeParams(o,t);this._loadIframe(c,_,u),this.adDomMap.add(o.id,c)}else s&&c.show();"function"==typeof a&&a(c),d&&this._clickStats(c,o),this._viewStats(c,o)},_renderDOM:function(e,t){$(e.locator).length>0?$(e.locator)[e.load_type](t):this._track(e.id+"\uFF1A\u65E0\u5B9A\u4F4D\u5143\u7D20","\u5E7F\u544A\u52A0\u8F7D\u5931\u8D25")},_getStatsParams:function(e){var t="",a=$.getPageData,o={client_type:"pc_web",task:"tbda",page:a("product",t).toLowerCase(),fid:a("forum.forum_id",t),tid:a("thread.thread_id",t),uid:a("user.user_id",t),da_task:"tbda",da_fid:a("forum.forum_id",t),da_tid:a("thread.thread_id",t),da_uid:a("user.user_id",t),da_page:a("product",t),da_type_id:e.typeid,da_obj_id:e.id,da_good_id:e.goods_info[0].id,da_obj_name:e.name,da_first_name:e.first_name,da_second_name:e.second_name,da_cpid:e.cpid,da_abtest:e.abtest,da_price:e.price,da_verify:e.verify,da_plan_id:e.plan_id,da_ext_info:e.ext_info,da_client_type:e.client_type,da_throw_type:e.throw_type};return o},_getIframeParams:function(e,t){var a,o,i,n="",s=$.getPageData,r={dapage:s("product",n).toUpperCase(),dafid:s("forum.forum_id",n),datid:s("thread.thread_id",n),dauid:s("user.user_id",n),datypeid:e.typeid,daid:e.id,dacssclass:e.className,dagoodid:e.goods_info[0].id,token:e.zhixin_token,daname:encodeURIComponent(e.name),dafirstname:encodeURIComponent(e.first_name),dasecondname:encodeURIComponent(e.second_name),dacpid:e.cpid,daabtest:e.abtest,daprice:e.price,daverify:e.verify,daextinfo:e.ext_info,daplanid:e.plan_id,daserid:e.user_id,dathrowtype:e.throw_type},d={},c={},_=e.goods_info[0].url_query;try{c=$.json.decode($.tb.unescapeHTML(_));for(a in c)if(c.hasOwnProperty(a))if("custom"==a){for(o in c[a])if(c[a].hasOwnProperty(o))switch(o){case"zhixintoken":i=c[a][o],d[i]=e.zhixintoken;break;case"forumNameGBK":i=c[a][o],d[i]=e.forumNameGBK}}else if("throw_thread"==a)for(o in c[a])c[a].hasOwnProperty(o)&&(i=c[a][o],d[i]=e[o]);else for(o in c[a])c[a].hasOwnProperty(o)&&(i=c[a][o],d[i]=encodeURIComponent(s(a+"."+o)))}catch(u){}return $.extend(!0,r,d||{},t||{}),r},_loadIframe:function(e,t,a){var o=this._addParam(t,a),i=e.find(".iframe_wrapper"),n='<iframe src="'+o+'" scrolling="no" frameborder="0"></iframe>';i.append(n)},_initMessenger:function(){var e=$.getPageData("adsense.messenger",null,window);e||(e=this.requireInstance("common/widget/messenger",["parent","checkStatus"]),e.registerOrigin(this._getMessengerWhitelist()),e.registerCommand({comforum_adsense:$.proxy(this._handleMessengerData,this)}),window.adsense={messenger:e,iframeApiUrl:"http://tb1.bdstatic.com/tb/_/iframe_api_3da97bb.js"})},_getMessengerWhitelist:function(){var e=0,t=[],a=PageUnit.load("dasense_messenger_whitelist"),o=a.length;for(e;o>e;e++)t.push(a[e][0]);return t},_handleMessengerData:function(e){var t=this.adDomMap.get(e.id),a=t.find(".iframe_wrapper");"success"===e.status?(e.height<a.height()&&a.height(e.height),t.removeClass("hide_style").show()):t.slideUp()},_addParam:function(e,t){var a="",o=[],i=-1===e.indexOf("?")?"?":"&";for(var n in t)t.hasOwnProperty(n)&&o.push(n+"="+t[n]);return a=o.join("&"),e+i+a},_clickStats:function(e,t){var a=this,o=this._getStatsParams(t);e.on("click",".j_click_stats",function(){var e=$(this).data("locate")?"_"+$(this).data("locate"):"",i=t.pos_name+e;a._track($.extend({},o,{locate:i,da_locate:i,type:"click",da_type:"click"})),a._track($.extend({},o,{locate:i,da_locate:i,type:"click",da_type:"click"}),"/billboard/pushlog/?")})},_viewStats:function(e,t){var a=this,o=!1,i=null,n=this._getStatsParams(t),s=this._getAdLocName(t),r=$.extend({},n,{locate:t.pos_name,da_locate:t.pos_name,type:"show",da_type:"show"});this._areaPushlog.add(s,r);var d=function(){o||(a._track($.extend({},n,{locate:t.pos_name,da_locate:t.pos_name,type:"show",da_type:"show"})),setTimeout(a._areaPushlog.showStats,200,s,a._track),o=!0)},c=function(){var t=e.offset().top,a=e.offset().top+e.height(),o=$("body").scrollTop(),i=$(window).height()+o,n=!1;return(t>o&&i>=t||a>o&&i>=a)&&(n=!0),n},_=$.getPageData("goods_info.0.statsCommand",null,t);_?this.observe(_,function(){c()&&(clearTimeout(i),i=setTimeout(a._areaPushlog.showStats,200,s,a._track))}):c()?d():$(window).on("scroll",function(){c()&&(clearTimeout(i),i=setTimeout(d,200))})},_areaPushlog:function(){var e={},t=function(t,a){return"DONE"==e[t]?!1:(e[t]?e[t].push(a):e[t]=[a],void 0)},a=function(e){e=e.slice(0,4);var t={obj:$.json.encode(e)};return t},o=function(e,t){1==$.tb.location.getSearchValue("showadstats")&&(console.log("%cpushlog("+e+"):","color:green;"),console.log($.json.decode(t.obj)))},i=function(t,i){if(e[t]&&"DONE"!=e[t]){var n=a(e[t]);i(n,"/billboard/pushlog/?"),e[t]="DONE",o(t,n)}};return{add:t,showStats:i}}(),_track:function(e,t){if(document.images){var a=new Image;window["bd_pv_"+(new Date).getTime()]=a;var o=t||"http://static.tieba.baidu.com/tb/img/track.gif?",i=["t="+(new Date).getTime()];for(var n in e)e.hasOwnProperty(n)&&i.push(n+"="+encodeURIComponent(e[n]));a.src=o+i.join("&"),a=null}},loadCustomJS:function(e){var t=null;e.js&&(t=$.proxy(new Function("$e","PageData","window",e.js),{}),t(e.dom,void 0,void 0))}}});_.Module.define({path:"platform/widget/iframeHead",sub:{initial:function(){this.$dom=$("#platform_iframe_head"),window._platform_iframe_head=this}}});_.Module.define({path:"common/widget/LoginDialog",sub:{_config:{apiOpt:{staticPage:"http://"+$.tb.location.getHost()+"/tb/static-common/html/pass/v3Jump.html",product:"tb",charset:PageData.charset?PageData.charset:"GBK",u:"",memberPass:!0,safeFlag:0},cache:!1,img:"",onLoginSuccess:function(t){t.returnValue=!1,$.stats.sendRequest("st_type=login_succeed&fr=tb0&st_pos="),$.tb.location.reload()},onSubmitStart:function(){$.stats.sendRequest("st_type=login_click&fr=tb0&st_pos=")},registerLink:"https://passport.baidu.com/v2/?reg&tpl=tb&u=http://tieba.baidu.com",tangram:!0},initial:function(t,s,i){var a=this,o=1;if(a._config.apiOpt.u="string"==typeof t&&""!=t?t:$.tb.location.getHref(),"string"==typeof s){switch(s){case"userBar":o=1;break;case"editor1":case"lzl":o=2;break;case"editor":o=3;break;case"lzonly":o=4;break;case"ilike":o=5;break;default:o=1}a._config.img="http://tb2.bdstatic.com/tb/static-common/img/passport/logindlg_pic"+o+".png"}else a._config.img="http://tb2.bdstatic.com/tb/static-common/img/passport/logindlg_pic"+o+".png";PageData&&(a._config.apiOpt.isQuickUser=PageData.is_quick_user||0),i&&(a._config.onLoginSuccess=i),function(t){var s="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime();t.JsLoadManager.use(["http://passport.bdimg.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(s/6e4),"http://passport.bdimg.com/passApi/js/wrapper.js?cdnversion="+Math.floor(s/6e4)],function(){t.passPopInstance||(t.passPopInstance=passport.pop.init(a._config)),t("#passport-login-pop").find(".pass-login-pop-img img").tbattr("src",a._config.img),t.passPopInstance.show(),setTimeout(function(){t("#passport-login-pop").find("input.pass-button-submit").tbattr("alog-alias","login")},1e3)},!0,"utf-8")}(window.jQuery)}}});_.Module.define({path:"common/widget/barrage/barrage_row",requires:["common/widget/barrage/barrage_message"],sub:{initial:function(t,e,i,s,n,r){var o=this;o.timer=null,o.children=[],o.children_storage=[],o.msgObject=t,o.winWidth=i,o.color=s,o.fontsize=n,o.speedList=r,o.$box=$("<li></li>").appendTo(e),o.needCount=1,o.init()},init:function(){function t(){e.move(),e.timer=setTimeout(t,i)}var e=this,i=document.documentMode&&document.documentMode>=9?15:15;e.updateSpeed(),e.timer=setTimeout(t,i)},random:function(t){var e=Math.floor(Math.random()*t);return e==t?this.random(t):e},updateSpeed:function(){this.speed=this.speedList[this.random(this.speedList.length)],this.time=this.random(10)},getColor:function(){var t,e;return this.curColor&&this.curColor.length||(this.curColor=this.color.slice()),e=this.random(this.curColor.length),t=this.curColor[e],this.curColor.splice(e,1),t},getFontsize:function(){var t,e;return this.curFontsize&&this.curFontsize.length||(this.curFontsize=this.fontsize.slice()),e=this.random(this.curFontsize.length),t=this.curFontsize[e],this.curFontsize.splice(e,1),t},needChild:function(){this.needCount++},getNewChild:function(){var t,e,i,s=this.msgObject.get()||"",n=this.getColor(),r=this.getFontsize(),o=this.winWidth,h=this.children;if((t=h.length)&&(i=h[t-1].$element)?(e=i.width()+parseInt(i.css("left"))+100,o/2>e&&(e=o-this.random(100))):e=o,this.children_storage.length){var d=this.children_storage.shift();d.reinitial(s,this.$box,this.winWidth,e,n,r,this)}else var d=this.requireInstance("common/widget/barrage/barrage_message",[s,this.$box,this.winWidth,e,n,r,this]);h.push(d)},move:function(){var t,e,i=this,s=i.children;for(t=0,e=s.length;e>t;t++){if("need"==s[t].needBrother&&(s[t].needBrother=!1,this.needChild()),"start"==s[t].status&&(this.updateSpeed(),s[t].status="moveing"),"over"==s[t].status){this.children_storage.push(s[t]),s.splice(t,1),t--,e--;break}"moveing"==s[t].status&&s[t].move(this.speed)}},dispose:function(){clearTimeout(this.timer)}}});
;_.Module.define({path:"common/widget/barrage/barrage_message",requires:[],sub:{tmp:['<div class="opui-barrage-message" style="left:#{left}px;color:#{color};font-size:#{fontsize}">#{message}</div>'].join(""),initial:function(t,e,s,i,n,h,l){var o=$.tb.format(this.tmp,{left:s,color:n,fontsize:h,message:t}),a=$(o).appendTo(e),r=this;this.father=l,this.$element=a,this.element=this.$element.get(0),this.width=this.$element.width(),this.halfWidth=this.width/2,this.winWidth=s,this.needListen=!0,a.css("opacity",.1),this.stepTo(i,1,function(){r.status="start",r.curLeft=parseInt(a.css("left"))})},reinitial:function(t,e,s,i,n,h){this.$element.html(t),this.$element.css({color:n,"font-size":h,left:s}),this.$element.show(),this.status=null,this.$element.css("opacity",.1),this.needListen=!0;var l=this.$element,o=this;this.stepTo(i,1,function(){o.status="start",o.curLeft=parseInt(l.css("left"))})},stepTo:function(t,e,s){this.$element.animate({left:t+"px",opacity:e},300,s)},move:function(t){var e=this.$element,s=this,i=s.width;return s.curLeft-=t,this.element.style.left=s.curLeft+"px",i+s.curLeft<s.halfWidth?(s.status="over",s.needListen&&s.tellNeed(),s.stepTo(-i,0,function(){e.hide()}),void 0):(s.needListen&&i+s.curLeft<s.winWidth-300&&s.tellNeed(),void 0)},tellNeed:function(){var t=this;t.needBrother="need",t.needListen=!1}}});
;_.Module.define({path:"common/widget/barrage",requires:["common/widget/barrage/barrage_message","common/widget/barrage/barrage_row","common/widget/LoginDialog"],sub:{$win:$(window),IE6:window.ActiveXObject&&!window.XMLHttpRequest,initial:function(t){var i=this;t=t||{},i.is_login=t.is_login,i.$container=$(t.container||"body"),i.rowList=[],i.color=t.color||["#ffb400","#04aef5","#ddd","#ffb400","#04aef5","#ddd"],i.fontsize=t.fontsize||["26px","30px","38px"],i.speedList=t.speedList||[3,4,5,6,7],i.commetHeight=t.commetHeight||100,i.msgObject=i.createMsgObject(t),i.closeBtnCallback=t.closeBtnCallback,i.winWidth=t.winWidth||null,i.winHeight=t.winHeight||null},setFontSize:function(t){"undefined"!=typeof t&&t.length&&(this.fontsize=Array.prototype.slice.call(t,0))},createMsgObject:function(t){var i={list:t.list,maxLength:t.listLength||200,curIndex:-1,get:function(){var t,i=this,e=i.list||[],n=i.curIndex;return(n>=e.length||0>n)&&(n=e.length-1),t=e[n],i.curIndex=n-1,t?"string"==typeof t?t:'<span class="'+t.classname+'">'+t.text+"</span>":void 0},update:function(t){var i=this;i.list=i.list.concat(t),i.list.length>i.maxLength&&(i.list=i.list.slice(0,i.maxLength)),i.reset()},insert:function(t){var i=this;i.timer=setTimeout(function(){i.list.splice(i.curIndex,0,{text:t,classname:"opui-barrage-self-message"})},0)},replaceList:function(t){var i=this;isFinite(t.length)&&(i.list=t,i.reset())},reset:function(){this.list&&(this.curIndex=this.list.length-1)}};return i},update:function(t){this.msgObject.update(t)},insert:function(t){this.msgObject.insert(t)},replaceList:function(t){this.msgObject.replaceList(t)},start:function(){var t=this;t.stop(),t.msgObject.reset(),t.winHeight=t.winHeight||t.$win.height(),t.winWidth=t.winWidth||t.$win.width(),t.initElements(),t.bindEvent(),t.setTimer()},stop:function(){var t=this;$.each(t.rowList,function(t,i){i.dispose()}),t.rowList=[],clearInterval(t.timer),t.form&&t.form.dispose(),t.$box&&t.$box.remove(),t.$box=t.$content=null},restart:function(){this.stop(),this.start()},autoSize:function(t){"undefined"!=typeof t&&(this.commetHeight=t),this.winWidth=this.$box.width(),this.winHeight=this.$box.height(),this.restart()},bindEvent:function(){var t=this;t.$win.on("resize",function(){}),t.$box.find(".opui-barrage-closebtn a").on("click",t.closeBtnCallback||function(){t.stop(),$.stats.track("\u5173\u95ED\u6309\u94AE\u70B9\u51FB","\u8BDD\u9898\u8D34\u5F39\u5E55")}),t.$box.find(".opui-submit-form-text").on("click",function(){if(t.stop(),t.is_login){var i=$('<div class="opui-submit-form-mask"></div>').css("opacity","0"),e=3,n=function(){i.animate({opacity:".4"},100,function(){s()})},s=function(){i.animate({opacity:".0"},100,function(){--e?n():(i.hide().remove(),$("#tt_text_cnt").css("position",""),$("#tt_invite, #j_ed_container").focus())})};$("#tt_text_cnt").css("position","relative").append(i.show()),$(window).scrollTop($("#tt_text_cnt").offset().top-200),n(),$.stats.track("\u53D1\u8868\u6309\u94AE\u70B9\u51FB_\u5DF2\u767B\u5F55","\u8BDD\u9898\u8D34\u5F39\u5E55")}else this.requireInstanceAsync("common/widget/LoginDialog",[]),$.stats.track("\u53D1\u8868\u6309\u94AE\u70B9\u51FB_\u672A\u767B\u5F55","\u8BDD\u9898\u8D34\u5F39\u5E55")})},initElements:function(){var t,i,e,n,s=this,o='<div class="opui-barrage-box">                        <div class="opui-barrage-mask"></div>                        <div class="opui-barrage-content">                            <div class="opui-barrage-closebtn-box">                                <div class="opui-barrage-closebtn">                                    <div class="opui-barrage-closebtn-bg"></div>                                    <a href="javascript:;" class="OP_LOG_BTN" data-click="{fm:\'beha\'}"></a>                                </div>                            </div>                            <ul class="opui-barrage-listbox">                            </ul>                        </div>                    </div>';s.$box=$(o).appendTo(s.$container),s.IE6&&s.$box.css({height:s.$win.height(),width:s.$win.width()}),s.$content=this.$box.find(".opui-barrage-content"),t=s.$box.height()-40-60,t=s.$box.height(),n=s.$box.find(".opui-barrage-listbox"),i=Math.floor(t/s.commetHeight);var a;for(e=0;i>e;e++)a=this.requireInstance("common/widget/barrage/barrage_row",[s.msgObject,n,s.winWidth,s.color,s.fontsize,s.speedList]),s.rowList.push(a)},setTimer:function(){var t=this,i=[];t.timer=window.setInterval(function(){var e,n,s=t.rowList;for(e=0,n=s.length;n>e;e++)s[e].needCount&&(i.push(s[e]),s[e].needCount--);i[0]&&(i[0].getNewChild(),i.shift())},200)},dispose:function(){var t=this;t.stop(),clearTimeout(t.msgObject.timer)},refresh:function(t){this.replaceList(t)},getText:function(t){var i=t.contents;return/1/.test(t.rtype)?i="":(i=i.replace(/(\[+f+a+c+e+\]).*(\[+\/+f+a+c+e+\])/gi,""),i=i.replace(/[\u3000\s]+/gi," "),i=i.length>30?i.substring(0,30)+"...":i),i}}});