_.Module.define({path:"common/widget/AsideFloatBar",requires:["common/widget/tbshare"],sub:{initial:function(t){"undefined"!=typeof PDC&&PDC.mark("c_afbavi"),this.options=t,this.$root=$('<ul class="tbui_aside_float_bar"></ul>');for(var e=0,i=t.buttons.length;i>e;e++){var a=t.buttons[e];this.addButton(a)}this.$root.appendTo("body");var r=this;r.relocate(),$(window).resize(function(){r.relocate()});var o=PageData.product;if("pb"==o&&(this.$root.find(".tbui_fbar_favor").on("mouseenter",function(){$.stats.track("PB\u60AC\u6D6E\u7231\u901B\u7684\u5427","\u8D34\u5427PC\u9875\u9762\u4F18\u5316","pb","click"),$(this).find(".tbui_aside_favor_list a").one("click",function(){$.stats.track("PB\u60AC\u6D6E\u7231\u901B\u5427\u5C55\u5F00\u5427","\u8D34\u5427PC\u9875\u9762\u4F18\u5316","pb","click")})}),this.$root.find(".tbui_fbar_square").on("click",function(){$.stats.track("\u79C0\u5427\u5BFC\u822A","pb_\u5427\u53F3\u4FA7\u5BFC\u822A","pb","click")})),"frs"==o&&this.$root.find(".tbui_fbar_square").on("click",function(){$.stats.track("\u79C0\u5427\u5BFC\u822A","frs_\u5427\u53F3\u4FA7\u5BFC\u822A","frs","click")}),"frs"==o||"pb"==o||"pb_bright"==o){if("frs"==o)var n=["\u79C0\u5427\u5BFC\u822A","\u53D1\u5E16","\u5237\u65B0","\u5206\u4EAB","\u7231\u901B\u7684\u8D34\u5427","\u63A8\u8350\u6E38\u620F","\u5B9E\u9A8C\u5BA4","\u8FD4\u56DE\u9876\u90E8"];else var n=["\u79C0\u5427\u5BFC\u822A","\u9B54\u6CD5\u9053\u5177","\u795E\u6765\u4E00\u53E5","\u5206\u4EAB","\u7231\u901B\u7684\u8D34\u5427","\u5B9E\u9A8C\u5BA4","\u53EC\u5524\u5EA6\u5A18","\u8FD4\u56DE\u9876\u90E8"];o="pb"==o||"pb_bright"==o?"pb":"frs",this.$root.delegate(".tbui_aside_fbar_button","mouseenter",function(t){var e=$(t.target),i=e.parent().index();return 6===i?!1:($.stats.track(n[i]+"\u70B9\u51FB\u91CF","FRS/PB\u53F3\u4FA7\u5DE5\u5177\u680F\u7EDF\u8BA1",o,"click"),void 0)})}},addButton:function(t){var e=$($.tb.format('<li class="tbui_aside_fbar_button tbui_fbar_#{btnName}"><a href="#"></a></li>',{btnName:t})),i=this["_"+t];i&&i.call(this,e)&&this.$root.append(e);var a=this;$("body").click(function(){a.hidePanel()})},hidePanel:function(){$("#bdshare_tb_l").hide(),$(".tbui_aside_smiley").hide(),$("#tbui_aside_favor_list").hide(),$(".tbui_aside_props_list").hide()},relocate:function(){$(window).width()<1105?this.$root.addClass("tbui_afb_compact"):this.$root.removeClass("tbui_afb_compact")},_square:function(t){return t.children().tbattr("href","/f?kw=%D0%E3"),t.children().tbattr("target","_blank"),!0},_top:function(t){var e=$(window);0==e.scrollTop()&&t.css("visibility","hidden"),t.click(function(t){function i(){r=Math.floor(r/2),window.scrollTo(0,r),r>2?a=setTimeout(i,40):(window.scrollTo(0,0),clearTimeout(a))}t.preventDefault();var a=null,r=e.scrollTop();$.browser.msie?window.scrollTo(0,0):i()});var i,a=!1;return e.bind("scroll",function(){i&&clearTimeout(i),i=setTimeout(function(){e.scrollTop()>0?0==a&&(t.css("visibility","visible"),a=!0):a&&(t.css("visibility","hidden"),a=!1)},500)}),!0},_refresh:function(t){return t.click(function(){return window.Path?window.Path.refresh():$.tb.location.reload(),!1}),!0},_post:function(t){var e=this;return t.children().tbattr("href","#sub"),t.click(function(t){t.preventDefault(),t.stopPropagation(),setTimeout(function(){e.fire("wanna_post")},50)}),!0},_share:function(t){return this.requireInstance("common/widget/tbshare/tbshare_popup",[{$container:t.find("a")}]),!0},_radar:function(t){var e=this;return t.find("a").append('<img src="http://tb2.bdstatic.com/tb/static-common/img/toolbar/radar_51d309d.gif" class="tbui_radar_img" />'),t.find("a").tbattr({href:$.tb.unescapeHTML(e.options.radarData&&e.options.radarData.link),target:"_blank"}),t.on("mousedown","a",function(){$.stats.track("radar","radar_banner")}),$.browser.msie&&7==$.browser.version&&t.css("marginBottom","-4px"),$.browser.msie&&6==$.browser.version&&(t.append("<div></div>"),t.css("marginBottom","-3px")),!0},_tsukkomi:function(t){var e=this;$.browser.msie&&7==$.browser.version&&t.css("marginBottom","-4px"),$.browser.msie&&6==$.browser.version&&t.css("marginBottom","-3px").append("<div></div>");var i=$('<div class="tbui_aside_smiley"></div>');return t.append(i),_.Module.use("common/component/InterestSmiley",{container:i,smileClass:"t_smile_bg",type:"toolbar",scrollCss:{padding:"9px 0px 0px 0px"},scrollBarHide:function(){i.width(296)},scrollBarShow:function(){i.width(306)},dataPostor:e.options.dataPostor},function(a){e.interestSmile=a,e.interestSmile.generic(),t.on("mouseenter",function(){e.hidePanel()}),t.delayhover({enterDelay:300,leaveDelay:700,mouseenter:function(){i.fadeIn(),e.interestSmile.scrollPanel&&e.interestSmile.scrollPanel.setHeight(156)},mouseleave:function(){i.fadeOut()}}).children("a").click(function(t){t.preventDefault(),t.stopPropagation()})}),!0},_favor:function(t){var e="http://tb2.bdstatic.com/tb/static-common/widget/aside_float_bar/images/loading2_a8a93d0.gif";if(0==PageData.user.is_login)return!1;var i=PageData.user.id,a="/p/getLikeForum",r=[];$.browser.msie&&6==$.browser.version&&(t.append("<div></div>"),t.css("marginBottom","-3px"));var o=$('<ul class="tbui_aside_favor_list clearfix" id="tbui_aside_favor_list"></ul>'),n='<li class="j_favor_loading"><div class="favor_loading"><img src="'+e+'">\u6B63\u5728\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E\u3002\u3002\u3002</div></li>';o.append(n),$.ajax({url:a,dataType:"json",type:"GET",data:{uid:i}}).done(function(t){if(t&&0===t.errno){if(t.data&&t.data.info&&(r=t.data.info),0==r.length)return!1;if(r.length>0){var e,i=r,a=!1;i.length<=8?e=i.length:(e=7,a=!0),o.find(".j_favor_loading").hide();for(var n=0;e>n;n++){var s={kw:encodeURIComponent(i[n].forum_name),forumName:$.tb.subByte(i[n].forum_name,12)};o.append($.tb.format('<li><a href="http://tieba.baidu.com/f?ie=utf-8&kw=#{kw}" target="_blank" class="ui_text_summary">#{forumName}</a></li>',s))}a&&o.append('<li><a target="_blank" class="ui_text_desc" href="http://tieba.baidu.com/home/forum?id='+PageData.user.portrait+'" class="aside_float_favforum_more">\u66F4\u591A&gt;&gt;</a></li>')}}}),o.hide().appendTo(t);var s=this;return t.on("mouseenter",function(){s.hidePanel()}),t.delayhover({enterDelay:300,leaveDelay:700,mouseenter:function(){o.fadeIn()},mouseleave:function(){o.fadeOut()}}).children("a").click(function(t){t.preventDefault(),t.stopPropagation()}),!0},_lab:function(t){t.children().tbattr("target","_blank").tbattr("href","http://tieba.baidu.com/idea/index");var e=$("<div class='tbui_aside_lab_tip'></div>");if(t.append(e),$.tb.Storage.remove("close_cm_bubble"),"1"!=$.tb.Storage.get("close_mt_bubble")&&+new Date<+new Date(2015,6,19)){var i={content:"<span class='ui_text_emphasize'>\u5FEB\u6377\u952E\u8D34\u5427</span>\u4E0A\u7EBF\u5566\uFF0C\u5FEB\u6765\u4F53\u9A8C\u5427~",arrow_dir:"right",bubble_css:{top:0,right:50,width:150},wrap:e,closeBtn:!0},a=new UiBubbleTipBase(i);a.bind("onclose",function(){$.tb.Storage.set("close_mt_bubble","1",(new Date).getTime()+6048e5),a.closeBubble()}),a.j_bubble.show()}return!0},_home:function(t){return t.children().tbattr("href","http://www.baidu.com?tn=SE_hldp03460_124vf6k4"),t.children().addClass("j_aside_float_bar_go_home"),t.children().tbattr("target","_blank"),!0},_props:function(t){var e=this,e=this;return t.on("mouseenter",function(){e.hidePanel()}),_.Module.use("props/widget/MagicProps",{wrap:t,propsData:e.options.propsData},function(e){e.visible?$.browser.msie&&6==$.browser.version&&(t.append("<div></div>"),t.css("marginBottom","-3px")):t.css("display","none")}),!0}}});_.Module.define({path:"common/widget/IframeBuilder",requires:["common/widget/messenger"],sub:{_TIMEOUTTYPE:{UNDO:0,REFRESH:1,HIDE:2,SHOW:3},_WHITELIST:["http://www.xiu8.com","http://tieba.baidu.com","http://baidu.yy.tv","http://baidu.huya.com"],_styleList:"",initial:function(){window.iframeData||this.initIframeData()},iframe:function(e){{var a=$.extend(!0,{},e),t=$(a.wrap||"body"),i="iframe_"+a.iframe_id,r=parseInt(a.width),s=parseInt(a.height),n=a.clazz,f=a.name,o=1==a.replace,d=a.src,m=this.getStyleList(r,s),c=['<iframe name="'+f+'"',' id="'+i+'"',' class="'+n+'"',' src=""',' style="'+m+'"'," frameborder=0",' scrolling="no"',' allowTransparency="true"></iframe>'].join(" "),_=$(c);_.get(0).src=$.tb.unescapeHTML(d)}o?_.replaceAll(t):t.append(_),this.initIframe(e)},initIframeData:function(){window.iframeData=window.iframeData||{},window.iframeData._cache=window.iframeData._cache||{},window.iframeData.getIframe=function(e){var a=window.iframeData._cache;return a[e]?a[e]:null},window.iframeData.setIframe=function(e,a){var t=window.iframeData._cache;if(t[e]=t[e]||{},"object"!=typeof a)throw"Iframe list id's type must be a object!";t[e]=$.extend(!0,t[e],a)},window.iframeData.getPostMsg=function(e){var a=window.iframeData.getIframe(e)||{};return a.msg},window.iframeData.getDom=function(e,a){var t=window.iframeData.getIframe(e)||{};return 1==a?"iframe_"+e:t.dom},window.iframeData.getReady=function(e){var a=window.iframeData.getIframe(e);return a.ready||$.Callbacks()},window.iframeData.setReady=function(e,a){var t=window.iframeData.getIframe(e)||{},i=window.iframeData.getReady(e)||$.Callbacks();return"function"==typeof a?(1==t.success?a():(i.add(a),window.iframeData.setIframe(e,{ready:i})),!0):!1},window.iframeData.fireReady=function(e){var a=window.iframeData.getReady(e)||$.Callbacks();a.fire()}},initIframe:function(e){var a=this;e.timeout_type=e.timeout_type||"HIDE";var t=this.conf=$.extend({wait_time:1e4,timeout_type:"HIDE"},e),i=t.iframe_id,r=t.project_id,s=(t.src,parseInt(t.wait_time)),n=(this._TIMEOUTTYPE[t.timeout_type],t.origin_url);this.stats="object"==typeof e.stat?e.stat:{},window.iframeData=window.iframeData||{};var f=document.getElementById("iframe_"+i);if(f){this.start_time=1*new Date;var o=window.iframeData.getPostMsg(i);o||(o=this.use("common/widget/messenger","tb_Iframe_"+1*new Date,r),o.addTarget(f.contentWindow,i),n&&"string"==typeof n&&o.registerOrigin([n]),o.registerCommand({loadready:function(e){return a.onLoadReady(e,i,f),{no:0,msg:"success"}}})),o.targets[i].send($.json.encode({command:"loadready_ask",data:{no:0,msg:"success"}})),setTimeout(function(){a.onTimeoutHandler(f)},s),window.iframeData.setIframe(i,{dom:f,msg:o,callback:[]})}},doRefresh:function(){var e=this,a=this.conf||{},t=$(iframeData.getDom(a.iframe_id)),i=this.getStyleList(),r=(parseInt(a.height),200),s=["<div ",' class="iframe_refresh_dialog"',' id="iframe_refresh_'+a.iframe_id+'"',' style="'+i+'"'," >",'<div class="iframe_refresh_alert" style="margin-top:'+r+'px">','<div class="iframe_refresh_animate"></div>','<div class="iframe_refresh_alert_title">\u7EB3\u5C3C\uFF01\u5E94\u7528\u88AB\u866B\u6D1E\u5403\u6389\u5566\uFF0C\u70B9\u51FB\u5237\u65B0\u7B49\u7B49\u770B~</div>','<div class="iframe_refresh_operate"><a href="#" class="iframe_refresh_btn j_iframe_refresh_btn">\u70B9\u51FB\u5237\u65B0</a></div>',"</div>","</div>"].join(" "),n=$(s);n.replaceAll(t),n.find(".j_iframe_refresh_btn").click(function(a){a.preventDefault(),e.iframe($.extend(e.conf,{wrap:n,replace:!0}))}).mouseenter(function(){n.find(".iframe_refresh_animate").addClass("iframe_refresh_animate_do")})},doRefresh2:function(){var e=this,a=this.conf||{},t=$(iframeData.getDom(a.iframe_id)),i=t.offset()||{top:0},r=Math.max(i.top,0),s=r+200,n=['<div class="iframe_refresh_alert" style="z-index:9999;position:absolute;left:50%;margin-left:-150px;top:'+s+'px">','<div class="iframe_refresh_animate"></div>','<div class="iframe_refresh_alert_title">\u7EB3\u5C3C\uFF01\u5E94\u7528\u88AB\u866B\u6D1E\u5403\u6389\u5566\uFF0C\u70B9\u51FB\u5237\u65B0\u7B49\u7B49\u770B~</div>','<div class="iframe_refresh_operate"><a href="#" class="iframe_refresh_btn j_iframe_refresh_btn">\u70B9\u51FB\u5237\u65B0</a></div>',"</div>"].join(" "),f=$(n);f.appendTo("body"),f.find(".j_iframe_refresh_btn").click(function(a){a.preventDefault(),e.iframe($.extend(e.conf,{wrap:t,replace:!0})),f.remove()}).mouseenter(function(){f.find(".iframe_refresh_animate").addClass("iframe_refresh_animate_do")})},doHide:function(){var e=this.conf||{},a=$(iframeData.getDom(e.iframe_id));a.remove()},getStyleList:function(e,a){var t=this.conf||{};return e=e||parseInt(t.width),a=a||parseInt(t.height),this._styleList=this._styleList||"width:100%;margin:0 auto;"+(a?"height:"+a+"px;":"")+(e?"width:"+e+"px;":"")+"display:block;",this._styleList},isWhiteList:function(e){return!!_.filter(this._WHITELIST||[],function(a){return e.indexOf(a)>=0}).length},onTimeoutHandler:function(){var e=this,a=this._TIMEOUTTYPE[this.conf.timeout_type],t=window.iframeData.getIframe(this.conf.iframe_id);if(!t.success){if(this.sendStat(1,0),0===a)return;1===a&&e.stats&&[2000046,2100001,2000086].indexOf(parseInt(e.stats.scene_id))>=0&&e.doRefresh()}},_isLoadReady:0,onLoadReady:function(e,a,t){if(1!==this._isLoadReady){var i=0,r=this._TIMEOUTTYPE[this.conf.timeout_type];this.end_time=1*new Date,i=this.end_time-this.start_time,0==e.no&&(this._isLoadReady=1,window.iframeData.setIframe(a,{success:1,loadInfo:e.data}),3===r&&$(t).show(),window.iframeData.fireReady(a)),this.sendStat(e.no,i)}},sendStat:function(e,a){var t=this,i={app_id:"",class_type:"",app_class1:"",app_class2:"",app_unique_id:"",scene_id:"",forum_id:PageData.forum?PageData.forum.forum_id:"",from:PageData.page,host_url:$.tb.location.getHref(),task:"",locate:"",iframe_url:t.conf.src,is_load_suc:Number(0===e),ready_time:a},r=$.extend(i,this.stats);r.task&&$.ajax({url:"/appmonitor/log/stable",type:"post",data:r})}}});_.Module.define({path:"frs/widget/bdMusic",requires:[],sub:{__wrap:$("#bd_music"),iframe:$("#bd_music .fm-wrap"),initial:function(){try{var t=this;t.__wrap.find(".fold").show(),t.bindEvents(),t.iframe.tbattr("status","close"),"true"!=$.cookie("close_music")&&(t.iframe.tbattr("status","open").animate({width:"500px"}),t.__wrap.find(".arrow").show(),t.__wrap.find(".channel-title").hide())}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/bd_music/bd_music.js",method:"",ln:23}),i}},bindEvents:function(){var t=this;this.__wrap.on("click",".j_fold",function(){try{t.open_or_close_iframe()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/bd_music/bd_music.js",method:"",ln:28}),i}})},open_or_close_iframe:function(){var t=this;"close"==t.iframe.tbattr("status")?($.cookie("close_music","false",{expires:3}),$.stats.track("\u5C55\u5F00","\u542CTa\u7684\u6B4C\u66F2","frs","click",{}),t.iframe.tbattr("status","open").animate({width:"500px"}),t.__wrap.find(".arrow").show(),t.__wrap.find(".channel-title").hide()):($.cookie("close_music","true",{expires:3}),$.stats.track("\u6536\u8D77","\u542CTa\u7684\u6B4C\u66F2","frs","click",{}),t.iframe.tbattr("status","close").animate({width:"0px"}),t.__wrap.find(".arrow").hide(),t.__wrap.find(".channel-title").show())}}});_.Module.define({path:"frs/widget/DlBubble",sub:{initial:function(){try{var e={content:'<p class="bubble_dl">'+PageUnit.load("dl_bubble_txt")+"</br>"+PageUnit.load("dl_bubble_link")+"</p>",arrow_dir:"down",bubble_css:{width:140,height:90,"z-index":$.getcurzIndex(),top:-90,left:-50},arrow_pos:{left:68},wrap:$(".tbui_aside_float_bar"),closeBtn:!0,level:1,arrowReq:!0},l=new UiBubbleTipBase(e),b=$.cookie("dlBubbleFlag");1!=b&&"1"==PageUnit.load("dl_bubble_switch")&&l.showBubble(),l.bind("onclose",function(){$.cookie("dlBubbleFlag",1,{expire:1}),l.closeBubble()}),$(window).on("resize",function(){var e=$(".tbui_aside_float_bar").css("left");"auto"==e?$(".j_dl_bubble").css({right:-22,left:"auto"}):$(".j_dl_bubble").css("left","50%")})}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/dl_bubble/dl_bubble.js",method:"",ln:44}),t}}}});_.Module.define({path:"pplatform/widget/LocalityPopWindow",requires:[],sub:{initial:function(t,o){var i=$.parseJSON(t);i&&(this.pageMap={0:"FRS",1:"PB","0,1":"\u5168\u90E8"},this.windowTypeMap={1:"\u56FE\u7247\u5F39\u7A97","00":"\u6587\u5B57\u5F39\u7A97_\u6837\u5F0F\u4E00","01":"\u6587\u5B57\u5F39\u7A97_\u6837\u5F0F\u4E8C"},this.popWindow=$(".locality_pop_window_wrap"),this.bindEvents(i,o),this.runStrategy(i))},bindEvents:function(t,o){var i=this,a=i.pageMap[t.position],e="1"==t.type?t.type:t.type.toString()+t.subtype.toString();e=i.windowTypeMap[e],$(".locality_pop_window_wrap").on("click",".locality_pop_head_close_btn",function(o){o.preventDefault(),$.stats.track("\u6587\u5B57\u5F39\u7A97\u5173\u95ED\u6309\u94AE",t.taskName,a,"click"),i.hidePop(),i.clearStrategy(t)}).on("click",".locality_pop_window_pic_close_btn",function(o){o.preventDefault(),$.stats.track("\u56FE\u7247\u5F39\u7A97\u5173\u95ED\u6309\u94AE",t.taskName,a,"click"),i.hidePop(),i.clearStrategy(t)}).on("click",".j_local_pic_pop_window",function(){$.stats.track("\u5730\u65B9\u5427\u5F39\u7A97_"+e,t.taskName,a,"click",{popWindowType:e,obj_id:t.adId})}).on("click",".locality_pop_text_img",function(){$.stats.track("\u5730\u65B9\u5427\u5F39\u7A97_"+e,t.taskName,a,"click",{popWindowType:e,obj_id:t.adId})}).on("click",".locality_pop_text_title",function(){$.stats.track("\u5730\u65B9\u5427\u5F39\u7A97_"+e,t.taskName,a,"click",{popWindowType:e,obj_id:t.adId})}).on("click",".local_pop_window_content",function(){$.stats.track("frs"==o?73:75,t.taskName,a,"click",{popWindowType:e,taskName:t.taskName,tbjump:t.link,obj_id:t.adId})})},runStrategy:function(t){var o=$.cookie("locality_pop_window_"+t.adId);if(!o||0>o)this.resetStrategy(t),this.stepStrategy(t);else{if(0==o)return;this.stepStrategy(t)}this.showPop(t)},resetStrategy:function(t){$.cookie("locality_pop_window_"+t.adId,1)},stepStrategy:function(t){var o=$.cookie("locality_pop_window_"+t.adId);$.cookie("locality_pop_window_"+t.adId,++o)},clearStrategy:function(t){$.cookie("locality_pop_window_"+t.adId,0)},showPop:function(){var t=this,o=setTimeout(function(){t.popWindow.show().css("bottom","-280px").animate({bottom:0},500),clearTimeout(o),o=null},2e3)},hidePop:function(){this.popWindow.animate({bottom:"-280px"},500,function(){$(this).hide()})}}});_.Module.define({path:"common/widget/PlatformSpreadVideo",requires:[],sub:{ANIMATE_STYLE:{UP:1,DOWN:2},videoHeight:255,ch:document.documentElement.clientHeight||document.body.clientHeight,cw:document.documentElement.clientWidth||document.body.clientWidth,initial:function(t,o){var e=$.cookie("platform_spread_video_"+o),i=$.cookie("platform_video_spread_close_"+o),a=$.cookie("platform_video_spread_autoShow_"+o),n=null!=i,d=null==e&&!parseInt(e),s=$.browser.msie&&6==Number($.browser.version);return this.swfURL=t,this.opt=o,this.$videoWrap=$("#platform_spread_video"),this.$videoTopHeads=this.$videoWrap.find(".platform_video_head"),this.$videoContent=this.$videoWrap.find(".platform_video_content"),this.$upHead=this.$videoTopHeads.eq(0),this.$downHead=this.$videoTopHeads.eq(1),this.$downBtn=this.$upHead.find(".head_down_btn"),this.$upBtn=this.$downHead.find(".head_up_btn"),this.$closeBtns=this.$videoTopHeads.find(".head_close_btn"),this.shouldShowVideo=d,s||n?(this.$videoWrap.hide(),void 0):($.stats.track("\u6574\u4F53","\u8D34\u5427\u89C6\u9891",PageData.product,"show",{obj_type:"\u5E73\u53F0\u5316",obj_name:o}),d&&null==a?($.cookie("platform_video_spread_autoShow_"+o,1,{expires:999,path:"/"}),this._animateTo(this.ANIMATE_STYLE.UP)):this._animateTo(this.ANIMATE_STYLE.DOWN),this._bindEvent(),void 0)},_animateTo:function(t){var o=this,e=o.$videoWrap,i=o.$videoContent,a=o.$downHead,n=o.$upHead,d=o.opt;t&o.ANIMATE_STYLE.UP?($.stats.track("\u89C2\u770B","\u8D34\u5427\u89C6\u9891",PageData.product,"show",{obj_type:"\u5E73\u53F0\u5316",obj_name:d}),i.show(),e.animate({bottom:0},600,function(){a.hide(),n.show(),setTimeout(function(){$.stats.track("\u6709\u6548\u89C2\u770B","\u8D34\u5427\u89C6\u9891",PageData.product,"show",{obj_type:"\u5E73\u53F0\u5316",obj_name:d})},5e3)}),o._loadSwf()):e.animate({bottom:-1*o.videoHeight},600,function(){i.hide(),n.hide(),a.show()})},_bindEvent:function(){var t=this,o=t.$videoWrap,e=t.$closeBtns,i=t.$upBtn,a=t.$downBtn,n=t.opt;e.on("click",function(){return $.stats.track("\u5173\u95ED\u6309\u94AE","\u8D34\u5427\u89C6\u9891",PageData.product,"click",{obj_type:"\u5E73\u53F0\u5316",obj_name:n}),$.cookie("platform_video_spread_close_"+n,1,{expires:999,path:"/"}),o.hide(),!1}),i.on("click",function(){return t._animateTo(t.ANIMATE_STYLE.UP),!1}),a.on("click",function(){return $.stats.track("\u6536\u8D77\u6309\u94AE","\u8D34\u5427\u89C6\u9891",PageData.product,"click",{obj_type:"\u5E73\u53F0\u5316",obj_name:n}),t._animateTo(t.ANIMATE_STYLE.DOWN),!1}),a.one("click",function(){return $.cookie("platform_video_spread_"+n,1,{expires:999,path:"/"}),!1})},_loadSwf:function(){{var t=this,o=t.swfURL,e=t.opt;t.$videoContent}new $.swf(o,{id:"platform_video_spread_"+e,container:"#j_platform_video_content",width:340,height:255})}}});_.Module.define({path:"frs/widget/stats",sub:{_configs:{forum:null,forum_url:null,version:null},initial:function(t,e){try{if(this._configs=$.extend(this._configs,t),null!=e)for(var a=0;a<e.length;a++){var s=this["st_"+e[a]];"function"==typeof s&&s.call(this)}}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/stats/stats.js",method:"",ln:28}),i}},st_concreteBa:function(){},st_albumSubject:function(){$("#content_leftList").on("mousedown",".j_thread_list_albumgood a.j_th_tit",function(){$.stats.sendRequest("fr=tb0_forum&st_mod=frs&st_value=threadphotogood")})},st_newFrs:function(){var t=this._configs.bacard_smallflow,e="fr=tb0_forum&st_type=bacard_frs&smallflow="+t+"&st_version=bright&st_mod=";$("#thread_list").delegate("a.j_th_tit,.j_m_pic_light,.j_img_more","click",function(){try{var t,a=$(this);a.hasClass("j_th_tit")&&(t=e+"title_click"),a.hasClass("j_m_pic_light")&&(t=e+"pic_click"),a.hasClass("j_img_more")&&(t=e+"morepic_click"),$.stats.sendRequest(t)}catch(s){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:s.message||s.description,path:"frs:widget/stats/stats.js",method:"",ln:47}),s}}),$("#head").find(".j_enter_ba").mousedown(function(){$.stats.sendRequest($("#head").find(".search_main_fixed").length>0?e+"enterba&search_type=enterba_fixed":e+"enterba");var t={st_mod:"frs_search",st_type:"enterba",st_uid:PageData.user?PageData.user.id:0,st_benba:PageData.forum.name,st_goto:$("#wd1").val()};$.tb.Stats.sendRequest("http://tb1.bdstatic.com/tb/img/hive.gif",t)}),$("#head").find(".j_search_post").mousedown(function(){$.stats.sendRequest($("#head").find(".search_main_fixed").length>0?e+"global_search&search_type=global_search_fixed":e+"global_search")}),$("#tb_nav").find(".search_internal_btn").mousedown(function(){$.stats.sendRequest(e+"benba_search")})},st_oldFrs:function(){var t=this._configs.bacard_smallflow,e="fr=tb0_forum&smallflow="+t+"&st_type=bacard_frs&st_version=rich&st_mod=";$("#thread_list").delegate("a.j_th_tit,.j_m_pic_light","click",function(){try{var t=$(this);t.hasClass("j_th_tit")&&(st_param=e+"title_click"),t.hasClass("j_m_pic_light")&&(st_param=e+"pic_click"),$.stats.sendRequest(st_param)}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/stats/stats.js",method:"",ln:85}),a}}),$("#search_submit").mousedown(function(){$.stats.sendRequest(e+"enterba");var t={st_mod:"frs_search",st_type:"enterba",st_uid:PageData.user?PageData.user.id:0,st_benba:PageData.forum.name,st_goto:$("#wd1").val()};$.tb.Stats.sendRequest("http://static.tieba.baidu.com/tb/img/hive.gif",t)}),$("#tb_header_search_form").find(".j_benba_search,.j_global_search").bind("mousedown",function(){var t=$(this);t.hasClass("j_benba_search")&&(st_param=e+"benba_search"),t.hasClass("j_global_search")&&(st_param=e+"global_search"),$.stats.sendRequest(st_param)})},st_asideAdmin:function(){$("#aside").delegate("a","click",function(){try{$.stats.sendRequest("fr=tb0_forum&st_mod=aside_admin&st_type="+encodeURIComponent($(this).tbattr("class")))}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/stats/stats.js",method:"",ln:108}),t}})},st_baidutongji:function(){var t="",e=0,a=document.cookie.match(/(^| )BAIDUID=(\w+)/);a&&(t=a[2]);for(var s=t.length-1;s>=0;s--)e+=t.charCodeAt(s);if(a&&2>e%10){var i="https:"==document.location.protocol?" https://":" http://";document.write(unescape("%3Cscript src='"+i+"hm.baidu.com/h.js%3F287705c8d9e2073d13275b18dbd746dc' type='text/javascript'%3E%3C/script%3E")),Stats.sendRequest("fr=tb0_forum&st_mod=bdtj46dc&st_type=frs")}},st_pdc:function(){var t=2,e=.02;PageData.is_ipad?(t=12,e=.5):"\u5174\u8DA3\u5927\u5E08"==PageData.forum.name?(t=121,e=1):"bright"==PageData.forum.theme&&(t=22,e=.02);var a={};PageData.forum.is_star_frs||PageData.forum.is_frs_gcon?a={id:24,sample:1}:PageData.forum.has_paper&&var_game_frs_head?a={id:25,sample:1}:PageData.forum.has_paper||var_game_frs_head?var_game_frs_head&&!PageData.forum.has_paper&&(a={id:27,sample:1}):a={id:26,sample:1},window.alogObjectConfig={product:"14",page:"14_"+t,monkey_page:"tieba-frs",speed_page:t,speed:{sample:e,special_pages:[a]},monkey:{sample:"0.05",hid:"762"},exception:{sample:"0.05"}}},st_picSmallClick:function(){PageData.forum.pic_small_flow_test&&$("#thread_list").delegate("a","click",function(){try{$.stats.sendRequest("fr=tb0_forum&st_mod=frs&st_value=thread_list_click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/stats/stats.js",method:"",ln:198}),t}}).delegate(".j_threadlist_media","click",function(){try{$.stats.sendRequest("fr=tb0_forum&st_mod=frs&st_value=media_list_click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/stats/stats.js",method:"",ln:200}),t}})},st_ajaxMonitor:function(){"undefined"!=typeof AJAX_MONITOR&&(AJAX_MONITOR.PDC.init({product_id:14,sample:.04}),window.attachEvent?window.attachEvent("onload",function(){AJAX_MONITOR.PDC.loadAnalyzer()}):window.addEventListener("load",function(){AJAX_MONITOR.PDC.loadAnalyzer()}))}}});_.Module.define({path:"comforum/widget/SkinClick",sub:{initial:function(){this._calcAdWidth(),this._bindEvents()},_calcAdWidth:function(){var i=$(".com_skinad_left,.com_skinad_right"),n=$(window).width(),t=1380>n?(n-980)/2:200;i.css("width",t)},_bindEvents:function(){var i=this;$(window).on("resize",i._calcAdWidth),$(".com_skinad_left,.com_skinad_right").on("click",function(){$.stats.hive("skin_ad")})}}});_.Module.define({path:"props/widget/Feedback",requires:[],sub:{initial:function(i){this.dataObj=i,this.initOptions(),this.initCallbacks(),this.initData(),this.play()},initOptions:function(){this.options={1070001:{id:"1070001",key:"worship",name:"\u819C\u62DC",flashOptions:{width:250,height:220,marginLeft:120,marginTop:95}},1070002:{id:"1070002",key:"egg",name:"\u81ED\u9E21\u86CB",flashOptions:{width:410,height:260,marginLeft:195,marginTop:30}}}},initData:function(){for(var i=this.dataObj.appraise||{},t=null,e=null,a=[],n=["1070001","1070002"],s=0;s<n.length;s++)t=i[n[s]],t&&t.notice>0&&(e=this.options[n[s]],$.extend(e,t),a.push(e));this.playList=a},play:function(){var i=this.playList;i.length>0&&(i.sort(function(i,t){return t.notice!=i.notice?t.notice-i.notice:parseInt(t.id)-parseInt(i.id)}),this.index=0,this.buildFlash(),this.clearNotice())},buildFlash:function(){if(this.index<this.playList.length){var i=$('<div class="props_flash_wrap"></div>');$("body").append(i);var t=this.playList[this.index],e=this.getFlashData(t);i.css({width:e.width,height:e.height,left:e.marginLeft,top:e.marginTop,"z-index":e.zindex});{var a="/tb/static-props/swf/"+e.feedbackName+"?t=0101";new $.swf(a,{id:"props_flash_content",name:"props_flash_content",container:i,width:e.width,height:e.height,params:{wmode:"transparent"}})}t.wrap=i}},getFlashData:function(i){var t=i.flashOptions,e=0,a=0,n=0,s=0,o=PageData.product;switch(o){case"pb":case"frs":case"index":n=40,e=$("#user_info").offset().left,a=$("#user_info").offset().top;break;case"ihome":n=92,e=$("#userinfo_wrap").offset().left,a=$("#userinfo_wrap").offset().top}e=e-t.marginLeft+n,a=a-t.marginTop+s;var h=i.notice>1?"more":"single";return feedbackName="feedback_"+i.key+"_"+h+".swf",{key:i.key,feedbackName:feedbackName,width:t.width,height:t.height,marginLeft:e,marginTop:a,zindex:$.getzIndex()}},clearNotice:function(){var i="/tbmall/post/clearAppraiseNotice",t={type:0,tbs:PageData.tbs};$.tb.post(i,t,function(i){i&&0==i.no})},initCallbacks:function(){var i=this,t={};t.finishPlay=function(){i.playList[i.index].wrap.remove(),i.index++,i.buildFlash()},window.MagicProps=t}}});_.Module.define({path:"common/widget/ScrollPanel",sub:{dom:null,$content:null,$scrollBar:null,$scrollButton:null,_hasScroll:!1,_scrollStep:50,_scrollTop:0,_maxHeight:0,initial:function(t){this._buildUI(t),this._bindEvents(t),$(t.container).append(this.dom),this.setHeight(t.height||100),t.content&&this.setContent(t.content),t.scrollBarShow&&this.bind("onScrollBarShow",t.scrollBarShow),t.scrollBarHide&&this.bind("onScrollBarHide",t.scrollBarHide)},_buildUI:function(t){this.dom=$('<div class="tbui_scroll_panel"></div>'),this.dom.html(['<div class="tbui_panel_content j_panel_content clearfix"><ul></ul></div>','<div class="tbui_scroll_bar j_scroll_bar">','<div class="tbui_scroll_button j_scroll_button">&nbsp;</div>',"</div>"].join("")),this.$content=this.dom.find(".j_panel_content:first"),this.$scrollBar=this.dom.find(".j_scroll_bar:first"),this.$scrollButton=this.dom.find(".j_scroll_button:first"),t.padding&&this.$content.css("padding",t.padding)},_bindEvents:function(){var t=this,o=t.$content.get(0);this.$scrollButton.on("drag",function(i,l){if(l){var s=l.position;o.scrollTop=s.top/t.$content.height()*o.scrollHeight}}),this.$content.mousewheel(function(o,i){o.preventDefault(),o.stopPropagation(),t._hasScroll&&t.scrollTopTo(t._scrollTop-i*t._scrollStep)})},scrollTopTo:function(t){var o=this,i=o.$content.get(0),t=Math.max(Math.min(t,i.scrollHeight-o.$content.height()),0);t!=o._scrollTop&&(o._scrollTop=t,o.$content.stop(),o.$content.scrollTop(o._scrollTop),o._resizeScroll())},setHeight:function(t){this._maxHeight=t,this._resizeHeight(),this._resizeScroll(),this.$scrollButton.draggable({containment:"parent"})},setContent:function(t){this.$content.html(t),this.$content.get(0).scrollTop=this._scrollTop=0,this._resizeHeight(),this._resizeScroll()},appendContent:function(t){this.$content.append(t),this._resizeHeight(),this.scrollTopTo(2e4)},clearContent:function(){this.setContent("")},_resizeHeight:function(){this.$content.css("height","");var t=this.$content.get(0),o=t.scrollHeight,i=Math.min(o,this._maxHeight);this.$content.css("height",i)},_resizeScroll:function(){var t=this.$content.get(0),o=t.scrollHeight,i=t.scrollTop,l=this.$content.innerHeight();l>=o?(this.$scrollBar.hide(),this.dom.addClass("tbui_no_scroll_bar"),this.trigger("onScrollBarHide"),this._hasScroll=!1):(this.$scrollBar.show(),this.$scrollBar.height(l),this.$scrollButton.height(l/o*l),this.$scrollButton.css("top",i/o*l),this.trigger("onScrollBarShow"),this._hasScroll=!0)}}});_.Module.define({path:"common/component/image_flash_editor",sub:{_swfPath:"http://tb2.bdstatic.com/tb/static-common/swf/FlashFilterUI_6e543a5.swf",_vars:{configURL:"/tb/static-common/htmlfilter/filterconf.js",reviewURL:"",iconPath:"/tb/static-common/img/image_editor/",uploadURL:"",imageURL:null,maxSize:5,maxWidth:3e3,maxHeight:3e3},_events:["upload_complete","compress_complete","upload_error"],_flashInstance:null,initial:function(t,i){i&&$.extend(this._vars,i),this._buildHTML(t.container,t.width,t.height),this._buildFlash(t)},_buildHTML:function(t,i,s){var a=this,e='<div class="image_flash_editor"><div class="flash_editor_container"></div><div class="button_bar"><a href="#" class="ui_btn ui_btn_m j_ok"><span><em>\u786E \u5B9A</em></span></a><a href="#" class="ui_btn ui_btn_sub_m j_cancel"><span><em>\u53D6 \u6D88</em></span></a></div></div>';this.$root=$(e),this.$root.css({width:i,height:s}),this.$root.find(".j_ok").click(function(){return a.startUpload(),!1}),this.$root.find(".j_cancel").click(function(){return a.trigger("cancel"),!1}),$(t).append(this.$root)},_buildFlash:function(t){this._swfOptions=t,this._swfOptions.height=t.height-45,this._swfOptions.container=this.$root.find(".flash_editor_container"),this._swfOptions.vars=this._vars,this._swfOptions.callBacks={},this._generateCallBack(),this._flashInstance=new $.swf(this._swfPath,this._swfOptions)},_generateCallBack:function(){var t=this;for(var i in this._events){var s=this._events[i];this._swfOptions.callBacks[s]=function(i){return function(){var s=Array.prototype.slice.call(arguments,0);s.unshift(i),t.trigger.apply(t,s)}}(s)}},loadRemoteImage:function(t){this._flashInstance.remote("loadRemoteImage",t)},startUpload:function(){this._flashInstance.remote("startUpload")},setUploaderVariables:function(t){this._flashInstance.remote("setUploaderVariables",t)},clearPreview:function(){this._flashInstance.remote("clearPreview")}}});_.Module.define({path:"common/widget/EditorPicMeizhi",requires:["common/widget/EditorPicMeizhi/EditorPicMeizhiUpload"],sub:{tempHTML:['<div id="meizhi_img_layer" class="img_layer_content j_content ui_card_wrap hide"><ul class="mz_ul clearfix"><li class="mz_imgUpload_btn" ><a class="mz_uploader_container" href="#" onclick="return false;" ></a><span class="cut_line"></span></li><li class="mz_album_btn"><a class="mz_btn_myalbum" href="#" onclick="return false;"></a><span class="cut_line"></span></li><li class="mz_camera_btn"><a class="mz_btn_camera" href="#" onclick="return false;" ></a></li></ul><span class="ui_white_down arrow"></span></div>'].join(""),count:0,imageLimite:20,initial:function(){},init:function(i,e){var t=this;t.editor=e,i.before(this.tempHTML),t.j_content=i.siblings(".j_content"),t.picUploader=this.use("common/widget/EditorPicMeizhi/EditorPicMeizhiUpload",t.j_content.find(".mz_uploader_container"),e),t.myAlbumHandler(e),t.myCameraHandler(e),t.addImageArray={}},myAlbumHandler:function(i){var e=this,t=e.j_content.find(".mz_album_btn");t.click(function(){e.editorAlbum?e.editorAlbum.run():(e.editorAlbum=e.use("common/widget/EditorPicMeizhi/EditorPicMeizhiAlbum",i),e.editorAlbum.run())})},myCameraHandler:function(i){var e=this,t=e.j_content.find(".mz_camera_btn");t.click(function(){e.editorCamera?e.editorCamera.run():(e.editorCamera=e.use("common/widget/EditorPicMeizhi/EditorPicMeizhiCamera",i),e.editorCamera.run())})},getLimitNum:function(){var i=this,e=i.editor.config.imageLimite||100,t=e-i.editor.getImageNum();return t},showMaxImage:function(){var i=this,e=i.editor.config.imageLimite||100,t=e-i.editor.getImageNum();t=Math.max(0,t),i.j_tip.find(".j_image_num").html(t)}}});
;_.Module.define({path:"common/widget/EditorPicMeizhi/EditorPicMeizhiAlbum",requires:["common/widget/ScrollPanel"],extend:"common/widget/EditorPicMeizhi/EditorPicMeizhiBase",sub:{GET_ALBUM_URL:"/photo/interface/alblist",initial:function(e){var l=this;l.editor=e},run:function(){this.selectedPic={},this.albumList={},this.curAlbumId=null,this.myAlbumLayer(),this.getAlbumList()},layerHeight:451,layerWidth:683,selectedPic:{},albumList:{},curAlbumId:null,errorHandler:function(e){var l=this;switch(e){case"noalbum":return $('<div class="album_error">\u4E0A\u4F20\u56FE\u7247\u5230\u767E\u5EA6\u76F8\u518C\uFF0C\u53D1\u8D34\u914D\u56FE\u968F\u9009\u968F\u7528\uFF0C\u65B9\u4FBF\u5FEB\u6377\uFF01<a href="http://xiangce.baidu.com/home" target="_blank" class="create_album">\u7ACB\u5373\u4E0A\u4F20</a></div>');case"creatAlbum":return $('<div class="album_error">\u5F00\u901A\u767E\u5EA6\u76F8\u518C\uFF0C\u53EF\u4EE5\u53D1\u8D34\u65F6\u76F4\u63A5\u63D2\u5165\u56FE\u7247\uFF0C\u65B9\u4FBF\u5FEB\u6377~<a href="http://xiangce.baidu.com/home" target="_blank" class="create_album">\u7ACB\u5373\u5F00\u901A</a></div>');case"login":return $("<div class=\"album_error\">\u60A8\u5DF2\u9000\u51FA\u767B\u5F55\u72B6\u6001\uFF0C\u8BF7\u91CD\u65B0<a href=\"#\" onclick=\"_.Module.use('common/widget/LoginDialog', ['', '']);\">\u767B\u5F55</a></div>");case"systemError":var a=$('<div class="album_error">\u7CFB\u7EDF\u7E41\u5FD9\uFF0C\u8BF7<a href="#" >\u5237\u65B0</a>\u91CD\u8BD5</div>');return a.find("a").click(function(){l.getAlbumList()}),a;case"noImage":return'<div class="album_error">\u8BE5\u76F8\u518C\u6CA1\u6709\u56FE\u7247\uFF0C\u8BF7\u9009\u62E9\u5176\u4ED6\u76F8\u518C\u8BD5\u8BD5~</div>'}},renderAlbumList:function(e,l){var a=this,t='<div class="l_album_list"><select class="l_album_select" onmousewheel="event.returnValue=false;return false;" >';for(i=0;e>i;i++)album=l[i],t+="<option "+(album==a.curAlbumId?'selected="selected"':"")+' value="'+album.id+'">',t+=album.name+"</option>",a.albumList[album.id]=album.pic_num;var r=a.getImageLimit(a.albumContainer.find(".l_album_selected_con"));t+='</select>\u8FD8\u53EF\u4EE5\u9009\u4E2D<span class="j_image_num" id="album_max">'+r+"</span>\u5F20</div>";var s=$(t);return s.find(".l_album_select").change(function(){a.getPicByUrl($(this).val())}),s},renderAlbumPic:function(e,l){var a=this,i=$('<div class="l_album_pics" ></div>'),t=a.getImgEles(e,1,50);return l.append(i),a.l_album_pics=i,l.click(function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}),$.JsLoadManager.use("/tb/static-common/lib/jquery-ui-1.10.0.draggable.min.js?v=130307102247",function(){$.browser.msie&&$.browser.version<8?a.l_album_pics.html(t):(a.scrollPanel=a.use("common/widget/ScrollPanel",{container:i,height:350,content:t}),a.rightScrollPanel=a.use("common/widget/ScrollPanel",{container:a.albumContainer.find(".l_album_selected_con"),height:350,content:""})),i.delegate(".j_prepage","click",function(){return a.getPicByUrl(a.curAlbumId,a.cur_page-1),!1}),i.delegate(".j_nextpage","click",function(){return a.getPicByUrl(a.curAlbumId,a.cur_page+1),!1}),i.delegate(".l_album_small_pics","click",function(){return a.selectImage(this),!1}),i.delegate(".l_album_small_pics","mouseenter",function(){return $(this).addClass("l_hover"),!1}),i.delegate(".l_album_small_pics","mouseleave",function(){return $(this).removeClass("l_hover"),!1}),a.reloadImage()}),i},reloadImage:function(){var e=this;this.l_album_pics.find(".l_album_pic").each(function(){var l=$(this),a=l.data("src");l.load(function(){e.resetImg(this,120,120)}).tbattr("src",a)})},addSelected:function(e,l){var a=this,i=$('<a class="i_item_con complete" data-url="'+e+'"><img src="'+l+'"  onload="resizePic_temp(this,84,84)" /></a>');return $.browser.msie&&$.browser.version<8?a.albumContainer.find(".l_album_selected_con").append(i):a.rightScrollPanel.appendContent(i),i},removeSelected:function(){},selectImage:function(e){var l=this;e="IMG"==e.tagName?$(e).parent():$(e);var a=e.tbattr("data-url"),i=e.tbattr("data-surl");if(this.errDom=$(".i_error_tips"),this.errDom.text(""),e.hasClass("selected"))e.removeClass("selected"),l.selectedPic[a].remove(),delete l.selectedPic[a];else{var t=l.getImageLimit(l.albumContainer.find(".l_album_selected_con"));if(0>=t)return;if(a.match("priv.hiphotos.baidu.com"))return this.errDom.text("\u60A8\u7684\u79C1\u6709\u7167\u7247\u65E0\u6CD5\u5728\u8D34\u5B50\u4E2D\u663E\u793A\uFF0C\u8BF7\u4F7F\u7528\u5176\u4ED6\u7167\u7247\u3002"),void 0;e.addClass("selected"),l.selectedPic[a]=l.addSelected(a,i)}l.updateRemianImage(l.albumContainer)},getAlbumList:function(){var e=this;$.get(e.GET_ALBUM_URL,{_t:(new Date).getTime()},function(l){var a=e.albumContainer.find(".l_album_lwrapper");if(l=$.parseJSON(l),"0"==l.no){{var i,t=l.data.defalut_album,r=l.data.album_list,s=r.length,n=t.pic_list;n.length}if(e.curAlbumId=t.id,0==s)i=e.errorHandler("noalbum"),a.html(i);else{a.append(e.renderAlbumList(s,r)),e.renderAlbumPic(n,a)}}else if("4049"==l.no){var i=e.errorHandler("creatAlbum");a.html(i)}else if("265"==l.no){var i=e.errorHandler("login");a.html(i)}else{var i=e.errorHandler("systemError");a.html(i)}})},getPicByUrl:function(e,l){var a=this;a.curAlbumId=e,$.get("/photo/interface/piclist",{album_id:e,pn:l,_t:(new Date).getTime()},function(e){if(e=$.parseJSON(e),0==e.no){var l=e.data;$.browser.msie&&$.browser.version<8?a.l_album_pics.html(a.getImgEles(l.pic_list,l.cur_page,l.page_size)):(a.scrollPanel.setContent(a.getImgEles(l.pic_list,l.cur_page,l.page_size)),a.scrollPanel.scrollTopTo(0)),a.reloadImage()}else a.l_album_pics.html(a.errorHandler("systemError"))})},getImgEles:function(e,l,a){var i,t,r="",s=e.length,a=a||50,n=this;if(n.curPagePicNum=s,n.cur_page=l||1,0==s)r=this.errorHandler("noImage");else{for(r+="<div class='l_album_pics_container'>",i=0;s>i;i++)t=this.selectedPic[e[i].big_pic]?"selected":"",r+='<a href="#" onclick="return false" class="l_album_small_pics '+t+'" data-surl="'+e[i].small_pic+'" data-url="'+e[i].big_pic+'"><span class="l_album_pic_hover"></span><span class="l_album_pic_select" title="\u5DF2\u9009\u4E2D"></span><img class="l_album_pic" data-src="'+e[i].small_pic+'"/></a>';r+="</div>";var c=this.albumList[this.curAlbumId],o=((c-1)/a|0)+1;1!=o&&(r+='<div class="l_album_pic_pager">',1!=l&&(r+='<a href="#"  class="l_album_page j_prepage" >&lt;\u4E0A\u4E00\u9875</a>'),o>l&&(r+='<a href="#"  class="l_album_page j_nextpage" >\u4E0B\u4E00\u9875&gt;</a>'),r+="</div>")}return r},myAlbumLayer:function(){var e=this;if(!e.lDialogOp){var l=$("<div></div>"),a=$('<div class="l_album_container"></div>'),i='<div class="l_album_lwrapper"></div><div class="l_album_rwrapper"><div class="l_album_rwrapper_title">\u5F53\u524D\u9009\u4E2D</div><div class="l_album_selected_con"></div></div>';e.albumContainer=a,a.html(i),l.append(a).append(e.layerBottom("showtips"));var t=e.layerWidth,r={html:l,title:"\u6211\u7684\u76F8\u518C",width:t,height:e.layerHeight,closeable:!0};$.browser.msie&&$.browser.version<7&&l.closest(".dialogJcontent").css({padding:"9px 0px 9px 9px;"}),e.editor.overlay.hide(),e.lDialogOp=new $.dialog(r),e.lDialogOp.bind("onclose",function(){e.editor.overlay.show(),delete e.lDialogOp}),e.lDialogOp.show()}},submit:function(){var e=this,l=[];for(var a in this.selectedPic)l.push({url:a,pic_id_encode:e.getEncode(a)});this.editor.insertImage(l),this.lDialogOp.close(),this.editor.overlay.show()}}});
;_.Module.define({path:"common/widget/EditorPicMeizhi/EditorPicMeizhiUpload",requires:["common/widget/image_uploader_manager","common/widget/ScrollPanel","common/component/image_flash_editor"],extend:"common/widget/EditorPicMeizhi/EditorPicMeizhiBase",sub:{picItemPath:"http://imgsrc.baidu.com/forum/pic/item/",abpicPath:"http://imgsrc.baidu.com/forum/abpic/item/",layerHeight:460,layerWidth:680,initial:function(e,i){var t=this;t.editor=i,t.j_con=e,t.uploader=t.localUploader(e),t.addImageArray={},Function.prototype.BINDEVENT=function(e){var i=this;return function(){i.apply(e,arguments)}}},localUploader:function(e){var i=this,t=this.use("common/widget/image_uploader_manager",{container:e,width:e.width(),height:e.height(),queueLen:100,fid:PageData.forum.forum_id||PageData.forum.id,isAutoUp:!1});return t.bind("onFileSelected",function(e,a){for(var o=i.dealWithData(a.imageList),r=o.filterId,n=0,d=r.length;d>n;n++)t.deleteFile(r[n]);var l=i.getImageLimit(i.imageContainer),c=o.imageList.length,s=c-r.length;if(s>l){for(var p=l;c>p;p++)t.deleteFile(o.imageList[p].id);o.imageList=o.imageList.splice(0,l)}t.startUpload(),i.startRender(o.imageList,"upload")}),t.bind("onProgressListen",function(e,t){i.progressHandler(t)}),t.bind("onComplete",function(e,t){i.uploadComplete(t)}),t.bind("onError",function(){}),t},imageHandler:function(e,i){var t=e.id,a=i.filter('[data-id="'+t+'"]'),o=a.find("b"),r=e.response,n=e.percent,d=this;a.hasClass("complete")||(o.css({width:n+"%"}),100==n&&d.renderItem(r,a))},renderItem:function(e,i){var t=this,a=i.find("b");if(null!=e&&0==e.error_code){var o=e.info.pic_id_encode,r=e.info.fullpic_width,n=e.info.fullpic_height,d=e.info.pic_water,l=i.find("img")[0];l.src="/tb/static-common/editor_img/layer/i.gif";if(200>r||200>n)return t.errorBigHandler(i.find("img")),a.parent().hide(),!1;i.removeClass("uploading").addClass("complete"),i.tbattr("data-url",t.picItemPath+o+".jpg"),i.tbattr("href","#"),i.tbattr("data-water-url",d),i.tbattr("data-width",r),i.tbattr("data-height",n),i.tbattr("data-id-encode",o),(new Image).src=t.picItemPath+o+".jpg";var c=new Image;c.onload=function(){l.style.backgroundImage="url("+t.abpicPath+o+".jpg)",a.parent().hide()},c.src=t.abpicPath+o+".jpg",d&&((new Image).src=d)}else t.errorHandler(i.find("img")),a.parent().hide()},errorHandler:function(e){e.tbattr("src","/tb/static-common/editor_img/layer/upload_fail.png");var i=e.parent();i.removeClass("uploading").addClass("i_up_error")},errorBigHandler:function(e){e.tbattr("src","/tb/static-common/editor_img/layer/upload_fail.png");var i=e.parent();i.removeClass("uploading").addClass("i_up_error_big")},addImageArray:{},dealWithData:function(e){for(var i=[],t=[],a=this.addImageArray,o=0,r=e.length;r>o;o++){var n=e[o],d=n.id,l=n.name,c=n.size,s=l+c;a[s]==s?t.push(d):(i.push(n),a[s]=s)}return{imageList:i,filterId:t}},renderContinueUpload:function(){var e=this.getImageLimit(this.imageContainer),i="";0==e&&(i="i_upload_limit");var t='<a class="i_continue_add '+i+'"><div class="i_continue_upbtn"></div><span class="i_image_remain">\u8FD8\u53EF\u4EE5\u6DFB\u52A0<span class="j_image_num">'+e+"</span>\u5F20</span></a>";return t},addDragger:function(){},startRender:function(e){var i=this,t=e;if(i.lDialogOp){if(t.length>0){var a=i.genericImageCon(t,"continue");i.continueUploader.before(a),$.browser.msie&&$.browser.version<8||(i.scrollPanel._resizeHeight(),i.scrollPanel.scrollTopTo(2e4),i.updateRemianImage(i.container,function(){i.continueUploader.addClass("i_upload_limit")},function(){i.continueUploader.removeClass("i_upload_limit")}),i.addDragger())}}else{var o=$('<div class="l_image_container clearfix"></div>');i.imageContainer=o,i.imageContainer.css({width:667});var r=$('<div class="l_image_upcontainer"></div>'),a=i.genericImageCon(t,"first");i.imageContainer.delegate(".close","click",function(){var e=$(this).parent(),t=e.tbattr("data-name"),a=e.tbattr("data-size"),o=e.tbattr("data-id"),r=e.tbattr("data-uptype");"first"==r?i.uploader.deleteFile(o):"continue"==r&&i.conUploader.deleteFile(o),delete i.addImageArray[t+a],e.remove(),i.updateRemianImage(i.container,function(){i.continueUploader.addClass("i_upload_limit")},function(){i.continueUploader.removeClass("i_upload_limit")})}),i._layerBottom=i.layerBottom("upload"),r.append(i.imageContainer).append(i._layerBottom);var n=i.layerWidth,d={html:r,holderClassName:"meizhi_uploader",title:"\u63D2\u5165\u56FE\u7247",width:n,height:i.layerHeight,show:!1,closeable:!0};if(i.editor.overlay.width(1),i.editor.overlay.height(1),i.lDialogOp=new $.dialog(d),i.lDialogOp.bind("onclose",function(){i.uploader&&i.uploader.stopUpload(),i.uploader&&i.uploader.clearList();try{i.conUploader&&i.conUploader.stopUpload(),i.conUploader&&i.conUploader.clearList()}catch(e){}i.destroyJquery(i.imageContainer),window.PicUploaderShow=!1,i.editor.overlay.width(700),i.editor.overlay.height(650),delete i.lDialogOp}),r.closest(".dialogJcontent").css("padding","0"),window.PicUploaderShow=!0,i.uploader.uploader.flash){var l=i.lDialogOp.element;i.lDialogOp.element=i.lDialogOp.element.add(i.uploader.uploader.flash.parentNode),i.lDialogOp.show(),i.lDialogOp.element=l}else i.lDialogOp.show();i.container=r,$.browser.msie&&$.browser.version<8?(i.imageContainer.html(a),i.imageContainer.append(i.renderContinueUpload()),i.continueUploader=i.imageContainer.find(".i_continue_add"),i.addContinueUploader()):$.JsLoadManager.use("/tb/static-common/lib/jquery-ui-1.10.0.draggable.min.js?v=130307102247",function(){i.scrollPanel=i.use("common/widget/ScrollPanel",{container:i.imageContainer,height:388,content:a}),i.scrollPanel.appendContent(i.renderContinueUpload()),i.continueUploader=i.imageContainer.find(".i_continue_add"),i.addDragger(),i.addContinueUploader()}),i.initPictureEditor()}},initPictureEditor:function(){var e=this;e.$pictureEditorContainer=$("<div class='pic_editor_container' id='picture_editor_container'></div>"),e.container.append(e.$pictureEditorContainer),this.pictureEditor=this.use("common/component/image_flash_editor",{container:e.$pictureEditorContainer,width:678,height:461},{uploadURL:"http://upload.tieba.baidu.com/upload/pic?tbs=4f165305af36ccdc013751701760125500_1&fid="+PageData.forum.forum_id||PageData.forum.id}),this.imageContainer.delegate(".j_editor_button","click",function(){var i=$(this).closest(".i_item_con");e.showPictureEditor(i)}),this.pictureEditor.bind("upload_complete",function(i,t){e.hidePictureEditor(),e.renderItem(t,e.pictureEditor.$item)}),this.pictureEditor.bind("cancel",function(){e.hidePictureEditor()})},showPictureEditor:function(e){this.pictureEditorOpen=!0,this.lDialogOp.setTitle("\u56FE\u7247\u7F16\u8F91"),this.pictureEditor.$item=e,this.pictureEditor.loadRemoteImage(e.tbattr("data-url")),this.$pictureEditorContainer.animate({left:-1},500)},hidePictureEditor:function(){this.pictureEditorOpen=!1,this.lDialogOp.setTitle("\u63D2\u5165\u56FE\u7247"),this.$pictureEditorContainer.animate({left:684},500)},addContinueUploader:function(){var e=this;e.conUploader=e.localUploader(e.continueUploader.find(".i_continue_upbtn"))},uploadComplete:function(e){for(var i=this,t=e.imageList,a=i.imageContainer.find(".i_item_con"),o=0,r=t.length;r>o;o++){var n=t[o];i.imageHandler(n,a)}},progressHandler:function(e){for(var i=this,t=e.imageList,a=i.imageContainer.find(".i_item_con"),o=0,r=t.length;r>o;o++){var n=t[o];i.imageHandler(n,a)}},submit:function(){var e=this,i=e._layerBottom.find(".i_checkbox")[0],t=i.checked?"1":"0";$.cookie("WATER_CHECK",t,{expires:30}),e.closeUploadLayer();var a=e.getURLs(t,e.imageContainer,"obj");e.editor.insertImage(a),e.lDialogOp.close(),e.editor.overlay.width(700),e.editor.overlay.height(650),delete e.lDialogOp},closeUploadLayer:function(){this.j_con.closest(".j_content").addClass("hide")}}});
;_.Module.define({path:"common/widget/EditorPicMeizhi/EditorPicMeizhiCamera",extend:"common/widget/EditorPicMeizhi/EditorPicMeizhiBase",sub:{id:"mz_camera_flash",layerHeight:460,layerWidth:680,initial:function(i){var e=this;e.editor=i},run:function(){this.cameraPicLayer()},cameraPicLayer:function(){var i=this;if(!i.lDialogOp){var e=$("<div></div>");i.cameraContainer=$('<div class="l_camerapic_container"></div>'),i._layerBottom=i.layerBottom("showtips"),e.append(i.cameraContainer).append(i._layerBottom);var t={html:e,title:"\u6444\u50CF\u5934\u62CD\u7167",width:i.layerWidth,height:i.layerHeight,closeable:!0};i.editor.overlay.hide(),i.lDialogOp=new $.dialog(t),i.scrollOff(),i.lDialogOp.bind("onclose",function(){i.scrollOn(),i.editor.overlay.show(),delete i.lDialogOp}),e.click(function(i){return i.stopPropagation&&i.stopPropagation(),!1}),$.browser.msie&&$.browser.version<7&&e.closest(".dialogJcontent").css({padding:"9px 0px 9px 9px;"}),i.lDialogOp.show(),i._loadTBS()}},_showErrorTips:function(i){switch(this.errDom||(this.errDom=$(".i_error_tips")),i){case"compressed":this.errDom.text("\u56FE\u7247\u538B\u7F29\u6210\u529F");break;case"already":this.errDom.text("\u6444\u50CF\u5934\u51C6\u5907\u5B8C\u6BD5\uFF0C\u8BF7\u6309\u4E0B\u786E\u5B9A\u62CD\u7167");break;case"not_support":this.errDom.text("\u6444\u50CF\u5934\u672A\u88AB\u5B89\u88C5\u6216\u5F53\u524D\u7CFB\u7EDF\u4E0D\u652F\u6301");break;case"busy":this.errDom.text("\u6444\u50CF\u5934\u5F53\u524D\u6B63\u88AB\u5360\u7528");break;case"error":this.errDom.text("\u51FA\u73B0\u5185\u90E8\u9519\u8BEF")}},_loadTBS:function(){var i=this;uploadURL="http://upload.tieba.baidu.com/upload/pic",tbsURL="http://tieba.baidu.com/dc/common/imgtbs",img_tbs=$.ajax({url:tbsURL,dataType:"json"}),img_tbs.done(function(e){0===Number(e.no)?(uploadURL+="?tbs="+e.data.tbs,i._loadCameraFlash(uploadURL)):alert("tbs error")})},_loadCameraFlash:function(i){var e=this,t={id:e.id,container:".l_camerapic_container",width:660,height:414,params:{wmode:"window"},vars:{imageWidth:800,imageHeight:600,maxSize:3,maxWidth:3e3,maxHeight:3e3,uploadURL:i},callBacks:{completeInterface:function(i){var t=[];t.push({pic_id_encode:e.getEncode(i.info.pic_water),url:i.info.pic_water}),e.editor.insertImage(t),e.lDialogOp.close(),e.scrollOn(),e.editor.overlay.show()},compressInterface:function(){e._showErrorTips("compressed")},errorInterface:function(){e._showErrorTips("error")},cameraStatus:function(i){switch(i){case"ready":e._showErrorTips("already");break;case"not_support":e._showErrorTips("not_support");break;case"busy":e._showErrorTips("busy")}}}};new $.swf("/tb/static-common/editor_img/FlashCameraPrinter.swf?dt=0724",t),this.flash=document[this.id]||window[this.id]},submit:function(){this.flash.print(),this.flash.startUpload()}}});
;_.Module.define({path:"common/widget/EditorPicMeizhi/EditorPicMeizhiBase",requires:[],sub:{layerHeight:515,layerWidth:810,initial:function(){},genericImageCon:function(t,e){for(var a="",i=0,n=t.length;n>i;i++){var r=t[i].id;a+='<a href="" unselectable="on" onclick = "return false;" class="uploading i_item_con"  data-name="'+t[i].name+'" data-uptype="'+e+'" data-size="'+t[i].size+'" data-id="'+r+'" draggable="false"><img class="i_item_bg" src="/tb/static-common/editor_img/layer/unload.png"><span class="progress"><b></b></span><span class="close" title="\u5220\u9664\u6B64\u56FE"></span><span class="button_bar"><span class="j_editor_button edit_button">\u7F8E\u5316\u56FE\u7247</span></span><span class="error">\u4E0A\u4F20\u5931\u8D25</span><span class="error_big">\u56FE\u7247\u8FC7\u5C0F</span><span class ="error_big_more">\u8BF7\u4E0A\u4F20\u5927\u56FE</span></a>'}return a},destroyJquery:function(t){t.remove(),t=null},imageHandler:function(){},checkURL:function(t){if(t=t.trim(),t.length<=0)return!1;0!==t.search(/http:\/\/|https:\/\//)&&(t+="http://");var e=/(.gif|.jpg|.jpeg|.png)$/i;return!e.test(t)||t.getByteLength()>this.urlLength?!1:t},layerBottom:function(t){var e="",a=this,i="upload"==t?"\u63D2\u5165\u56FE\u7247":"\u786E \u5B9A",n=$('<div class="i_layer_bottom"></div>'),r=$('<a href="#" style="float:left;margin-right:10px;" class="ui_btn ui_btn_m"><span><em>'+i+"</em></span></a>"),s=$(' <a href="#" style="float:left" class="ui_btn ui_btn_sub_m"><span><em>\u53D6 \u6D88</em></span></a>'),l=$('<div class="i_layer_btn"></div>');return l.append(r).append(s),n.append(l),"upload"==t?(e='<div class="i_layer_water"><input class="i_checkbox" checked type="checkbox" /><span style="float:left;">\u6DFB\u52A0\u672C\u5427\u6C34\u5370(gif\u683C\u5F0F\u6216\u8FC7\u5C0F\u7684\u56FE\u7247\u65E0\u6CD5\u6DFB\u52A0)</span></div>',n.append(e)):"showtips"==t&&(e='<div class="i_error_tips"></div>',n.append(e)),n.width(this.layerWidth-2),$.browser.msie&&$.browser.version<7&&n.css({bottom:6}),r.click(function(){return a.submit(),!1}),s.click(function(e){try{a.lDialogOp.close()}catch(e){alert(e.message)}return"upload"==t&&a.closeUploadLayer(),!1}),n},getURLs:function(t,e,a){for(var i,n=[],r=e.find(".i_item_con"),s=0;s<r.length;s++)if(i=r.eq(s),"obj"==a){var l={};i.hasClass("complete")&&i.tbattr("data-url")&&(l.url="1"==t&&""!=i.tbattr("data-water-url")&&"undefined"!=i.tbattr("data-water-url")?i.tbattr("data-water-url"):i.tbattr("data-url"),l.width=i.tbattr("data-width")||0,l.height=i.tbattr("data-height")||0,l.pic_id_encode=i.tbattr("data-id-encode")||0,n.push(l))}else i.hasClass("complete")&&i.tbattr("data-url")&&("1"==t&&""!=i.tbattr("data-water-url")&&"undefined"!=i.tbattr("data-water-url")?n.push(i.tbattr("data-water-url")):n.push(i.tbattr("data-url")));return n},remainImage:function(t,e){var a=this,i=a.getImageLimit(e),n='\u8FD8\u53EF\u4EE5\u6DFB\u52A0<span class="j_image_num">'+i+"</span>\u5F20\u56FE\u7247",r=$('<div class="i_image_tip"></div>');return"upload"==t?(n+=',<span class="i_image_continue">\u7EE7\u7EED\u6DFB\u52A0:</span><span style="color:#1D53BF">\u672C\u5730\u4E0A\u4F20</span><div class="i_uploader_con" ></div>',r.html(n),a.conUploader=a.localUploader(r.find(".i_uploader_con"))):r.html(n),a.jCon=r,a.jCon},resetImg:function(t,e,a){var i,n=t.width,r=t.height,s=0,l=0;n>e||r>a?(i=n>=r?e/n:e/r,l=(e-n*i)/2,s=(a-r*i)/2,$(t).css({height:r*i,width:n*i,top:s,left:l,visibility:"visible"})):(l=(e-n)/2,s=(a-r)/2,$(t).css({top:s,left:l,visibility:"visible"}))},updateRemianImage:function(t,e,a){var i=this,n=i.getImageLimit(t);t.find(".j_image_num").html(n),0==n?e&&e():a&&a()},getImageLimit:function(t){var e=this,a=e.getImageNum(t),i=e.editor.getImageNum()-a;return i=Math.max(0,i)},onStartDrag:function(t,e){var a=e.holder;a.style.left=a.offsetLeft+"px",a.style.top=a.offsetTop+"px",e.holder.style.position="absolute",a.parentNode.insertBefore(this.placeHolder,a),a.parentNode.appendChild(a),this.currentIndex=parseInt(a.offsetLeft/this.width),this.currentIndex=Math.min(this.currentIndex,this.index-1)},onDragging:function(t,e){var a=e.left,i=Math.min(parseInt(a/this.width),this.index-1);i!==this.currentIndex&&(this.swapNode(this.list[i],this.list[this.currentIndex]),this.currentIndex=i)},onStopDrag:function(t,e){e.holder.style.position="relative",e.holder.style.left="0",e.holder.style.top="0",this.swapNode(e.holder,this.placeHolder),this.placeHolder.parentNode.removeChild(this.placeHolder)},swapNode:function(t,e){var a=t.parentNode,i=e.parentNode,n=t.cloneNode(!1);a.replaceChild(n,t),i.replaceChild(t,e),a.replaceChild(e,n)},getImageNum:function(t){var e=0;return e=t&&t.find(".i_item_con").size()||e},getEncode:function(t){var e=t.split("/"),a=e[e.length-1];return a.slice(0,a.indexOf("."))},scrollOn:function(){document.body.parentNode.style.overflow="scroll"},scrollOff:function(){document.body.parentNode.style.overflow="hidden"}}});_.Module.define({path:"postor/widget/MeizhiPostor",requires:["common/widget/LoginDialog","common/widget/EditorPicMeizhi","common/widget/PostService"],sub:{containerHTML:["<div>",'<div id="mz_post_wrapper">','<div class="mz_post_achieve clearfix">','<div class="mz_post_achieve_inner">','<p class="mz_post_achieve_title">\u7ECF\u8FC7\u8BC4\u5BA1\u8BA4\u8BC1\u540E\u83B7\u5F97\uFF1A</p>','<ul class="mz_post_achieve_list">',"<li>",'<img src="http://tb1.bdstatic.com/tb/cms/tbmall/guessing/80/h1230014.png" width="75" height="75" />',"<p>\u5B9E\u4E60\u59B9\u7EB8</p>","</li>","<li>",'<img src="http://tb1.bdstatic.com/tb/cms/tbmall/guessing/80/h1230013.png" width="75" height="75" />',"<p>\u8BA4\u8BC1\u59B9\u7EB8</p>","</li>","</ul>","</div>","#{meizi_notice}","</div>",'<div id="#{meizhi_tip}" class="meizhi_tip">\u6E29\u99A8\u63D0\u793A\uFF1A\u7533\u8BF7\u524D\u8BF7\u8BA4\u771F\u9605\u8BFB<a href="/tb/zt/meizituan.html" target="_blank">\u59B9\u5B50\u56E2\u5B88\u5219\u53CA\u89C4\u7AE0\u5236\u5EA6</a>\u3002<a class="tip_close" onclick="return false;" href="#"></a></div>','<form id="#{meizhi_post}"  method="post"  autocomplete="off">','<table  width="100%" border="0" cellspacing="0" cellpadding="3">','<tr id="#{title_tr}"> <td class = "label_wrapper" valign="top"  nowrap style="line-height:32px;">\u6807\u9898:</td> <td colspan="3"> <div id = "#{title_div}" class="input_wrapper"><span class ="input_prefix">\u3010\u59B9\u5B50\u56E2\u7533\u8BF7\u3011</span> <input type="text" id="#{title}" class="title_input" name="title" value="" autocomplete="off"  /> </div> <div id="#{titleError}" class="postErrorTitle"></div> </td> </tr>','<tr style="line-height:32px;"> <td class = "label_wrapper" valign="top"  nowrap >\u6700\u559C\u7231\u7684\u6E38\u620F:</td> <td><input id="#{nick_ipt}" class="ui_textfield item_input" type="text" /></td> <td class = "label_wrapper" valign="top"  nowrap >\u6700\u559C\u7231\u7684\u8D34\u5427:</td> <td><input id="#{like_forum_ipt}" type="text" class="ui_textfield item_input" /></td> </tr>','<tr id="#{content_tr}"> <td class = "label_wrapper" valign="top"  nowrap >\u7533\u8BF7\u7559\u8A00:</td> <td colspan="3"> <textarea class="content_input"></textarea> <div id="#{contentError}" class="postErrorContent"></div> </td> </tr>','<tr id="pic_tr"> <td class = "label_wrapper" valign="top"  nowrap >\u7167\u7247:</td> <td colspan="3"> <div id="#{pic_wrapper}" class="pic_wrapper clearfix"> <div id="#{pic_editor}" class="pic_add"> <div class="pic_remain_back"> <div class="pic_remain">\u8FD8\u53EF\u6DFB\u52A0<span class="pic_remain_num">30</span>\u5F20</div></div></div></div><p class="pic_remain_tips">\u6CE8\uFF1A\u81F3\u5C11\u4E0A\u4F203\u5F20\u7167\u7247\u5594</p><p class="pic_remain_like_forum"><input id="meizi_ysjg_like" name="meizi_ysjg_like" type="checkbox" disabled checked /><label for="meizi_ysjg_like">\u5173\u6CE8\u82F1\u4E09\u5609\u54E5\u5427</label></p></td></tr>','<tr id="#{submit_tr}"><td>&nbsp;</td><td class="submit"> <input type="submit" id="#{submit}" alog-alias="richpostor" class="subbtn_bg" value=" \u53D1 \u8868 "/> <span class="pt_posting_status j_posting_status"></span><span id="#{postError}" class="post_error"></span> </td> </tr>',"</tbody> </table> </form></div>","</div>"].join(""),noticeHTML:['<div class="mz_post_notice">',"<h3>\u59B9\u7EB8\u8BA4\u8BC1\u7528\u6237\u4E13\u4EAB</h3>",'<div class="mz_post_notice_inner">','<p class="mz_rewards">\u60A8\u662FLV#{level}\u59B9\u7EB8\u8BA4\u8BC1</p>','<p class="mz_rewards">\u52A0\u5165\u7ACB\u5373\u83B7\u5F97<span class="red_text">#{reward}</span> T\u8C46</p>',"</div>",'<p class="mz_rewards_tips">\u52A0\u5165\u5E76\u8BA4\u8BC1\u6210\u529F\u540E\u59B9\u7EB8\u56FE\u6807\u5C06\u88AB\u65B0\u56FE\u6807\u66FF\u6362</p>',"</div>"].join(""),successHTML:['<div class="mz_post_success">','<p class="success_title">\u52A0\u5165\u7533\u8BF7\u6210\u529F\uFF01</p>',"#{reward_tip}",'<p class="success_relocation">\u8BA4\u8BC1\u7ED3\u679C\u8BF7\u5B9E\u65F6\u5173\u6CE8\u8BBA\u575B\u516C\u544A</p>','<div style="text-align: center; margin-top: 40px">','<a href="#" class="ui_btn ui_btn_m j_mz_iknown">',"<span><em>\u77E5\u9053\u4E86</em></span>","</a>","</div>","</div>"].join(""),rewardTipHTML:['<p class="success_mz_rewards">\u60A8\u662F\u59B9\u7EB8LV#{level} \u83B7\u5F97<span class="red_text">#{reward}</span> T\u8C46</p>'].join(""),config:{imageLimite:30},_likeForumUrl:"/f/like/commit/add",rewardMap:{2:{reward:"200",level:"1"},3:{reward:"2000",level:"2"},4:{reward:"1W",level:"3"}},initial:function(){this._data_postor={},this._option={forum:PageData.forum,tbs:PageData.tbs,user:PageData.user},this._event={};var t=this.containerHTML,i="",e=this._option.user.meizhi_level;e>1&&(i=$.tb.format(this.noticeHTML,{level:this.rewardMap[e].level,reward:this.rewardMap[e].reward})),this._generi_dom_id(),t=$.tb.format(t,$.extend(this._dom_id,{meizi_notice:i})),this.container=$(t);var s=this._option.user.is_login;this._statInit(s),this._initPostService()},_statInit:function(t){return t?void this._canPost():void this._cannotPost()},_cannotPost:function(){this.use("common/widget/LoginDialog","","userBar")},_canPost:function(){this._dialogInit(),this._initTitleAndContent(),this._editorInitPic(this.picWrapper),this._postBtnInit(),this._hasTip()},_dialogInit:function(){var t={html:this.container.html(),title:"\u7533\u8BF7\u52A0\u5165\u8D34\u5427\u59B9\u5B50\u56E2",width:700,height:650};this.overlay=new $.dialog(t),this.title=$("#"+this._dom_id.title_div).find(".title_input"),this.content=$("#"+this._dom_id.content_tr).find(".content_input"),this.nick=$("#"+this._dom_id.nick_ipt),this.likeForums=$("#"+this._dom_id.like_forum_ipt),this.picEditor=$("#"+this._dom_id.pic_editor),this.picWrapper=$("#"+this._dom_id.pic_wrapper),this.submit_tr=$("#"+this._dom_id.submit_tr),this._likeInit()},_pic_wrapper_toggle:function(){var t=this,i=$("#meizhi_img_layer"),e=this.picEditor.find(".pic_remain_back");e.bind("click",function(){0!=t.getImageNum()&&i.hasClass("hide")?(i.removeClass("hide"),$(document).one("click",function(){i.addClass("hide")})):i.addClass("hide")}),e.bind("click",function(t){t.stopPropagation()})},_initTitleAndContent:function(){var t="\u7231\u6E38\u620F\uFF0C\u7231\u8D34\u5427\u7684\u59B9\u5B50\u7533\u8BF7\u5165\u56E2",i="\u4F8B\u5982\uFF1A\u8D34\u5427\u7BA1\u7406\u3001\u70ED\u7231\u7206\u7167\u5206\u4EAB\u3001\u6587\u5B57\u7F16\u8F91\u3001PS\u56FE\u7247\u8BBE\u8BA1\u3001\u89C6\u9891\u76F4\u64AD\u3001\u5531\u6B4C\u3001\u8DF3\u821E\u3001\u624B\u7ED8\u6F2B\u753B\u7B49\u7279\u957F\u90FD\u53EF";_.Module.use("common/widget/Placeholder",[this.title,t,{left:95,"font-size":14}],function(){}),_.Module.use("common/widget/Placeholder",[this.content,i,{"font-size":14,"max-width":"545px"}],function(){})},_likeInit:function(){var t=this.sel=$("#"+this._dom_id.like_tr).find("select"),i=this._option.forum.name;t.append('<option value="'+i+'">'+i+"</option>"),t.tbattr("disabled","disabled")},_editorInitPic:function(t){return this.imageLayer?this.imageLayer.init(t,this):(this.imageLayer=this.use("common/widget/EditorPicMeizhi"),this.imageLayer.init(t,this)),this._pic_wrapper_toggle(),this._picBoxEvents(),!1},_postBtnInit:function(){var t=this,i=this._dom_id,e=$("#"+i.submit);e.tbattr("disabled",!1),e.className="subbtn_bg",t._postBtnEvent()},_postBtnEvent:function(){var t=this,i=this._dom_id,e=$("#"+i.submit),s=$("#"+i.meizhi_post);e.hasClass("bubbtn_bg_banned")||(e.mouseover(function(){$(this).tbattr("class","subbtn_bg_hover")}),e.mouseout(function(){$(this).tbattr("class","subbtn_bg")}),e.mousedown(function(){$(this).tbattr("class","subbtn_bg_active")})),s.submit(function(){return t._submit(),!1}),s.keydown(function(t){var i=t||window.event;(i.ctrlKey&&13==i.keyCode||i.altKey&&83==i.keyCode)&&(i.preventDefault?i.preventDefault():i.returnValue=!1)})},_generi_dom_id:function(){var t=(new Date).valueOf();this._dom_id={meizhi_tip:"mt"+t,meizhi_post:"mp"+t,title_tr:"tt"+t,title_div:"td"+t,titleError:"te"+t,content_tr:"ct"+t,contentError:"ce"+t,pic_wrapper:"pw"+t,pic_editor:"pe"+t,like_tr:"lt"+t,vcode_tr:"vt"+t,vcode_div:"vd"+t,submit_tr:"st"+t,submit:"sm"+t,postError:"pr"+t,nick_ipt:"ni"+t,like_forum_ipt:"lfi_"+t}},getImageNum:function(){return this.config.imageLimite-this.picWrapper.find(".pic_box").length},insertImage:function(t){for(var i=this,e=0,s=t.length;s>e;e++){var r=$('<div class = "pic_box" ><div class = "pic_box_close"><a href="#" onclick="return false"></a></div><img unselectable="on" style="display:none;" data-id = "'+t[e].pic_id_encode+'" class="tmp_image" src="'+t[e].url+'"/></div>');r.insertAfter(this.picEditor).find("img").one("load",function(){i.resizePicSize($(this)),i.cutPic($(this),100),$(this).show(),i._resizePos()})}},resizePicSize:function(t){var i=560,e=t.width(),s=t.height();if(e>560){var r=i/e;e=560,s*=r}t.tbattr({width:e,height:Math.floor(s)})},cutPic:function(t,i){var e=t.width(),s=t.height();if(e>s&&s>=i){e=e/s*i,s=i;var r=Math.round((e-s)/2),n=Math.round(e-s-r);t.css({width:e,height:s,marginLeft:-1*r,marginRight:-1*n})}else s>e&&e>=i&&(s=s/e*i,e=i,t.css({width:e,height:s}))},_resizePos:function(){var t=$("#"+this._dom_id.pic_wrapper+">div");t.each(function(t){this.className=$(this).hasClass("pic_add")?"pic_add":"pic_box",(t+1)%5==0&&$(this).addClass("right_end"),t>4&&$(this).addClass("bottom_end")}),this.picWrapper.find(".pic_remain_num").text(this.getImageNum())},_picBoxEvents:function(){var t=this;this.picWrapper.find(".pic_box").live("mouseenter",function(){$(this).find(".pic_box_close").show()}).live("mouseleave",function(){$(this).find(".pic_box_close").hide()}),this.picWrapper.find(".pic_box_close").live("click",function(){$(this).parent(".pic_box").remove(),t._resizePos()})},successDialog:function(t){var i=this,e="",s=this._option.user.meizhi_level;s>1&&t&&(e=$.tb.format(i.rewardTipHTML,{level:i.rewardMap[s].level,reward:i.rewardMap[s].reward}));var r=$.tb.format(i.successHTML,{reward_tip:e}),n={html:r,width:700,height:280,title:"\u53D1\u8D77\u59B9\u5B50\u56E2\u7533\u8BF7\u8D34"};this.overlay&&this.overlay.close(),this.overlay=new $.dialog(n),this.overlay.element.find(".j_mz_iknown").on("click",function(){$.tb.location.reload(),i.overlay.close()})},_hasTip:function(){var t="1"==$.cookie("meizhiTipIsClosed"),i=$("#"+this._dom_id.meizhi_tip),e=i.find(".tip_close");t&&i.hide(),e.click(function(t){$.cookie("meizhiTipIsClosed","1",{empires:365,path:"/"}),i.hide(),t.stopPropagation()})},bind:function(t,i,e){var s={stat:e?!0:!1,fun:i};this._event[t]?this._event[t].push(s):(this._event[t]=[],this._event[t].push(s))},triggerEvent:function(t){var i=Array.prototype.slice.call(arguments,0);if(i.shift(),this._event[t])for(var e=this._event[t],s=0;s<e.length;s++)if(e[s].fun&&e[s].fun.apply(this,i),!e[s].stat)return!1;return!0},setPostorData:function(t,i){var e=this._data_postor;e[t]=i},getPostorData:function(t){var i=this._data_postor;return i[t]},removePostorData:function(t){var i=this._data_postor;delete i[t]},setPostingStatus:function(t){var i=this.submit_tr.find(".j_posting_status");t?i.addClass("pt_posting_loading"):i.removeClass("pt_posting_loading")},_getData:function(){var t=this._data_postor,i=(this._dom_id,this._option,this.picWrapper.find(".tmp_image")),e="";i.each(function(){var t=$(this),i=t.tbattr("data-id");v_url=t.tbattr("src"),i&&(e+="[img pic_type=2 width="+t.tbattr("width")+" height="+t.tbattr("height")+"]"+v_url+"[/img][br]")}),t.title="\u3010\u59B9\u5B50\u56E2\u7533\u8BF7\u3011"+this.title.val();var s="";return s+="\u6700\u559C\u7231\u7684\u6E38\u620F\uFF1A"+this.nick.val()+"[br]",s+="\u6700\u559C\u7231\u7684\u8D34\u5427\uFF1A"+this.likeForums.val()+"[br]",s+="\u4E2A\u4EBA\u7279\u957F\u53CA\u7533\u8BF7\u7559\u8A00\uFF1A"+this.content.val()+"[br]",s+=e,t.content=s,t},_validator:function(){return this._validFrsPostTitle()&&this._validLikeForumsContent()&&this._validNicksContent()&&this._validRichEditorContent()&&this._validPicEditor()?!0:!1},_validFrsPostTitle:function(){var t=this.title,i=t.val().trim();if(""==i)return this._errorTipShow("\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A"),t.focus(),!1;var e=i.getByteLength(),s=60;if(e>s){var r="\u62B1\u6B49\uFF0C\u60A8\u7684\u6807\u9898\u8D85\u8FC7"+s/2+"\u5B57\uFF0C\u5EFA\u8BAE\u60A8\u7CBE\u7B80\u540E\u518D\u63D0\u4EA4";return this._errorTipShow(r),t.focus(),!1}return!0},_validRichEditorContent:function(){var t=(this._dom_id,this.content),i=this.content.val(),e=this;if(""==i.trim()||""==i.replace(/<[^>]*>|(&nbsp;)|[\s\u3000]*/g,""))return this._errorTipShow("\u53D1\u8D34\u5185\u5BB9\u9700\u5305\u542B\u6587\u5B57"),t.focus(),!1;var s=i.getByteLength(),r=1e4;if(s>r){var n="\u62B1\u6B49\uFF0C\u60A8\u7684\u8D34\u5B50\u8D85\u8FC7"+r/2+"\u5B57\uFF0C\u5EFA\u8BAE\u60A8\u7CBE\u7B80\u6216\u5206\u6BB5\u540E\u518D\u63D0\u4EA4";return e._errorTipShow(n),!1}return!0},_validPicEditor:function(){var t=this.picWrapper.find(".pic_box").length;return 3>t?(this._errorTipShow("\u8BF7\u9009\u62E9\u81F3\u5C11\u4E09\u5F20\u7167\u7247"),!1):!0},_validLikeForumsContent:function(){var t=this.likeForums;return 0==$.trim(t.val()).length?(this._errorTipShow("\u8BF7\u8F93\u5165\u6700\u559C\u7231\u7684\u8D34\u5427"),!1):!0},_validNicksContent:function(){var t=this.nick;return 0==$.trim(t.val()).length?(this._errorTipShow("\u8BF7\u8F93\u5165\u6700\u559C\u7231\u7684\u6E38\u620F"),!1):!0},_errorTipShow:function(t){var i=(this._dom_id,$("#"+this._dom_id.postError));i.css("display",""),i.get(0).innerHTML=t},_errorTipHide:function(){var t=$("#"+this._dom_id.postError);t.css("display","none")},_submit:function(){var t=this;if(this._validator()&&!this.postService.isPosting()){this.setPostingStatus(!0);var i=$("#"+this._dom_id.submit);i.tbattr("disabled",!0),i.removeClass("subbtn_bg").addClass("subbtn_bg_banned"),this.postService.post("thread",t._getData(),PosterContext.getContext())}},_likeForum:function(){var t=PageData.tbs,i=PageData.forum.forum_id,e=PageData.forum.forum_name;$.tb.post(this._likeForumUrl,{fid:i,fname:e,tbs:t})},_initPostService:function(){var t=this;this.postService=this.use("common/widget/PostService"),this.postService.success(function(){var i=t._option.user.meizhi_level;i>1?$.tb.post("/encourage/post/meizhi/addtdou",{tbs:PageData.tbs},function(i){0==i.no?t.successDialog(!0):t.successDialog()}):t.successDialog(),t._likeForum()}).complete(function(){var i=$("#"+t._dom_id.submit);i.tbattr("disabled",!1),i.removeClass("subbtn_bg_banned").addClass("subbtn_bg"),t.setPostingStatus(!1)})}}});_.Module.define({path:"fanclub/widget/fancard",requires:["common/widget/Card"],sub:{_fancard:null,_fancard_ajax:null,_fancard_data:{},_forum_id:"0",initial:function(){this._wrap=$("body"),this._bindEvents()},_bindEvents:function(){var a=this;this._wrap.delegate(".j_fanclub_vip","mouseenter",function(){return $(this).tbattr("title",""),a._getCardData(this),!1}),this._wrap.delegate(".j_fanclub_vip","mouseleave",function(){return a._fancard_ajax&&a._fancard_ajax.abort(),a._fancard&&a._fancard.closeCard({type:"delayClose",time:200}),a._fancard=null,!1})},_getCardData:function(a){var t=$(a).getData();if(t){var n=t.user_id,r=this;this._fancard_ajax=$.ajax({type:"GET",url:"/frsstar/browse/fanclub/fanInfo?userid="+n,dataType:"json",success:function(t){switch(t.no){case 0:r._fancard_data=t,r._buildCard(a)}},error:function(){$(a).tbattr("title","\u7F51\u7EDC\u9519\u8BEF")}})}},_buildCard:function(a){var t="",n=this._fancard_data.fanclub_array.length;n>3&&(n=3);for(var r=0;n>r;r++)0==r&&(this._forum_id=this._fancard_data.fanclub_array[r].forum_id),t+='<a  target="_blank"  href="/f?kw='+encodeURIComponent(this._fancard_data.fanclub_array[r].name)+'&ie=utf-8" class="fanclub_card_forum_name">'+this._fancard_data.fanclub_array[r].name+' <span class="fanclub_icon fanclub_icon_vip_'+this._fancard_data.fanclub_array[r].level+'"></span></a>',n-1>r&&(t+='<a class="fanclub_card_forum_name_gap">|</a>');var e=['<div id="fanclub_card_container">','<div class="fanclub_card_head">','<a  target="_blank"  href="/i/sys/jump?un='+encodeURIComponent(this._fancard_data.username)+'&ie=utf-8"  ><img src="http://tb.himg.baidu.com/sys/portrait/item/'+this._fancard_data.portrait+'" alt="" /></a>',"</div>",'<div class="fanclub_card_right">','<a target="_blank" href="/i/sys/jump?un='+encodeURIComponent(this._fancard_data.username)+'&ie=utf-8" class="fanclub_card_right_title">'+this._fancard_data.username+'<span class="fanclub_icon fanclub_icon_frs "></span></a>',"<p>\u52A0\u5165\u4F1A\u5458\u65F6\u95F4:<span>"+this._formatDate(this._fancard_data.entertime)+"</span></p>","<p>\u5DF2\u52A0\u5165\u7C89\u4E1D\u4F1A:<span>"+this._fancard_data.fanclub_count+"\u4E2A</span></p>","</div>",'<div class="fanclub_card_forum_icon_wrapper" >',t,"</div>",'<div class="fanclub_card_bottom">','<a  target="_blank"  href="http://tieba.baidu.com/p/2676282434">\u4EC0\u4E48\u662F\u7C89\u4E1D\u4F1A\u5458&gt;&gt;</a>',"</div>","</div>"].join(""),_=$(a),i=_.offset().left-140+_.outerWidth(!0)/2,d=_.offset().top-64-12;this._fancard=this.use("common/widget/Card",{content:e,card_css:{top:d,left:i,width:302,height:147},auto_positon:!0,event_target:_,attr:"id='fancard_show'",wrap:$("body")}),this._fancard.showCard({type:"delayShow",time:200})},_buildErrorCard:function(){},_formatDate:function(a){var t=new Date(1e3*a);return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}}});_.Module.define({path:"encourage/widget/WelfareIcon",sub:{_card:null,_isGifing:!1,initial:function(){this._wrap=$("body"),this._bindEvents()},_bindEvents:function(){var t=this;this._wrap.on("mouseenter",".j_score_welfare",function(){t._buildCard(this)}).on("mouseleave",".j_score_welfare",function(){return t._card&&t._card.closeCard({type:"delayClose",time:200}),t._card=null,!1}).on("click",".j_score_welfare",function(e){return t.showGif(e),!1})},showGif:function(t){var e=$("<div></div>"),i=this,o="http://tb1.bdstatic.com/tb/r/image/2014-04-11/968642070f6c20e5274ba44b5a75707f.gif",n=$('<img style="position:absolute;z-index: 50000; left: 80px; top: 80px;width:1px;height: 1px;" src="">');this._isGifing||(this._isGifing=!0,e.css({position:"absolute",zIndex:5e4,left:t.pageX-80,top:t.pageY-80}),e.append(n),$("body").append(e),setTimeout(function(){n.tbattr("src",o)},0),n.animate({width:190,height:134,top:0,left:0},300),setTimeout(function(){n.animate({width:1,height:1,top:80,left:80},300,function(){e.remove(),i._isGifing=!1})},3e3))},_buildCard:function(t){var e,i=['<div style="text-align: center">','<p style="font-weight: bold;">\u3010\u798F\u5229\u5370\u8BB0\u3011</p>',"<p>\u6709\u6548\u671F\uFF1A2014\u5E7412\u670831\u65E5</p></div>"].join(""),o=['<div style="text-align: center">','<p style="font-weight: bold;">\u3010\u798F\u5229\u5370\u8BB0\u3011</p>',"<p>\u53D1\u798F\u5229\u6709\u673A\u4F1A\u83B7\u5F97\uFF01</p>",'<p style="color:#fc6853">\u70B9\u6211\uFF01</p></div>'].join(""),n=$(t),s=n.getData();if(s){e=s.user_id!==PageData.user.user_id?o:i;var a=n.offset().left-86+n.outerWidth(!0)/2,d=n.offset().top-64-12;this._card=this.use("common/widget/Card",{content:e,card_css:{top:d,left:a,width:172},auto_positon:!0,event_target:n,wrap:$("body")}),this._card.showCard({type:"delayShow",time:200})}}}});_.Module.define({path:"encourage/widget/achieveCard",requires:["common/component/Card"],sub:{initial:function(){this._wrap=$("body"),this._bindEvent()},_bindEvent:function(){var a=this;this._wrap.on("mouseenter",".j_fighter",function(e){var t=$(e.target),i=t.getData();$.post("/tbmall/gthread/iconbanner",{tbs:PageData.tbs,user_id:i.user_id},function(e){var i=t.offset();if(0===e.no){var c='<div class="achievement_card">    <p class="achievement_card_content">       <img class="achievement_card_img" src="http://tb.himg.baidu.com/sys/portrait/item/'+e.data.portrait+'" alt="" height=66 width=66 />        <span class="achievement_card_uname">'+e.data.user_name+'</span><i class="achievement_card_icon"></i></br>        <span class="achievement_card_medal">\u9996\u5C4A\u62F3\u738B\u4E89\u9738\u8D5B - '+e.data.icon_name+' </span></br>    </p><a class="achievement_card_link" href="/tbmall/gthread/center" target="_blank">\u9996\u5C4A\u8D34\u5427\u62F3\u738B\u4E89\u9738\u8D5B>></a></div>';a._medalCard=a.use("common/component/Card",{content:c,card_css:{width:265,"z-index":1e3,top:i.top-117-12,left:i.left-126,card_leave_display:!0},wrap:$("body"),attr:"id='achieve_icon_card'"}),a._medalCard.showCard({type:"delayShow",time:200})}})}).on("mouseleave",".j_fighter",function(e){e.preventDefault(),a._medalCard&&a._medalCard.closeCard({type:"delayClose",time:200})}).on("click",".j_fighter",function(a){a.preventDefault()}),this._wrap.on("mouseenter",".j_cup_a, .j_cup_b",function(e){var t=$(e.target),i=t.offset(),c="A CUP \u5370\u8BB0",d="http://tb1.bdstatic.com/tb/cms/fifa/girl/cup_a.png";$(this).hasClass("j_cup_b")&&(c="B CUP \u5370\u8BB0",d="http://tb1.bdstatic.com/tb/cms/fifa/girl/cup_b.png");var n='<div class="cup_card"><div class="cup_card_top clearfix"><img src="'+d+'" width="57" height="57" /><p class="title">'+c+'</p><p>\u8981\u4E24\u4E2A\u4E00\u8D77\u624D\u591F\u597D\uFF01</p></div><div class="cup_card_bottom"><a href="/f?ie=utf-8&kw=%E4%B8%96%E7%95%8C%E6%9D%AF#cupicon" target="_blank">\u4E16\u754C\u676F\u671F\u95F4\u7ED9\u5973\u795E\u9C9C\u82B1\u83B7\u5F97\uFF01</a></div></div>';a._medalCard=a.use("common/component/Card",{content:n,card_css:{width:235,"z-index":1e3,top:i.top-110-12,left:i.left-110,card_leave_display:!0},wrap:$("body"),attr:"id='cup_icon_card'"}),a._medalCard.showCard({type:"delayShow",time:200})}).on("mouseleave",".j_cup_a, .j_cup_b",function(e){e.preventDefault(),a._medalCard&&a._medalCard.closeCard({type:"delayClose",time:200})}).on("click",".j_cup_a, .j_cup_b",function(a){a.preventDefault()}),this._wrap.on("mouseenter",".j_minigame",function(e){var t=$(e.target),i=(t.getData(),t.offset()),c='<div class="minigame_card"><div class="minigame_card_top clearfix"><img src="http://tb1.bdstatic.com/tb/r/image/2014-08-05/32d9b951b986efbb2ad5ce0f445ce9be.png" width="57" height="57" /><p class="title">\u6E38\u620F\u738B\u5370\u8BB0</p><p>\u5728\u3010T\u8C46\u5C0F\u6E38\u620F\u3011\u4E2D\u8FDE\u7EED3\u5929\uFF0C\u6BCF\u5929\u81F3\u5C11\u5B8C\u6210\u4E00\u5C40\u6BD4\u8D5B\uFF0C\u5373\u53EF\u83B7\u5F97\u3002</p></div><div class="minigame_card_bottom"><a href="/minigame/home" target="_blank">T\u8C46\u5C0F\u6E38\u620F</a></div></div>';a._medalCard=a.use("common/component/Card",{content:c,card_css:{width:275,"z-index":1e3,top:i.top-110-12,left:i.left-130,card_leave_display:!0},wrap:$("body"),attr:"id='minigame_icon_card'"}),a._medalCard.showCard({type:"delayShow",time:200})}).on("mouseleave",".j_minigame",function(e){e.preventDefault(),a._medalCard&&a._medalCard.closeCard({type:"delayClose",time:200})})}}});_.Module.define({path:"frs/widget/bawuGuide",sub:{roleMap:{1:["\u5427\u4E3B\u6216\u5B9E\u4E60\u5427\u4E3B","\u4ECE\u73B0\u5728\u5F00\u59CB\uFF0C#{forumName}\u5427\u7684\u5EFA\u8BBE\u4E0E\u53D1\u5C55\u91CD\u4EFB\u5C31\u4EA4\u4E88\u4F60\u5566\uFF01</br>\u4F60\u53EF\u4EE5\u5230\u5427\u52A1\u540E\u53F0\uFF0C\u4F7F\u7528\u672C\u5427\u6570\u636E\u6D4F\u89C8\u3001\u5427\u6210\u957F\u9636\u6BB5\u6D4F\u89C8\u3001\u5427\u52A1\u7BA1\u7406\u3001\u4F1A\u5458\u7BA1\u7406\u3001\u5427\u540D\u7247\u8BBE\u7F6E\u7B49\u5427\u7BA1\u7406\u529F\u80FD\u3002"],21:["\u5B98\u65B9\u5427\u4E3B","\u4ECE\u73B0\u5728\u5F00\u59CB\uFF0C#{forumName}\u5427\u7684\u5EFA\u8BBE\u4E0E\u53D1\u5C55\u91CD\u4EFB\u5C31\u4EA4\u4E88\u4F60\u5566\uFF01</br>\u4F60\u53EF\u4EE5\u5230\u5427\u52A1\u540E\u53F0\uFF0C\u4F7F\u7528\u672C\u5427\u6570\u636E\u6D4F\u89C8\u3001\u5427\u6210\u957F\u9636\u6BB5\u6D4F\u89C8\u3001\u5427\u52A1\u7BA1\u7406\u3001\u4F1A\u5458\u7BA1\u7406\u3001\u5427\u540D\u7247\u8BBE\u7F6E\u7B49\u5427\u7BA1\u7406\u529F\u80FD\u3002"],2:["\u5C0F\u5427\u4E3B","\u4ECE\u73B0\u5728\u5F00\u59CB\uFF0C\u4F60\u5C31\u548C#{forumName}\u5427\u7684\u5927\u5427\u4E3B\u4E00\u8D77\u5E76\u80A9\u4F5C\u6218\uFF0C\u5171\u5EFA\u7F8E\u597D\u8D34\u5427!</br>\u4F60\u53EF\u4EE5\u5230\u5427\u52A1\u540E\u53F0\uFF0C\u4F7F\u7528\u672C\u5427\u6570\u636E\u6D4F\u89C8\u3001\u5427\u6210\u957F\u9636\u6BB5\u6D4F\u89C8\u7B49\u5427\u7BA1\u7406\u529F\u80FD\u3002"],3:["\u89C6\u9891\u5C0F\u7F16","\u4ECE\u73B0\u5728\u5F00\u59CB\uFF0C\u4F60\u5C31\u548C#{forumName}\u5427\u7684\u5927\u5427\u4E3B\u4E00\u8D77\u5E76\u80A9\u4F5C\u6218\uFF0C\u5171\u5EFA\u7F8E\u597D\u8D34\u5427!</br>\u4F60\u53EF\u4EE5\u5230\u5427\u52A1\u540E\u53F0\uFF0C\u4F7F\u7528\u672C\u5427\u6570\u636E\u6D4F\u89C8\u3001\u5427\u6210\u957F\u9636\u6BB5\u6D4F\u89C8\u7B49\u5427\u7BA1\u7406\u529F\u80FD\u3002"],4:["\u56FE\u7247\u5C0F\u7F16","\u4ECE\u73B0\u5728\u5F00\u59CB\uFF0C\u4F60\u5C31\u548C#{forumName}\u5427\u7684\u5927\u5427\u4E3B\u4E00\u8D77\u5E76\u80A9\u4F5C\u6218\uFF0C\u5171\u5EFA\u7F8E\u597D\u8D34\u5427!</br>\u4F60\u53EF\u4EE5\u5230\u5427\u52A1\u540E\u53F0\uFF0C\u4F7F\u7528\u672C\u5427\u6570\u636E\u6D4F\u89C8\u3001\u5427\u6210\u957F\u9636\u6BB5\u6D4F\u89C8\u7B49\u5427\u7BA1\u7406\u529F\u80FD\u3002"],5:["\u5427\u520A\u4E3B\u7F16","\u4ECE\u73B0\u5728\u5F00\u59CB\uFF0C\u4F60\u5C31\u548C#{forumName}\u5427\u7684\u5927\u5427\u4E3B\u4E00\u8D77\u5E76\u80A9\u4F5C\u6218\uFF0C\u5171\u5EFA\u7F8E\u597D\u8D34\u5427!</br>\u4F60\u53EF\u4EE5\u5230\u5427\u52A1\u540E\u53F0\uFF0C\u4F7F\u7528\u672C\u5427\u6570\u636E\u6D4F\u89C8\u3001\u5427\u6210\u957F\u9636\u6BB5\u6D4F\u89C8\u7B49\u5427\u7BA1\u7406\u529F\u80FD\u3002"],6:["\u5427\u520A\u5C0F\u7F16","\u4ECE\u73B0\u5728\u5F00\u59CB\uFF0C\u4F60\u5C31\u548C#{forumName}\u5427\u7684\u5927\u5427\u4E3B\u4E00\u8D77\u5E76\u80A9\u4F5C\u6218\uFF0C\u5171\u5EFA\u7F8E\u597D\u8D34\u5427!</br>\u4F60\u53EF\u4EE5\u5230\u5427\u52A1\u540E\u53F0\uFF0C\u4F7F\u7528\u672C\u5427\u6570\u636E\u6D4F\u89C8\u3001\u5427\u6210\u957F\u9636\u6BB5\u6D4F\u89C8\u7B49\u5427\u7BA1\u7406\u529F\u80FD\u3002"],20:["\u8BED\u97F3\u5C0F\u7F16","\u4ECE\u73B0\u5728\u5F00\u59CB\uFF0C\u4F60\u5C31\u548C#{forumName}\u5427\u7684\u5927\u5427\u4E3B\u4E00\u8D77\u5E76\u80A9\u4F5C\u6218\uFF0C\u5171\u5EFA\u7F8E\u597D\u8D34\u5427!</br>\u4F60\u53EF\u4EE5\u5230\u5427\u52A1\u540E\u53F0\uFF0C\u4F7F\u7528\u672C\u5427\u6570\u636E\u6D4F\u89C8\u3001\u5427\u6210\u957F\u9636\u6BB5\u6D4F\u89C8\u7B49\u5427\u7BA1\u7406\u529F\u80FD\u3002"],26:["\u5E7F\u64AD\u5C0F\u7F16","\u4ECE\u73B0\u5728\u5F00\u59CB\uFF0C\u4F60\u5C31\u548C#{forumName}\u5427\u7684\u5927\u5427\u4E3B\u4E00\u8D77\u5E76\u80A9\u4F5C\u6218\uFF0C\u5171\u5EFA\u7F8E\u597D\u8D34\u5427!</br>\u4F60\u53EF\u4EE5\u5230\u5427\u52A1\u540E\u53F0\uFF0C\u4F7F\u7528\u672C\u5427\u6570\u636E\u6D4F\u89C8\u3001\u5427\u6210\u957F\u9636\u6BB5\u6D4F\u89C8\u7B49\u5427\u7BA1\u7406\u529F\u80FD\u3002"]},initial:function(e){try{var a=e.role_id,t=this.roleMap[a],i={forumName:PageData.forum.forum_name,forumNameUrl:PageData.forum.name_url},n=['<h1 class="bawu_guide_title">\u606D\u559C\u4F60\u5DF2\u6210\u4E3A#{forumName}\u5427\u7684'+t[0]+"\uFF01</h1>",'<p class="bawu_guide_content">'+t[1]+"</p>",'<div class="bawu_guide_btns">','<a href="/bawu2/platform/index?word=#{forumNameUrl}" class="ui_btn ui_btn_m do_btn"><span><em>\u8BBF\u95EE\u5427\u52A1\u540E\u53F0</em></span></a>','<a href="#" class="ui_btn ui_btn_sub_m next_time_btn"><span><em>\u4E0B\u6B21\u518D\u8BF4</em></span></a>',"</div>"].join(""),u=new $.dialog({html:$.tb.format(n,i),width:460,title:"\u63D0\u793A",holderClassName:"bawuGuideDlg"}),r=$(".bawuGuideDlg");r.find(".next_time_btn").click(function(){try{var e=['<p class="next_guide_title">\u4E0B\u6B21\u8BBF\u95EE\u672C\u5427\u5427\u52A1\u540E\u53F0\uFF0C\u53EF\u4EE5\u4ECE\u9875\u9762\u53F3\u4FA7\u7684\u201C\u8FDB\u5165\u5427\u52A1\u540E\u53F0\u201D\u5165\u53E3\u8BBF\u95EE</p>','<div class="next_guide_content"></div>','<div class="next_guide_btn">','<a href="#" class="ui_btn ui_btn_m close_btn"><span><em>\u77E5\u9053\u4E86</em></span></a>',"</div>"].join("");return u.setContent(e),r.css({width:540,top:"-=150"}),r.find(".close_btn").click(function(){try{return u.close(),!1}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"frs:widget/bawu_guide/bawu_guide.js",method:"",ln:53}),e}}),!1}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"frs:widget/bawu_guide/bawu_guide.js",method:"",ln:55}),a}})}catch(o){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:o.message||o.description,path:"frs:widget/bawu_guide/bawu_guide.js",method:"",ln:57}),o}}}});_.Module.define({path:"common/widget/PlatformSpreadLayer",requires:[],sub:{initial:function(t){this.$platformLayer=$("#platform_left_float"),this.$platformCloseBtn=$("#j_platform_close_btn"),this.$platformClickBtn=$("#j_platform_left_content"),this.shouldShowLayer=$.cookie("platform_float_hide_"+t)?!0:!1,this.opt=t,this.shouldShowLayer||($.stats.track("\u6574\u4F53","\u8D34\u5427\u6D6E\u6807",PageData.product,"show",{obj_type:"\u5E73\u53F0\u5316",obj_name:t}),this.$platformLayer.show(),this._bindEvent())},_bindEvent:function(){var t=this,o=t.$platformLayer,a=t.$platformCloseBtn,e=t.$platformClickBtn,i=t.opt;e.on("click",function(){$.stats.track("\u6574\u4F53\u70B9\u51FB","\u8D34\u5427\u6D6E\u6807",PageData.product,"click",{obj_type:"\u5E73\u53F0\u5316",obj_name:i})}),a.on("click",function(){return $.stats.track("\u5173\u95ED\u6309\u94AE","\u8D34\u5427\u6D6E\u6807",PageData.product,"click",{obj_type:"\u5E73\u53F0\u5316",obj_name:i}),o.hide(),$.cookie("platform_float_hide_"+i,1,{expires:999,path:"/"}),!1})}}});_.Module.define({path:"fanclub/widget/fantuan_floatlayer",sub:{_srcs:{common:PageUnit.load("fantuan_floatlayer_img"),hover:PageUnit.load("fantuan_floatlayer_img_hover"),close:"/tb/static-fanclub/img/floatlayer_close.png"},_urls:{common:PageUnit.load("fantuan_floatlayer_url")},_isclosed:!1,_product:"",_forum_id:"",initial:function(a){this._forum_id=a.forumid,this._forum_id||(this._forum_id=PageData.forum.forum_id);var t=$.cookie(this._forum_id+"_fantuan_floatlayer");this._product=a.product,this._srcs.common=a.img,this._srcs.hover=a.hover,this._urls.common=a.url,!t&&this._srcs.common&&(this._buildDialogHTML(),document.body.clientWidth>1024&&this._srcs.common?$("#j_fantuan_floatlayer").show():$("#j_fantuan_floatlayer").hide())},_initEvents:function(a,t,o){var n=this;$(window).resize(function(){document.body.clientWidth>1024&&n._srcs.common?$("#j_fantuan_floatlayer").show():$("#j_fantuan_floatlayer").hide()}),$("#j_fantuan_floatlayer").delegate(".close_btn","click",function(a){return a&&a.preventDefault?a.preventDefault():window.event.returnValue=!1,$.cookie(n._forum_id+"_fantuan_floatlayer","true",{expires:1,path:"/"}),$("#j_fantuan_floatlayer").hide(),!1}),o&&$("#j_fantuan_floatlayer").find(".fantuan_floatlayer").mouseover(function(){$(this).tbprop("src",o)}).mouseout(function(){$(this).tbprop("src",t)}).click(function(){})},_buildDialogHTML:function(){var a=this._srcs.common,t=this._srcs.hover,o=this._srcs.close,n=this._urls.common,i=[];i.push('<div id="j_fantuan_floatlayer">'),i.push('<img src="'+o+'" alt="close" class="close_btn"/>'),i.push('<div class="fantuan_floatlayer_wrap">'),n?i.push('<a href="'+n+'" target="_blank"><img src="'+a+'" alt="red" class="fantuan_floatlayer"/></a>'):i.push('<img src="'+a+'" alt="red" class="fantuan_floatlayer"/>'),i.push("</div></div>"),$("body").append(i.join("")),this._initEvents(n,a,t)}}});_.Module.define({path:"common/widget/pkFixedBubble",sub:{initial:function(){this.$wrap=$("#pk_bubble_w"),this.$close_btn=this.$wrap.find(".close_btn"),this.showBubble(),this.bindEvent()},showBubble:function(){if(1!=$.cookie("pk_bubble_hide")&&document.body.clientWidth>1024){var i=Math.round($(window).height()/2-this.$wrap.outerHeight()/2);this.$wrap.css({top:i}).show()}else this.$wrap.hide()},bindEvent:function(){var i=this;this.$close_btn.click(function(e){e.preventDefault(),i.$wrap.remove(),$.cookie("pk_bubble_hide",1,1)}),$(window).resize(function(){i.showBubble()})}}});_.Module.define({path:"common/widget/confSkin",sub:{conf:{},initial:function(t){this.conf=t,this.$wrap=$("body"),this.$wrap.addClass(t.bodyClass),parseInt(t.couplet.has_couplet)&&this.insertCouplet()},insertCouplet:function(){var t=this.conf.couplet.couplet_info,i=this.conf.isStar?" couplet_star":"",e=['<a href="'+t.url_left+'" class="j_couplet couplet_left'+i+'" title="'+t.url_title+'" target="_blank" style="background: url('+t.left_pic+') right center no-repeat;"></a>','<a href="'+t.url_right+'" class="j_couplet couplet_right'+i+'" title="'+t.url_title+'" target="_blank" style="background: url('+t.right_pic+') left center no-repeat;"></a>'].join("");this.$couplets=$(e).appendTo(this.$wrap),this.calWidth(),this.initCoupletEvent()},initCoupletEvent:function(){var t=this;$(window).on("resize",function(){t.calWidth()})},calWidth:function(){var t=$(window).width(),i=1380>t?(t-980)/2:200;this.$couplets.css("width",i)}}});_.Module.define({path:"common/widget/tbskin",sub:{initial:function(s){var i=["http://tb1",".bdstatic.com/tb/cms/common/tbskin/skins/skin_",s,".css?v=",PageUnit.load("tbskin_version")].join("");$('<link id="css_skin" href="'+i+'" rel="stylesheet">').appendTo("head"),$("body").addClass("skin_"+s)}}});_.Module.define({path:"pb/widget/frsFromGuide",sub:{initial:function(){try{var t=$.tb.location.getSearchValue().fr;"shortcut"==t&&$.stats.track("\u684C\u9762\u5FEB\u6377\u65B9\u5F0F_\u8FDB\u5165","\u65B0\u7528\u6237\u7559\u5B58","frs","show")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/frs_from_guide/frs_from_guide.js",method:"",ln:9}),e}}}});_.Module.define({path:"encourage/widget/npc_vote/npc_vote_action",sub:{initial:function(e){this._opt=e,this._bindEvents()},_bindEvents:function(){var e=this,t=this._opt.$root;t.on("click",".j-btn-vote",function(){if(!PageData.user.is_login)return e.requireInstanceAsync("common/widget/LoginDialog"),void 0;var a=$(this).data("id"),n=$(this).data("forumname");$.post("/celebrity/submit/voteNpc",{tbs:PageData.tbs,id:a},function(a){switch(a.no){case 0:t.find(".j_vote_npc_"+a.data.id).find(".j_vote_num").text(a.data.vote_num),e._success();break;case 952710:e._attention(n);break;case 11e4:e.requireInstanceAsync("common/widget/LoginDialog");break;case 952711:e._alert({msg:"\u5427\u7B49\u7EA7\u8FBE\u5230"+(a.data+1)+"\u7EA7\u624D\u80FD\u652F\u6301\u672C\u5427\u54E6"});break;case 952712:e._alert({msg:"\u60A8\u7533\u8BF7\u7684\u540D\u4EBA\u5DF2\u522B\u7533\u8BF7\u8FC7\u4E86~"});break;case 952713:e._alert({msg:"\u672C\u671F\u6295\u7968\u7ED3\u675F\uFF0C\u4E0B\u4E00\u671F\u5373\u5C06\u542F\u52A8\uFF0C\u656C\u8BF7\u671F\u5F85"});break;case 952709:e._alert({msg:"\u5F53\u524D\u7528\u6237\u4E0D\u662F\u5427\u4E3B"});break;case 65534:e._alert({msg:"\u6BCF\u5929\u53EA\u80FD\u7ED93\u4E2A\u5427\u6295\u7968 \u0CA5_\u0CA5"});break;case 65533:e._alert({msg:"\u6BCF\u5929\u53EA\u80FD\u7ED9\u4E00\u4E2A\u5427\u62951\u7968\uFF0C\u8BF7\u660E\u5929\u7EE7\u7EED\u652F\u6301"});break;case 65532:e._alert({msg:"IP\u4E00\u5929\u8D85\u8FC7500"});break;default:$.dialog.alert(a.error,{title:"\u63D0\u793A"})}})})},_success:function(){var e='<div class="npc-vote-dialog"><p>\u6295\u7968\u6210\u529F</p><div class="btn-group"><a href="/celebrity/rankHome#npc_vote" class="btn-default btn-small mr10 j-see-rank">\u67E5\u770B\u699C\u5355</a> <a href="javascript:;" class="btn-sub btn-small j_close">\u53D6 \u6D88</a></div></div>',t=this._alert({html:e});$(t.element).find(".j-see-rank").on("click",function(){t.close()})},_alert:function(e){var t=e.html||'<div class="npc-vote-dialog"><p>'+e.msg+'</p><div class="btn-group">  <a href="#" class="btn-default btn-small j_close">\u786E \u8BA4</a></div></div>',a=new $.dialog({width:380,html:t,title:"\u63D0\u793A",draggable:!1});return $(a.element).find(".j_close").on("click",function(){return a.close(),!1}),a},_attention:function(e){var t='<div class="npc-vote-dialog"><p>\u672A\u5173\u6CE8\u672C\u5427\u4E0D\u80FD\u6295\u7968\u54E6~</p><div class="btn-group"> <a href="/f?kw='+encodeURIComponent(e)+'" class="btn-default btn-small">\u53BB\u5173\u6CE8</a></div></div>';new $.dialog({width:350,html:t,title:"\u63D0\u793A",draggable:!1})}}});_.Module.define({path:"frs/widget/forum_card/focus_btn",requires:["comforum/widget/attentionCategoryGame"],sub:{initial:function(t){try{this.isOfficial=t.isOfficial,this.tbs=t.tbs,this.uid=t.uid,this.is_forum_fourth_manager=t.is_forum_fourth_manager,this.avatar=t.avatar,this.userForumList=t.userForumList||"",this.forum_name="",t.fr&&"bawu"==t.fr&&(this.forum_name=$.tb.unescapeHTML(t.forum_name));var e=this,a=$("#j_head_focus_btn"),o=null;e.config={},e.config.url={closetip:"/f/like/commit/notice/delete",dolike:"/f/like/commit/add",undolike:"/f/like/commit/delete"},o=parseInt(t.islike)?function(){if(PageData.user.power&&PageData.user.power.bawu)return e._showAlert('<p style="text-align: center;">\u60A8\u8FD8\u662F\u672C\u5427\u7684\u5427\u52A1\uFF0C\u8F9E\u804C\u540E\u624D\u80FD\u53D6\u6D88\u5173\u6CE8\u54E6~</p>'),!1;var t=PageData.forum_name||PageData.forum.forum_name;t=$.tb.subByte(t,10,"...");var a=['<div style="width:190px;text-align:center;top:18px;left:10px;position:absolute;">\u786E\u5B9A\u4E0D\u518D\u5173\u6CE8 <span style="color:red">'+t+"</span> \u5427\uFF1F</div>",'<a href="#" id="cancel_focus_yes" class=" ui_btn ui_btn_s" style="position:absolute;top:50px;left:55px;">',"<span><em>\u786E\u8BA4</em></span>","</a>",'<a href="#" onclick="return false;" id="cancel_focus_no" class="ui_btn ui_btn_sub_s" style="position:absolute;top:50px;left:105px;">',"<span><em>\u53D6\u6D88</em></span>","</a>"].join(""),o=new $.dialog({html:a,showTitle:!1,fixed:!1,show:!0,draggable:!1,autoCenter:!1,modal:!1,top:$("#j_head_focus_btn").offset().top-$(this).height()/2-90,left:$("#j_head_focus_btn").offset().left-$(this).width()/2+15,width:210,height:70});$("#cancel_focus_yes").on("click",function(){try{e._undolike(),o.close()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:82}),t}}),$("#cancel_focus_no").on("click",function(){try{o.close()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:85}),t}})}:function(){e._dolike()},a.on("click",o),$(".j_search_post ").click(function(){try{$.stats.track("FRS\u5168\u5427\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:95}),t}}),$(".search_internal_btn").click(function(){try{$.stats.track("FRS\u5427\u5185\u641C\u7D22","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:98}),t}}),$(".sign_title_text_bright").click(function(){try{$.stats.track("FRS\u7B7E\u5230\u5E7F\u544A","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:101}),t}}),$(".j_nav_list > li:eq(2) a").click(function(){try{$.stats.track("FRS\u7B7E\u5230\u5E7F\u544A","PB\u53CAFRS\u7EDF\u8BA1\u5408\u9879","frs","click")}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:104}),t}})}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"frs:widget/forum_card/focus_btn.js",method:"",ln:105}),i}},_showAlert:function(t){var e='<div style="padding:20px 20px; text-align:cente; line-height:20px;font-size:13px;">'+t+"</div>";$.dialog.open(e,{title:"\u64CD\u4F5C\u5931\u8D25",width:380})},_dolike:function(){var t=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.is_login&&PageData.user.no_un)return TbCom.process("User","buildUnameFrame","\u586B\u5199\u7528\u6237\u540D","\u6709\u7528\u6237\u540D\u624D\u80FD\u70B9\u4EAE\u201C\u6211\u559C\u6B22\u201D\uFF0C\u8D76\u5FEB\u7ED9\u81EA\u5DF1\u8D77\u4E00\u4E2A\u5427~"),!1;var e={};1==$.tb.location.getSearchValue("fromadlike")&&$.stats.track("\u95F4\u63A5\u52A0\u5173\u6CE8","\u5206\u53D1\u5173\u6CE8\u5427\u63A8\u8350","","click"),PageData.forum&&(e={fid:PageData.forum.id||PageData.forum.forum_id,fname:t.forum_name||PageData.forum.forum_name||PageData.forum_name,uid:PageData.user.name_url,ie:"gbk",tbs:PageData.tbs},e.fname=$.tb.escapeHTML(e.fname)),$.post(t.config.url.dolike,e,function(e){var a=!1;try{var o=e}catch(i){a=!0}if(!a)if(o&&0==o.no)Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikesucc&bduid="+PageData.user.bduid),t.isOfficial?_.Module.use("frs/widget/platform_attention_recommend",[{tbs:t.tbs,uid:t.uid,is_forum_fourth_manager:t.is_forum_fourth_manager,avatar:t.avatar}]):"\u6E38\u620F"==PageData.forum.first_class?_.Module.use("comforum/widget/attentionCategoryGame",["",!1,{index:o.data.ret.index,like_no:o.like_no}]):_.Module.use("ucenter/widget/LikeTip",["",!1,{index:o.data.ret.index,like_no:o.like_no},t.userForumList]),$.stats.sendRequest("fr=tb0_forum&st_page=frs&st_mod=like&st_type=auto");else{Stats.sendRequest("fr=tb0_foruStatm&st_mod=frs&st_type=balvlikefail&errorno="+o.no);var s="";s=8==o.no||9==o.no?"\u4F60\u5728\u672C\u5427\u88AB\u5C01\u7981\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":220==o.no?"\u4F60\u88AB\u5427\u4E3B\u52A0\u5165\u9ED1\u540D\u5355\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":221==o.no?"\u4F60\u5DF2like\u4E86\u672C\u5427,\u8BF7\u4E0D\u8981\u91CD\u590D\u64CD\u4F5C":"\u62B1\u6B49\uFF0C\u5F02\u5E38\u9519\u8BEF\uFF0C\u5EFA\u8BAE\u5237\u65B0\u9875\u9762\u91CD\u8BD5\u4E00\u4E0B",t._showAlert(s)}},"json")},_undolike:function(){var t=this,e=null;PageData.forum&&(e={fid:PageData.forum.forum_id,fname:t.forum_name||PageData.forum.forum_name||PageData.forum_name,uid:PageData.user.name_url,ie:"utf-8",tbs:PageData.tbs},e.fname=$.tb.escapeHTML(e.fname)),$.tb.post(t.config.url.undolike,e,function(t){var e=!1;try{var a=t}catch(o){e=!0}e||a&&0==a.no&&$.tb.location.reload(!0)})}}});_.Module.define({path:"common/widget/tbshare/tbshare_all",requires:["common/widget/tbshare/tbshare_share"],sub:{_tmp:['<div class="tbshare_all_wrapper">',"<h5>\u5206\u4EAB\u5230",'<p class="j_tbshare_all_close"></p>',"</h5>",'<div class="tbshare_all_main"></div>','<div class="tbshare_all_footer"></div>',"</div>"].join(""),_args:{targets:[["qqzone","QQ\u7A7A\u95F4"],["tieba","\u767E\u5EA6\u8D34\u5427"],["renren","\u4EBA\u4EBA\u7F51"],["tsina","\u65B0\u6D6A\u5FAE\u535A"],["weixin","\u5FAE\u4FE1"],["douban","\u8C46\u74E3"],["tsohu","\u641C\u72D0\u5FAE\u535A"],["copy","\u590D\u5236"]]},initial:function(t){t=t||{},this.args=$.extend({show:!1,$container:$("body")},t),this.$container=this.args.$container,this._createElement(),this._bindEvents(),this._addToContainer()},_createElement:function(){this.$dom=$(this._tmp),this.$share_all_main=this.$dom.find(".tbshare_all_main"),this.share=this.requireInstance("common/widget/tbshare/tbshare_share",[this._args]),this.share.$dom.appendTo(this.$share_all_main)},_bindEvents:function(){var t=this;this.$dom.on("click",".j_tbshare_all_close",function(){t.hideAll()})},_addToContainer:function(){this.$container&&this.$container.append(this.$dom),this.args.show&&this.showAll()},setShareContent:function(t){return this.share.setShareContent(t),this},showAll:function(){return this.$dom.show(),this},hideAll:function(){return this.$dom.hide(),this}}});_.Module.define({path:"comforum/widget/gameIframeCommon",requires:[],sub:{initial:function(){"pass"}}});_.Module.define({path:"comforum/widget/GameCoverHead",requires:["common/widget/messenger","common/widget/tbshare"],sub:{initial:function(e){this.$wrapper=$("#game_cover_head_wrapper"),this.fr=$.tb.location.getSearchValue("gfr")||$.tb.location.getSearchValue("fr")||"",this.da_from=$.tb.location.getSearchValue("da_from")||"",this.da_sign=$.tb.location.getSearchValue("da_sign")||"",this.$index_wrapper=this.$wrapper.find(".game_index"),this.$play_wrapper=this.$wrapper.find(".game_play_wrapper"),this.$server_wrapper=this.$wrapper.find(".game_server_wrapper"),this.is_login=$.getPageData("user.is_login"),this.is_sign_in=e.is_sign_in||!1,this.has_liked=e.has_liked||!1,this.fromArea="index",this.game_link=e.game_link||!1,this.game_id=e.game_id||!1,this.load_data_error=!1,this.direct_link=e.direct_link||!1,this.defaultGameLink="http://tieba.baidu.com/game/playGame?ie=utf-8&game_id="+this.game_id,this.errorServerName="NaN",this.is_game_blank=e.is_game_blank||!1,this.forum_name=e.forum_name,this.dolikeConf={url:"/f/like/commit/add",is_like:$.getPageData("user.is_like"),data:{fid:$.getPageData("forum.forum_id"),fname:$.getPageData("forum.forum_name"),uid:$.getPageData("user.name"),ie:"gbk",tbs:$.getPageData("tbs")}},this.signConf={url:"/sign/add",is_sign_in:1==$.getPageData("is_sign_in"),data:{ie:"utf-8",kw:$.getPageData("forum.forum_name"),tbs:$.getPageData("tbs")}},this._bindEvents(),this._switchWrapper(),this._getDataAsync()},_getDataAsync:function(){var e=this;$.ajax({url:"/game/browse/gameServer",data:{game_id:this.game_id,gfr:"frs_top"},timeout:3e3,type:"GET",dataType:"json"}).done(function(r){r.game_id?(e._showIndexServer(r),e._showRecoServer(r),e._showLastServer(r),e._showMyServer(r),e._showAllServer(r)):e._getDataAsyncFailed()}).fail(function(){e._getDataAsyncFailed()})},_getDataAsyncFailed:function(){$(".enter_area > .server_info").remove(),this.load_data_error=!0,this.game_link=this.defaultGameLink},_showIndexServer:function(e){var r="",a=e.last_server.length;0!=a?(r=e.last_server[0].serverName?"\u60A8\u6700\u8FD1\u767B\u5F55\u7684\u662F\u3010"+e.last_server[0].serverName+"\u3011":this.errorServerName,this.game_link=e.last_server[0].tb_link||this.defaultGameLink):(r=e.newest_server[0].serverName?"\u60A8\u5C06\u8FDB\u5165\u6700\u65B0\u670D\u3010"+e.newest_server[0].serverName+"\u3011":this.errorServerName,this.game_link=e.newest_server[0].tb_link||this.defaultGameLink),$(".enter_area > .server_info").find("span").html(r)},_showRecoServer:function(e){var r=e.reco_server[0].tb_link||this.defaultGameLink,a=e.reco_server[0].serverName||this.errorServerName,s="",i="",t="";$(".import_server > .server_link").tbattr("href",r),$(".import_server > .server_link").find("p").html("\u3010"+a+"\u3011");for(var n=1;n<e.reco_server.length&&2>=n;++n)i=e.reco_server[n].tb_link||this.defaultGameLink,t=e.reco_server[n].serverName||this.errorServerName,s+='<li><a class="server_link" href="'+i+'" onclick="return false" target="_blank"> <span class="server_statu busy"></span><span>'+t+'</span><span class="recommend_icon">\u8350</span><span class="recommend_icon">\u706B</span></a></li>';$(".new_server").find("ul").append(s)},_showLastServer:function(e){for(var r="",a="",s="",i=0;i<e.last_server.length;++i)a=e.last_server[i].tb_link||this.defaultGameLink,s=e.last_server[i].serverName||this.errorServerName,r+='<li><a class="server_link" href="'+a+'" onclick="return false" target="_blank"><span class="server_statu busy"></span><span>'+s+'</span><span class="recommend_icon">\u8350</span><span class="recommend_icon">\u706B</span></a></li>';$(".user_server > .used_server").find("ul").append(r)},_showMyServer:function(e){for(var r="",a="",s="",i=0;i<e.my_server.length;++i)a=e.my_server[i].tb_link||this.defaultGameLink,s=e.my_server[i].serverName||this.errorServerName,r+='<li><a class="server_link" href="'+a+'" onclick="return false" target="_blank"><span class="server_statu busy"></span><span>'+s+'</span><span class="recommend_icon">\u8350</span><span class="recommend_icon">\u706B</span></a></li>';$(".user_server > .my_server").find("ul").append(r)},_showAllServer:function(e){for(var r="",a="",s="",i=0;i<e.all_server.length;++i)a=e.all_server[i].tb_link||this.defaultGameLink,s=e.all_server[i].serverName||this.errorServerName,r+='<li><a class="server_link" href="'+a+'" onclick="return false" target="_blank"><span class="server_statu busy"></span><span>'+s+'</span><span class="recommend_icon">\u8350</span><span class="recommend_icon">\u706B</span></a></li>';$(".server_all_main").find("ul").append(r)},_startGame:function(){if(!this._checkLogin())return!1;if(this.load_data_error)return $.dialog.alert("\u670D\u52A1\u5668\u62BD\u98CE\uFF0C\u5237\u65B0\u8BD5\u8BD5\uFF01"),!1;if(this._addDoLike(),this._signForum(),this.is_game_blank){var e=this.game_link+"&from="+this.forum_name+"&gfr="+this.fr+"&da_sign="+this.da_sign+"&da_from="+this.da_from;return window.open(e),!0}this._showPlayWrapper(),this._refreshGame()},_removePlayIframe:function(){this.$play_iframe&&this.$play_iframe.remove()},_refreshGame:function(){this._removePlayIframe(),this.$play_iframe=$('<iframe class="play_area j_play_area"></iframe>'),this.$play_iframe.appendTo(this.$play_wrapper),this.game_link&&this.$play_iframe.tbattr("src",this.game_link)},_showPlayWrapper:function(){this.$wrapper.css({height:600}),this.$index_wrapper.hide(),this.$server_wrapper.hide(),this.$play_wrapper.show()},_exitGame:function(){this._removePlayIframe(),this._showIndexWrapper()},_showIndexWrapper:function(){this.$wrapper.css({height:500}),this.$play_wrapper.hide(),this.$server_wrapper.hide(),this.$index_wrapper.show()},_showServerWrapper:function(){this.$wrapper.css({height:500}),this.$index_wrapper.hide(),this.$play_wrapper.hide(),this.$server_wrapper.show()},_selectServer:function(){this._showServerWrapper()},_showLoginDialog:function(){this.requireInstanceAsync("common/widget/LoginDialog",["","userBar"])},_bindEvents:function(){var e=this;this.$wrapper.on("click",".j_select_server",function(){return e.fromArea=$(this).tbattr("from-area"),e._postTrack("\u91CD\u65B0\u9009\u670D"),e.direct_link?(window.open(e.direct_link),void 0):(e._selectServer(),void 0)}),this._bindIndexEvents(),this._bindGameEvents(),this._bindServerEvents(),this._bindCardEvents()},_bindIndexEvents:function(){var e=this;this.$index_wrapper.on("click",".j_start_game",function(){return e._postTrack("\u5F00\u59CB\u6E38\u620F"),e.direct_link?(window.open(e.direct_link),void 0):(e._startGame(),void 0)}),this.$index_wrapper.on("click",".j_like_box",function(){var r=$(this).tbprop("checked");r||e._postTrack("\u5173\u95ED\u5173\u6CE8")}),this.$index_wrapper.on("click",".j_sign_box",function(){var r=$(this).tbprop("checked");r||e._postTrack("\u5173\u95ED\u7B7E\u5230")})},_bindGameEvents:function(){var e=this;this.$play_wrapper.on("click",".j_exit_game",function(){e._postTrack("\u9000\u51FA\u6E38\u620F"),e._exitGame()}).on("click",".j_change_user",function(){e._postTrack("\u5207\u6362\u8D26\u53F7"),e._showLoginDialog()}).on("click",".j_refresh_game",function(){e._postTrack("\u5237\u65B0\u6E38\u620F"),e._refreshGame()})},_bindServerEvents:function(){var e=this;this.$server_wrapper.on("mouseover",".used_server",function(){e.$wrapper.find(".selected").removeClass("selected"),$(this).find("h6").addClass("selected"),e.$wrapper.find(".used_server ul").show(),e.$wrapper.find(".my_server ul").hide()}).on("mouseover",".my_server",function(){e.$wrapper.find(".selected").removeClass("selected"),$(this).find("h6").addClass("selected"),e.$wrapper.find(".my_server ul").show(),e.$wrapper.find(".used_server ul").hide()}).on("click",".j_return_btn",function(){e._postTrack("\u8FD4\u56DE"),e._returnFromServer()}).on("click",".server_link",function(){e._postTrack("\u9009\u670D");var r=$(this).tbattr("href");r=$.tb.unescapeHTML(r),e.game_link=r,e._startGame()})},_bindCardEvents:function(){var e=this;this.$wrapper.on("click",".cover_tip_close",function(){e.game_swap_card.closeCard()})},_switchWrapper:function(){var e=$.tb.location.getSearchValue("coverIndex");"selectServer"==e&&this._selectServer()},_checkLogin:function(){return this.is_login?!0:(this._showLoginDialog(),!1)},_returnFromServer:function(){"play"==this.fromArea?this._showPlayWrapper():"index"==this.fromArea?this._showIndexWrapper():this._showIndexWrapper()},_addDoLike:function(){var e=this.$wrapper.find(".j_like_box").tbprop("checked");return this.has_liked||!e||this.dolikeConf.is_like?!1:($.post(this.dolikeConf.url,this.dolikeConf.data,function(e){var r=!1,a="";try{a=e}catch(s){r=!0}r||a&&0==a.no},"json"),void 0)},_signForum:function(){var e=this.$wrapper.find(".j_sign_box").tbprop("checked");return this.is_sign_in||!e||this.signConf.is_sign_in?!1:($.post(this.signConf.url,this.signConf.data,function(e){var r=!1,a="";try{a=e}catch(s){r=!0}r||a&&0==a.no},"json"),void 0)},_postTrack:function(e){"undefined"==typeof e&&(e=""),$.stats.track(e,"\u6E38\u620FCOVER\u5427\u5934","","click",{obj_fr:this.fr})},_addCard:function(){var e=['<span class="cover_tip_close">X</span>',"\u73A9\u6E38\u620F\u5C31=\u7B7E\u5230\uFF0C\u4E00\u4E3E\u4E24\u5F97\u4E50\u4E0D\u505C\uFF01"].join(""),r={content:e,event_target:this.$wrapper,card_css:{height:160,left:388,top:156,zIndex:999},arrow_pos:{left:20},card_leave_display:!0,attr:"id='game_swap_card'",wrap:this.$index_wrapper};this.game_swap_card=this.use("common/widget/Card",r),this.game_swap_card.showCard()}}});_.Module.define({path:"comforum/widget/gameBannerFf14",requires:[],sub:{initial:function(){this.bindEvents()},bindEvents:function(){$(".game_banner_ff14").on("click",".to_buy",function(){$.stats.track("FRS\u9875\u5934\u90E8","\u6E38\u620FBannerFF14","","click")})}}});